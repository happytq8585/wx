0 info it worked if it ends with ok
1 verbose cli [ 'D:\\Program Files\\nodejs\\node.exe',
1 verbose cli   'D:\\Program Files\\nodejs\\node_modules\\npm\\bin\\npm-cli.js',
1 verbose cli   'install',
1 verbose cli   '--scripts-prepend-node-path=auto' ]
2 info using npm@3.10.10
3 info using node@v6.11.0
4 silly loadCurrentTree Starting
5 silly install loadCurrentTree
6 silly install readLocalPackageData
7 silly install normalizeTree
8 silly loadCurrentTree Finishing
9 silly loadIdealTree Starting
10 silly install loadIdealTree
11 silly cloneCurrentTree Starting
12 silly install cloneCurrentTreeToIdealTree
13 silly cloneCurrentTree Finishing
14 silly loadShrinkwrap Starting
15 silly install loadShrinkwrap
16 silly loadShrinkwrap Finishing
17 silly loadAllDepsIntoIdealTree Starting
18 silly install loadAllDepsIntoIdealTree
19 silly fetchNamedPackageData grunt
20 silly mapToRegistry name grunt
21 silly mapToRegistry using default registry
22 silly mapToRegistry registry http://registry.cnpmjs.org/
23 silly mapToRegistry data Result {
23 silly mapToRegistry   raw: 'grunt',
23 silly mapToRegistry   scope: null,
23 silly mapToRegistry   escapedName: 'grunt',
23 silly mapToRegistry   name: 'grunt',
23 silly mapToRegistry   rawSpec: '',
23 silly mapToRegistry   spec: 'latest',
23 silly mapToRegistry   type: 'tag' }
24 silly mapToRegistry uri http://registry.cnpmjs.org/grunt
25 silly fetchNamedPackageData grunt-contrib-jshint
26 silly mapToRegistry name grunt-contrib-jshint
27 silly mapToRegistry using default registry
28 silly mapToRegistry registry http://registry.cnpmjs.org/
29 silly mapToRegistry data Result {
29 silly mapToRegistry   raw: 'grunt-contrib-jshint',
29 silly mapToRegistry   scope: null,
29 silly mapToRegistry   escapedName: 'grunt-contrib-jshint',
29 silly mapToRegistry   name: 'grunt-contrib-jshint',
29 silly mapToRegistry   rawSpec: '',
29 silly mapToRegistry   spec: 'latest',
29 silly mapToRegistry   type: 'tag' }
30 silly mapToRegistry uri http://registry.cnpmjs.org/grunt-contrib-jshint
31 silly fetchNamedPackageData grunt-version-check
32 silly mapToRegistry name grunt-version-check
33 silly mapToRegistry using default registry
34 silly mapToRegistry registry http://registry.cnpmjs.org/
35 silly mapToRegistry data Result {
35 silly mapToRegistry   raw: 'grunt-version-check',
35 silly mapToRegistry   scope: null,
35 silly mapToRegistry   escapedName: 'grunt-version-check',
35 silly mapToRegistry   name: 'grunt-version-check',
35 silly mapToRegistry   rawSpec: '',
35 silly mapToRegistry   spec: 'latest',
35 silly mapToRegistry   type: 'tag' }
36 silly mapToRegistry uri http://registry.cnpmjs.org/grunt-version-check
37 silly fetchNamedPackageData jshint
38 silly mapToRegistry name jshint
39 silly mapToRegistry using default registry
40 silly mapToRegistry registry http://registry.cnpmjs.org/
41 silly mapToRegistry data Result {
41 silly mapToRegistry   raw: 'jshint',
41 silly mapToRegistry   scope: null,
41 silly mapToRegistry   escapedName: 'jshint',
41 silly mapToRegistry   name: 'jshint',
41 silly mapToRegistry   rawSpec: '',
41 silly mapToRegistry   spec: 'latest',
41 silly mapToRegistry   type: 'tag' }
42 silly mapToRegistry uri http://registry.cnpmjs.org/jshint
43 silly fetchNamedPackageData load-grunt-tasks
44 silly mapToRegistry name load-grunt-tasks
45 silly mapToRegistry using default registry
46 silly mapToRegistry registry http://registry.cnpmjs.org/
47 silly mapToRegistry data Result {
47 silly mapToRegistry   raw: 'load-grunt-tasks',
47 silly mapToRegistry   scope: null,
47 silly mapToRegistry   escapedName: 'load-grunt-tasks',
47 silly mapToRegistry   name: 'load-grunt-tasks',
47 silly mapToRegistry   rawSpec: '',
47 silly mapToRegistry   spec: 'latest',
47 silly mapToRegistry   type: 'tag' }
48 silly mapToRegistry uri http://registry.cnpmjs.org/load-grunt-tasks
49 verbose request uri http://registry.cnpmjs.org/grunt
50 verbose request no auth needed
51 info attempt registry request try #1 at 11:23:32
52 verbose request id 715193e7ca6868ea
53 http request GET http://registry.cnpmjs.org/grunt
54 verbose request uri http://registry.cnpmjs.org/grunt-contrib-jshint
55 verbose request no auth needed
56 info attempt registry request try #1 at 11:23:32
57 http request GET http://registry.cnpmjs.org/grunt-contrib-jshint
58 verbose request uri http://registry.cnpmjs.org/grunt-version-check
59 verbose request no auth needed
60 info attempt registry request try #1 at 11:23:32
61 http request GET http://registry.cnpmjs.org/grunt-version-check
62 verbose request uri http://registry.cnpmjs.org/jshint
63 verbose request no auth needed
64 info attempt registry request try #1 at 11:23:32
65 http request GET http://registry.cnpmjs.org/jshint
66 verbose request uri http://registry.cnpmjs.org/load-grunt-tasks
67 verbose request no auth needed
68 info attempt registry request try #1 at 11:23:32
69 http request GET http://registry.cnpmjs.org/load-grunt-tasks
70 http 200 http://registry.cnpmjs.org/grunt-version-check
71 verbose bad json <html>
71 verbose bad json <head>
71 verbose bad json <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
71 verbose bad json <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
71 verbose bad json <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
71 verbose bad json <title>网络准入客户端</title>
71 verbose bad json <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
71 verbose bad json <script language="JavaScript" type="text/JavaScript">
71 verbose bad json <!--
71 verbose bad json var bNotRun = false;
71 verbose bad json if(window.ActiveXObject)
71 verbose bad json {
71 verbose bad json
71 verbose bad json }
71 verbose bad json else
71 verbose bad json {
71 verbose bad json     bNotRun = true;
71 verbose bad json 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
71 verbose bad json }
71 verbose bad json function MM_preloadImages() { //v3.0
71 verbose bad json   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
71 verbose bad json     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
71 verbose bad json     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
71 verbose bad json }
71 verbose bad json
71 verbose bad json function Close()
71 verbose bad json {
71 verbose bad json     try
71 verbose bad json     {
71 verbose bad json         var startSD = IngressClnt.StartSD();
71 verbose bad json         if (startSD == 0) {
71 verbose bad json             alert("启动安全桌面失败");
71 verbose bad json             return;
71 verbose bad json         }
71 verbose bad json     }
71 verbose bad json     catch (e)
71 verbose bad json     {
71 verbose bad json         alert("启动安全桌面失败");
71 verbose bad json         return;
71 verbose bad json     }
71 verbose bad json
71 verbose bad json  var ua=navigator.userAgent
71 verbose bad json  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
71 verbose bad json  if(ie)
71 verbose bad json  {
71 verbose bad json       var IEversion
71 verbose bad json 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
71 verbose bad json 	if(hasTrident)
71 verbose bad json 	{
71 verbose bad json 			IEversion=11
71 verbose bad json 	}
71 verbose bad json 	else
71 verbose bad json 	{
71 verbose bad json 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
71 verbose bad json 	}
71 verbose bad json
71 verbose bad json       if(IEversion< 5.5)
71 verbose bad json       {
71 verbose bad json       	close();
71 verbose bad json       }
71 verbose bad json       else
71 verbose bad json       {
71 verbose bad json       	parent:top.window.opener =null;
71 verbose bad json        	parent:top.window.close();
71 verbose bad json       }
71 verbose bad json    }
71 verbose bad json  else
71 verbose bad json  {
71 verbose bad json    parent:top.window.close()
71 verbose bad json  }
71 verbose bad json }
71 verbose bad json
71 verbose bad json function Uninstall()
71 verbose bad json {
71 verbose bad json 	try
71 verbose bad json 	{
71 verbose bad json 		IngressClnt.Uninstall();
71 verbose bad json 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
71 verbose bad json 		strPrompt += "请关闭所有浏览器!";
71 verbose bad json 		bUninstall = false;
71 verbose bad json 	}
71 verbose bad json 	catch(e)
71 verbose bad json 	{
71 verbose bad json 		var strPrompt;
71 verbose bad json 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
71 verbose bad json 	}
71 verbose bad json 	loading.innerText = strPrompt;
71 verbose bad json }
71 verbose bad json
71 verbose bad json function button_show()
71 verbose bad json {
71 verbose bad json 	var sHTML;
71 verbose bad json 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
71 verbose bad json 	//del by zl at 05/25/2010 卸载失效
71 verbose bad json 	/*
71 verbose bad json 	if(!bUninstall)
71 verbose bad json 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
71 verbose bad json 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
71 verbose bad json 		else
71 verbose bad json 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
71 verbose bad json 	*/
71 verbose bad json 	//end del by zl
71 verbose bad json 	ScriptDiv.innerHTML = sHTML;
71 verbose bad json }
71 verbose bad json
71 verbose bad json function html_redirect()
71 verbose bad json {
71 verbose bad json 	var s =  new String(window.location);
71 verbose bad json 	var ss = s.indexOf("?");
71 verbose bad json 	if(ss > 0)
71 verbose bad json 	{
71 verbose bad json 		var url = s.substr(ss+1);
71 verbose bad json 		var ss = url.indexOf("://");
71 verbose bad json 		if(ss < 0)
71 verbose bad json 			url = "http://" + url;
71 verbose bad json 		window.location = url;
71 verbose bad json 	}
71 verbose bad json }
71 verbose bad json function onLocationSingress()
71 verbose bad json {
71 verbose bad json 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
71 verbose bad json 	window.open(ipaddress);
71 verbose bad json
71 verbose bad json }
71 verbose bad json //-->
71 verbose bad json </script>
71 verbose bad json </head>
71 verbose bad json
71 verbose bad json <body>
71 verbose bad json
71 verbose bad json <SCRIPT language=JavaScript>
71 verbose bad json <!--
71 verbose bad json var strPrompt = "";
71 verbose bad json var bInstall = true;	// true : Want to install, false : want to uninstall
71 verbose bad json
71 verbose bad json
71 verbose bad json var bDownloading = true;
71 verbose bad json var bProcessed = false;
71 verbose bad json var bSuccess = false;
71 verbose bad json var bStartProcess = false;
71 verbose bad json var bRuleChecking = false;
71 verbose bad json var bUninstall = false;
71 verbose bad json var bDelTempFile = false;
71 verbose bad json var bPassIngress = false;
71 verbose bad json
71 verbose bad json var i = 0;
71 verbose bad json var timer = 0;
71 verbose bad json var j = 0;
71 verbose bad json var k = 0;
71 verbose bad json var total = 0;
71 verbose bad json
71 verbose bad json function CheckProcess()
71 verbose bad json {
71 verbose bad json     if(bNotRun)
71 verbose bad json     {
71 verbose bad json         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
71 verbose bad json         return;
71 verbose bad json     }
71 verbose bad json 	var retv;
71 verbose bad json 	if(!bSuccess)
71 verbose bad json 	{
71 verbose bad json 		try
71 verbose bad json 		{
71 verbose bad json 			var ipaddress = window.location.host + ",10.252.252.252";
71 verbose bad json 			IngressClnt.TellServiceGatewayIp(ipaddress);
71 verbose bad json 			bDownloading = false;
71 verbose bad json 			bSuccess = true;
71 verbose bad json 		}
71 verbose bad json 		catch(e)
71 verbose bad json 		{
71 verbose bad json 			bDownloading = true;
71 verbose bad json 		}
71 verbose bad json 	}
71 verbose bad json 	if(bDownloading)
71 verbose bad json 	{
71 verbose bad json 		if(j == 0)
71 verbose bad json 		{
71 verbose bad json 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
71 verbose bad json 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
71 verbose bad json 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
71 verbose bad json 		}
71 verbose bad json 		if(j <= 5)
71 verbose bad json 		{
71 verbose bad json 			strPrompt += ".";
71 verbose bad json 			j++;
71 verbose bad json 			total++;
71 verbose bad json 		}
71 verbose bad json 		else
71 verbose bad json 		{
71 verbose bad json 			j=0;
71 verbose bad json
71 verbose bad json 			if(total > 50)
71 verbose bad json 			{
71 verbose bad json 				window.clearInterval(timer);
71 verbose bad json 			//	strPrompt = "网络准入系统客户端安装超时!";
71 verbose bad json 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
71 verbose bad json 			}
71 verbose bad json 		}
71 verbose bad json 	}
71 verbose bad json 	else
71 verbose bad json 	{
71 verbose bad json 		if(!bDelTempFile)
71 verbose bad json 		{
71 verbose bad json 			IngressClnt.DeleteTempFile(); //删除临时缓存
71 verbose bad json 			bDelTempFile = true;
71 verbose bad json 		}
71 verbose bad json 		bProcessed = true;
71 verbose bad json
71 verbose bad json 		if(!bRuleChecking)
71 verbose bad json 		{
71 verbose bad json 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
71 verbose bad json 		}
71 verbose bad json 		else
71 verbose bad json 		{
71 verbose bad json 			var retv;
71 verbose bad json 			retv = IngressClnt.GetAuthenState();
71 verbose bad json 			switch(retv)
71 verbose bad json 			{
71 verbose bad json 			    case 0:
71 verbose bad json 			        {
71 verbose bad json 			            // 现在统一由共享内存给出
71 verbose bad json 						try
71 verbose bad json 						{
71 verbose bad json 				            strPrompt = IngressClnt.GetIngressMessage();
71 verbose bad json 				            if (k <= 5) {
71 verbose bad json 				                for (var dot = 0; dot < k; dot++ )
71 verbose bad json 				                    strPrompt += ".";
71 verbose bad json 				                k++;
71 verbose bad json 				                total++;
71 verbose bad json 				            }
71 verbose bad json 				            else {
71 verbose bad json 				                k = 0;
71 verbose bad json 				            }
71 verbose bad json 						}
71 verbose bad json 						catch(e)
71 verbose bad json 						{
71 verbose bad json 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
71 verbose bad json 						}
71 verbose bad json 			        }
71 verbose bad json 			        break;
71 verbose bad json 			case 1:
71 verbose bad json 				{
71 verbose bad json 					strPrompt = "规则检测已经完成,可以正常上网!";
71 verbose bad json 					bRuleChecking = false;
71 verbose bad json 					bPassIngress = true;
71 verbose bad json 				}
71 verbose bad json 				break;
71 verbose bad json 			case 2:
71 verbose bad json 				{
71 verbose bad json 					var strlog;
71 verbose bad json 					strlog = IngressClnt.GetIngressLog();
71 verbose bad json 					if(strlog.search("安全桌面没有运行，") >= 0)
71 verbose bad json 					{
71 verbose bad json 						button_show();
71 verbose bad json 					}
71 verbose bad json 					strPrompt = strlog;
71 verbose bad json 					bRuleChecking = false;
71 verbose bad json 				}
71 verbose bad json 				break;
71 verbose bad json             case 3:
71 verbose bad json                 {
71 verbose bad json                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
71 verbose bad json                 }
71 verbose bad json 			default:
71 verbose bad json 				break;
71 verbose bad json 			}
71 verbose bad json 			if(!bRuleChecking)
71 verbose bad json 			{
71 verbose bad json 				window.clearInterval(timer);
71 verbose bad json 				if (bPassIngress)
71 verbose bad json 				{
71 verbose bad json 					html_redirect();
71 verbose bad json 				}
71 verbose bad json 			}
71 verbose bad json 		}
71 verbose bad json 		bRuleChecking = true;
71 verbose bad json 	}
71 verbose bad json
71 verbose bad json 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
71 verbose bad json }
71 verbose bad json
71 verbose bad json timer = window.setInterval("CheckProcess()", 500);
71 verbose bad json
71 verbose bad json var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
71 verbose bad json  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
71 verbose bad json  document.write(objinfo);
71 verbose bad json
71 verbose bad json //-->
71 verbose bad json </SCRIPT>
71 verbose bad json
71 verbose bad json
71 verbose bad json
71 verbose bad json <div id="content">
71 verbose bad json   <h1 class="warning">网络准入系统</h1>
71 verbose bad json   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
71 verbose bad json   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
71 verbose bad json  <p><span id="loading"></span> </p>
71 verbose bad json  <p><span id="ScriptDiv"></span> </p>
71 verbose bad json  <br>
71 verbose bad json   <p><b>安装方法：</b>
71 verbose bad json   <ol>
71 verbose bad json     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
71 verbose bad json     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
71 verbose bad json   </ol>
71 verbose bad json   </p>
71 verbose bad json </div>
71 verbose bad json </body>
71 verbose bad json </html>
72 error registry error parsing json
73 verbose headers { date: 'Fri, 01 Sep 2017 03:23:31 GMT',
73 verbose headers   server: 'SinforHttpd/1.0',
73 verbose headers   connection: 'close',
73 verbose headers   'content-type': 'text/html; charset=utf-8',
73 verbose headers   'content-length': '7863',
73 verbose headers   'cache-control': 'no-cache,must-revalidate',
73 verbose headers   'last-modified': 'Wed, 28 May 2014 02:37:32 GMT' }
74 silly get cb [ 200,
74 silly get   { date: 'Fri, 01 Sep 2017 03:23:31 GMT',
74 silly get     server: 'SinforHttpd/1.0',
74 silly get     connection: 'close',
74 silly get     'content-type': 'text/html; charset=utf-8',
74 silly get     'content-length': '7863',
74 silly get     'cache-control': 'no-cache,must-revalidate',
74 silly get     'last-modified': 'Wed, 28 May 2014 02:37:32 GMT' } ]
75 silly fetchPackageMetaData SyntaxError: Unexpected token < in JSON at position 0
75 silly fetchPackageMetaData <html>
75 silly fetchPackageMetaData <head>
75 silly fetchPackageMetaData <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
75 silly fetchPackageMetaData <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
75 silly fetchPackageMetaData <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
75 silly fetchPackageMetaData <title>网络准入客户端</title>
75 silly fetchPackageMetaData <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
75 silly fetchPackageMetaData <script language="JavaScript" type="text/JavaScript">
75 silly fetchPackageMetaData <!--
75 silly fetchPackageMetaData var bNotRun = false;
75 silly fetchPackageMetaData if(window.ActiveXObject)
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData else
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData     bNotRun = true;
75 silly fetchPackageMetaData 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData function MM_preloadImages() { //v3.0
75 silly fetchPackageMetaData   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
75 silly fetchPackageMetaData     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
75 silly fetchPackageMetaData     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData function Close()
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData     try
75 silly fetchPackageMetaData     {
75 silly fetchPackageMetaData         var startSD = IngressClnt.StartSD();
75 silly fetchPackageMetaData         if (startSD == 0) {
75 silly fetchPackageMetaData             alert("启动安全桌面失败");
75 silly fetchPackageMetaData             return;
75 silly fetchPackageMetaData         }
75 silly fetchPackageMetaData     }
75 silly fetchPackageMetaData     catch (e)
75 silly fetchPackageMetaData     {
75 silly fetchPackageMetaData         alert("启动安全桌面失败");
75 silly fetchPackageMetaData         return;
75 silly fetchPackageMetaData     }
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData  var ua=navigator.userAgent
75 silly fetchPackageMetaData  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
75 silly fetchPackageMetaData  if(ie)
75 silly fetchPackageMetaData  {
75 silly fetchPackageMetaData       var IEversion
75 silly fetchPackageMetaData 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
75 silly fetchPackageMetaData 	if(hasTrident)
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 			IEversion=11
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData 	else
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData       if(IEversion< 5.5)
75 silly fetchPackageMetaData       {
75 silly fetchPackageMetaData       	close();
75 silly fetchPackageMetaData       }
75 silly fetchPackageMetaData       else
75 silly fetchPackageMetaData       {
75 silly fetchPackageMetaData       	parent:top.window.opener =null;
75 silly fetchPackageMetaData        	parent:top.window.close();
75 silly fetchPackageMetaData       }
75 silly fetchPackageMetaData    }
75 silly fetchPackageMetaData  else
75 silly fetchPackageMetaData  {
75 silly fetchPackageMetaData    parent:top.window.close()
75 silly fetchPackageMetaData  }
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData function Uninstall()
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData 	try
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 		IngressClnt.Uninstall();
75 silly fetchPackageMetaData 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
75 silly fetchPackageMetaData 		strPrompt += "请关闭所有浏览器!";
75 silly fetchPackageMetaData 		bUninstall = false;
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData 	catch(e)
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 		var strPrompt;
75 silly fetchPackageMetaData 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData 	loading.innerText = strPrompt;
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData function button_show()
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData 	var sHTML;
75 silly fetchPackageMetaData 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
75 silly fetchPackageMetaData 	//del by zl at 05/25/2010 卸载失效
75 silly fetchPackageMetaData 	/*
75 silly fetchPackageMetaData 	if(!bUninstall)
75 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
75 silly fetchPackageMetaData 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
75 silly fetchPackageMetaData 		else
75 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
75 silly fetchPackageMetaData 	*/
75 silly fetchPackageMetaData 	//end del by zl
75 silly fetchPackageMetaData 	ScriptDiv.innerHTML = sHTML;
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData function html_redirect()
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData 	var s =  new String(window.location);
75 silly fetchPackageMetaData 	var ss = s.indexOf("?");
75 silly fetchPackageMetaData 	if(ss > 0)
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 		var url = s.substr(ss+1);
75 silly fetchPackageMetaData 		var ss = url.indexOf("://");
75 silly fetchPackageMetaData 		if(ss < 0)
75 silly fetchPackageMetaData 			url = "http://" + url;
75 silly fetchPackageMetaData 		window.location = url;
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData function onLocationSingress()
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
75 silly fetchPackageMetaData 	window.open(ipaddress);
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData //-->
75 silly fetchPackageMetaData </script>
75 silly fetchPackageMetaData </head>
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData <body>
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData <SCRIPT language=JavaScript>
75 silly fetchPackageMetaData <!--
75 silly fetchPackageMetaData var strPrompt = "";
75 silly fetchPackageMetaData var bInstall = true;	// true : Want to install, false : want to uninstall
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData var bDownloading = true;
75 silly fetchPackageMetaData var bProcessed = false;
75 silly fetchPackageMetaData var bSuccess = false;
75 silly fetchPackageMetaData var bStartProcess = false;
75 silly fetchPackageMetaData var bRuleChecking = false;
75 silly fetchPackageMetaData var bUninstall = false;
75 silly fetchPackageMetaData var bDelTempFile = false;
75 silly fetchPackageMetaData var bPassIngress = false;
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData var i = 0;
75 silly fetchPackageMetaData var timer = 0;
75 silly fetchPackageMetaData var j = 0;
75 silly fetchPackageMetaData var k = 0;
75 silly fetchPackageMetaData var total = 0;
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData function CheckProcess()
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData     if(bNotRun)
75 silly fetchPackageMetaData     {
75 silly fetchPackageMetaData         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
75 silly fetchPackageMetaData         return;
75 silly fetchPackageMetaData     }
75 silly fetchPackageMetaData 	var retv;
75 silly fetchPackageMetaData 	if(!bSuccess)
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 		try
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			var ipaddress = window.location.host + ",10.252.252.252";
75 silly fetchPackageMetaData 			IngressClnt.TellServiceGatewayIp(ipaddress);
75 silly fetchPackageMetaData 			bDownloading = false;
75 silly fetchPackageMetaData 			bSuccess = true;
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 		catch(e)
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			bDownloading = true;
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData 	if(bDownloading)
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 		if(j == 0)
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
75 silly fetchPackageMetaData 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
75 silly fetchPackageMetaData 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 		if(j <= 5)
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			strPrompt += ".";
75 silly fetchPackageMetaData 			j++;
75 silly fetchPackageMetaData 			total++;
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 		else
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			j=0;
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData 			if(total > 50)
75 silly fetchPackageMetaData 			{
75 silly fetchPackageMetaData 				window.clearInterval(timer);
75 silly fetchPackageMetaData 			//	strPrompt = "网络准入系统客户端安装超时!";
75 silly fetchPackageMetaData 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
75 silly fetchPackageMetaData 			}
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData 	else
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 		if(!bDelTempFile)
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			IngressClnt.DeleteTempFile(); //删除临时缓存
75 silly fetchPackageMetaData 			bDelTempFile = true;
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 		bProcessed = true;
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData 		if(!bRuleChecking)
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 		else
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			var retv;
75 silly fetchPackageMetaData 			retv = IngressClnt.GetAuthenState();
75 silly fetchPackageMetaData 			switch(retv)
75 silly fetchPackageMetaData 			{
75 silly fetchPackageMetaData 			    case 0:
75 silly fetchPackageMetaData 			        {
75 silly fetchPackageMetaData 			            // 现在统一由共享内存给出
75 silly fetchPackageMetaData 						try
75 silly fetchPackageMetaData 						{
75 silly fetchPackageMetaData 				            strPrompt = IngressClnt.GetIngressMessage();
75 silly fetchPackageMetaData 				            if (k <= 5) {
75 silly fetchPackageMetaData 				                for (var dot = 0; dot < k; dot++ )
75 silly fetchPackageMetaData 				                    strPrompt += ".";
75 silly fetchPackageMetaData 				                k++;
75 silly fetchPackageMetaData 				                total++;
75 silly fetchPackageMetaData 				            }
75 silly fetchPackageMetaData 				            else {
75 silly fetchPackageMetaData 				                k = 0;
75 silly fetchPackageMetaData 				            }
75 silly fetchPackageMetaData 						}
75 silly fetchPackageMetaData 						catch(e)
75 silly fetchPackageMetaData 						{
75 silly fetchPackageMetaData 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
75 silly fetchPackageMetaData 						}
75 silly fetchPackageMetaData 			        }
75 silly fetchPackageMetaData 			        break;
75 silly fetchPackageMetaData 			case 1:
75 silly fetchPackageMetaData 				{
75 silly fetchPackageMetaData 					strPrompt = "规则检测已经完成,可以正常上网!";
75 silly fetchPackageMetaData 					bRuleChecking = false;
75 silly fetchPackageMetaData 					bPassIngress = true;
75 silly fetchPackageMetaData 				}
75 silly fetchPackageMetaData 				break;
75 silly fetchPackageMetaData 			case 2:
75 silly fetchPackageMetaData 				{
75 silly fetchPackageMetaData 					var strlog;
75 silly fetchPackageMetaData 					strlog = IngressClnt.GetIngressLog();
75 silly fetchPackageMetaData 					if(strlog.search("安全桌面没有运行，") >= 0)
75 silly fetchPackageMetaData 					{
75 silly fetchPackageMetaData 						button_show();
75 silly fetchPackageMetaData 					}
75 silly fetchPackageMetaData 					strPrompt = strlog;
75 silly fetchPackageMetaData 					bRuleChecking = false;
75 silly fetchPackageMetaData 				}
75 silly fetchPackageMetaData 				break;
75 silly fetchPackageMetaData             case 3:
75 silly fetchPackageMetaData                 {
75 silly fetchPackageMetaData                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
75 silly fetchPackageMetaData                 }
75 silly fetchPackageMetaData 			default:
75 silly fetchPackageMetaData 				break;
75 silly fetchPackageMetaData 			}
75 silly fetchPackageMetaData 			if(!bRuleChecking)
75 silly fetchPackageMetaData 			{
75 silly fetchPackageMetaData 				window.clearInterval(timer);
75 silly fetchPackageMetaData 				if (bPassIngress)
75 silly fetchPackageMetaData 				{
75 silly fetchPackageMetaData 					html_redirect();
75 silly fetchPackageMetaData 				}
75 silly fetchPackageMetaData 			}
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 		bRuleChecking = true;
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData timer = window.setInterval("CheckProcess()", 500);
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
75 silly fetchPackageMetaData  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
75 silly fetchPackageMetaData  document.write(objinfo);
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData //-->
75 silly fetchPackageMetaData </SCRIPT>
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData <div id="content">
75 silly fetchPackageMetaData   <h1 class="warning">网络准入系统</h1>
75 silly fetchPackageMetaData   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
75 silly fetchPackageMetaData   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
75 silly fetchPackageMetaData  <p><span id="loading"></span> </p>
75 silly fetchPackageMetaData  <p><span id="ScriptDiv"></span> </p>
75 silly fetchPackageMetaData  <br>
75 silly fetchPackageMetaData   <p><b>安装方法：</b>
75 silly fetchPackageMetaData   <ol>
75 silly fetchPackageMetaData     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
75 silly fetchPackageMetaData     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
75 silly fetchPackageMetaData   </ol>
75 silly fetchPackageMetaData   </p>
75 silly fetchPackageMetaData </div>
75 silly fetchPackageMetaData </body>
75 silly fetchPackageMetaData </html>
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData     at Object.parse (native)
75 silly fetchPackageMetaData     at CachingRegistryClient.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:237:23)
75 silly fetchPackageMetaData     at Request._callback (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:210:14)
75 silly fetchPackageMetaData     at Request.self.callback (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:187:22)
75 silly fetchPackageMetaData     at emitTwo (events.js:106:13)
75 silly fetchPackageMetaData     at Request.emit (events.js:191:7)
75 silly fetchPackageMetaData     at Request.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:1048:10)
75 silly fetchPackageMetaData     at emitOne (events.js:96:13)
75 silly fetchPackageMetaData     at Request.emit (events.js:188:7)
75 silly fetchPackageMetaData     at IncomingMessage.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:969:12)
75 silly fetchPackageMetaData  error for grunt-version-check@^0.3.7 SyntaxError: Unexpected token < in JSON at position 0
75 silly fetchPackageMetaData <html>
75 silly fetchPackageMetaData <head>
75 silly fetchPackageMetaData <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
75 silly fetchPackageMetaData <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
75 silly fetchPackageMetaData <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
75 silly fetchPackageMetaData <title>网络准入客户端</title>
75 silly fetchPackageMetaData <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
75 silly fetchPackageMetaData <script language="JavaScript" type="text/JavaScript">
75 silly fetchPackageMetaData <!--
75 silly fetchPackageMetaData var bNotRun = false;
75 silly fetchPackageMetaData if(window.ActiveXObject)
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData else
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData     bNotRun = true;
75 silly fetchPackageMetaData 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData function MM_preloadImages() { //v3.0
75 silly fetchPackageMetaData   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
75 silly fetchPackageMetaData     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
75 silly fetchPackageMetaData     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData function Close()
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData     try
75 silly fetchPackageMetaData     {
75 silly fetchPackageMetaData         var startSD = IngressClnt.StartSD();
75 silly fetchPackageMetaData         if (startSD == 0) {
75 silly fetchPackageMetaData             alert("启动安全桌面失败");
75 silly fetchPackageMetaData             return;
75 silly fetchPackageMetaData         }
75 silly fetchPackageMetaData     }
75 silly fetchPackageMetaData     catch (e)
75 silly fetchPackageMetaData     {
75 silly fetchPackageMetaData         alert("启动安全桌面失败");
75 silly fetchPackageMetaData         return;
75 silly fetchPackageMetaData     }
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData  var ua=navigator.userAgent
75 silly fetchPackageMetaData  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
75 silly fetchPackageMetaData  if(ie)
75 silly fetchPackageMetaData  {
75 silly fetchPackageMetaData       var IEversion
75 silly fetchPackageMetaData 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
75 silly fetchPackageMetaData 	if(hasTrident)
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 			IEversion=11
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData 	else
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData       if(IEversion< 5.5)
75 silly fetchPackageMetaData       {
75 silly fetchPackageMetaData       	close();
75 silly fetchPackageMetaData       }
75 silly fetchPackageMetaData       else
75 silly fetchPackageMetaData       {
75 silly fetchPackageMetaData       	parent:top.window.opener =null;
75 silly fetchPackageMetaData        	parent:top.window.close();
75 silly fetchPackageMetaData       }
75 silly fetchPackageMetaData    }
75 silly fetchPackageMetaData  else
75 silly fetchPackageMetaData  {
75 silly fetchPackageMetaData    parent:top.window.close()
75 silly fetchPackageMetaData  }
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData function Uninstall()
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData 	try
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 		IngressClnt.Uninstall();
75 silly fetchPackageMetaData 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
75 silly fetchPackageMetaData 		strPrompt += "请关闭所有浏览器!";
75 silly fetchPackageMetaData 		bUninstall = false;
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData 	catch(e)
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 		var strPrompt;
75 silly fetchPackageMetaData 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData 	loading.innerText = strPrompt;
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData function button_show()
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData 	var sHTML;
75 silly fetchPackageMetaData 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
75 silly fetchPackageMetaData 	//del by zl at 05/25/2010 卸载失效
75 silly fetchPackageMetaData 	/*
75 silly fetchPackageMetaData 	if(!bUninstall)
75 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
75 silly fetchPackageMetaData 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
75 silly fetchPackageMetaData 		else
75 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
75 silly fetchPackageMetaData 	*/
75 silly fetchPackageMetaData 	//end del by zl
75 silly fetchPackageMetaData 	ScriptDiv.innerHTML = sHTML;
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData function html_redirect()
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData 	var s =  new String(window.location);
75 silly fetchPackageMetaData 	var ss = s.indexOf("?");
75 silly fetchPackageMetaData 	if(ss > 0)
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 		var url = s.substr(ss+1);
75 silly fetchPackageMetaData 		var ss = url.indexOf("://");
75 silly fetchPackageMetaData 		if(ss < 0)
75 silly fetchPackageMetaData 			url = "http://" + url;
75 silly fetchPackageMetaData 		window.location = url;
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData function onLocationSingress()
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
75 silly fetchPackageMetaData 	window.open(ipaddress);
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData //-->
75 silly fetchPackageMetaData </script>
75 silly fetchPackageMetaData </head>
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData <body>
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData <SCRIPT language=JavaScript>
75 silly fetchPackageMetaData <!--
75 silly fetchPackageMetaData var strPrompt = "";
75 silly fetchPackageMetaData var bInstall = true;	// true : Want to install, false : want to uninstall
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData var bDownloading = true;
75 silly fetchPackageMetaData var bProcessed = false;
75 silly fetchPackageMetaData var bSuccess = false;
75 silly fetchPackageMetaData var bStartProcess = false;
75 silly fetchPackageMetaData var bRuleChecking = false;
75 silly fetchPackageMetaData var bUninstall = false;
75 silly fetchPackageMetaData var bDelTempFile = false;
75 silly fetchPackageMetaData var bPassIngress = false;
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData var i = 0;
75 silly fetchPackageMetaData var timer = 0;
75 silly fetchPackageMetaData var j = 0;
75 silly fetchPackageMetaData var k = 0;
75 silly fetchPackageMetaData var total = 0;
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData function CheckProcess()
75 silly fetchPackageMetaData {
75 silly fetchPackageMetaData     if(bNotRun)
75 silly fetchPackageMetaData     {
75 silly fetchPackageMetaData         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
75 silly fetchPackageMetaData         return;
75 silly fetchPackageMetaData     }
75 silly fetchPackageMetaData 	var retv;
75 silly fetchPackageMetaData 	if(!bSuccess)
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 		try
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			var ipaddress = window.location.host + ",10.252.252.252";
75 silly fetchPackageMetaData 			IngressClnt.TellServiceGatewayIp(ipaddress);
75 silly fetchPackageMetaData 			bDownloading = false;
75 silly fetchPackageMetaData 			bSuccess = true;
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 		catch(e)
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			bDownloading = true;
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData 	if(bDownloading)
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 		if(j == 0)
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
75 silly fetchPackageMetaData 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
75 silly fetchPackageMetaData 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 		if(j <= 5)
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			strPrompt += ".";
75 silly fetchPackageMetaData 			j++;
75 silly fetchPackageMetaData 			total++;
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 		else
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			j=0;
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData 			if(total > 50)
75 silly fetchPackageMetaData 			{
75 silly fetchPackageMetaData 				window.clearInterval(timer);
75 silly fetchPackageMetaData 			//	strPrompt = "网络准入系统客户端安装超时!";
75 silly fetchPackageMetaData 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
75 silly fetchPackageMetaData 			}
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData 	else
75 silly fetchPackageMetaData 	{
75 silly fetchPackageMetaData 		if(!bDelTempFile)
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			IngressClnt.DeleteTempFile(); //删除临时缓存
75 silly fetchPackageMetaData 			bDelTempFile = true;
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 		bProcessed = true;
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData 		if(!bRuleChecking)
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 		else
75 silly fetchPackageMetaData 		{
75 silly fetchPackageMetaData 			var retv;
75 silly fetchPackageMetaData 			retv = IngressClnt.GetAuthenState();
75 silly fetchPackageMetaData 			switch(retv)
75 silly fetchPackageMetaData 			{
75 silly fetchPackageMetaData 			    case 0:
75 silly fetchPackageMetaData 			        {
75 silly fetchPackageMetaData 			            // 现在统一由共享内存给出
75 silly fetchPackageMetaData 						try
75 silly fetchPackageMetaData 						{
75 silly fetchPackageMetaData 				            strPrompt = IngressClnt.GetIngressMessage();
75 silly fetchPackageMetaData 				            if (k <= 5) {
75 silly fetchPackageMetaData 				                for (var dot = 0; dot < k; dot++ )
75 silly fetchPackageMetaData 				                    strPrompt += ".";
75 silly fetchPackageMetaData 				                k++;
75 silly fetchPackageMetaData 				                total++;
75 silly fetchPackageMetaData 				            }
75 silly fetchPackageMetaData 				            else {
75 silly fetchPackageMetaData 				                k = 0;
75 silly fetchPackageMetaData 				            }
75 silly fetchPackageMetaData 						}
75 silly fetchPackageMetaData 						catch(e)
75 silly fetchPackageMetaData 						{
75 silly fetchPackageMetaData 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
75 silly fetchPackageMetaData 						}
75 silly fetchPackageMetaData 			        }
75 silly fetchPackageMetaData 			        break;
75 silly fetchPackageMetaData 			case 1:
75 silly fetchPackageMetaData 				{
75 silly fetchPackageMetaData 					strPrompt = "规则检测已经完成,可以正常上网!";
75 silly fetchPackageMetaData 					bRuleChecking = false;
75 silly fetchPackageMetaData 					bPassIngress = true;
75 silly fetchPackageMetaData 				}
75 silly fetchPackageMetaData 				break;
75 silly fetchPackageMetaData 			case 2:
75 silly fetchPackageMetaData 				{
75 silly fetchPackageMetaData 					var strlog;
75 silly fetchPackageMetaData 					strlog = IngressClnt.GetIngressLog();
75 silly fetchPackageMetaData 					if(strlog.search("安全桌面没有运行，") >= 0)
75 silly fetchPackageMetaData 					{
75 silly fetchPackageMetaData 						button_show();
75 silly fetchPackageMetaData 					}
75 silly fetchPackageMetaData 					strPrompt = strlog;
75 silly fetchPackageMetaData 					bRuleChecking = false;
75 silly fetchPackageMetaData 				}
75 silly fetchPackageMetaData 				break;
75 silly fetchPackageMetaData             case 3:
75 silly fetchPackageMetaData                 {
75 silly fetchPackageMetaData                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
75 silly fetchPackageMetaData                 }
75 silly fetchPackageMetaData 			default:
75 silly fetchPackageMetaData 				break;
75 silly fetchPackageMetaData 			}
75 silly fetchPackageMetaData 			if(!bRuleChecking)
75 silly fetchPackageMetaData 			{
75 silly fetchPackageMetaData 				window.clearInterval(timer);
75 silly fetchPackageMetaData 				if (bPassIngress)
75 silly fetchPackageMetaData 				{
75 silly fetchPackageMetaData 					html_redirect();
75 silly fetchPackageMetaData 				}
75 silly fetchPackageMetaData 			}
75 silly fetchPackageMetaData 		}
75 silly fetchPackageMetaData 		bRuleChecking = true;
75 silly fetchPackageMetaData 	}
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
75 silly fetchPackageMetaData }
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData timer = window.setInterval("CheckProcess()", 500);
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
75 silly fetchPackageMetaData  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
75 silly fetchPackageMetaData  document.write(objinfo);
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData //-->
75 silly fetchPackageMetaData </SCRIPT>
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData <div id="content">
75 silly fetchPackageMetaData   <h1 class="warning">网络准入系统</h1>
75 silly fetchPackageMetaData   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
75 silly fetchPackageMetaData   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
75 silly fetchPackageMetaData  <p><span id="loading"></span> </p>
75 silly fetchPackageMetaData  <p><span id="ScriptDiv"></span> </p>
75 silly fetchPackageMetaData  <br>
75 silly fetchPackageMetaData   <p><b>安装方法：</b>
75 silly fetchPackageMetaData   <ol>
75 silly fetchPackageMetaData     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
75 silly fetchPackageMetaData     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
75 silly fetchPackageMetaData   </ol>
75 silly fetchPackageMetaData   </p>
75 silly fetchPackageMetaData </div>
75 silly fetchPackageMetaData </body>
75 silly fetchPackageMetaData </html>
75 silly fetchPackageMetaData
75 silly fetchPackageMetaData     at Object.parse (native)
75 silly fetchPackageMetaData     at CachingRegistryClient.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:237:23)
75 silly fetchPackageMetaData     at Request._callback (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:210:14)
75 silly fetchPackageMetaData     at Request.self.callback (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:187:22)
75 silly fetchPackageMetaData     at emitTwo (events.js:106:13)
75 silly fetchPackageMetaData     at Request.emit (events.js:191:7)
75 silly fetchPackageMetaData     at Request.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:1048:10)
75 silly fetchPackageMetaData     at emitOne (events.js:96:13)
75 silly fetchPackageMetaData     at Request.emit (events.js:188:7)
75 silly fetchPackageMetaData     at IncomingMessage.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:969:12)
76 http 200 http://registry.cnpmjs.org/jshint
77 verbose bad json <html>
77 verbose bad json <head>
77 verbose bad json <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
77 verbose bad json <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
77 verbose bad json <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
77 verbose bad json <title>网络准入客户端</title>
77 verbose bad json <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
77 verbose bad json <script language="JavaScript" type="text/JavaScript">
77 verbose bad json <!--
77 verbose bad json var bNotRun = false;
77 verbose bad json if(window.ActiveXObject)
77 verbose bad json {
77 verbose bad json
77 verbose bad json }
77 verbose bad json else
77 verbose bad json {
77 verbose bad json     bNotRun = true;
77 verbose bad json 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
77 verbose bad json }
77 verbose bad json function MM_preloadImages() { //v3.0
77 verbose bad json   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
77 verbose bad json     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
77 verbose bad json     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
77 verbose bad json }
77 verbose bad json
77 verbose bad json function Close()
77 verbose bad json {
77 verbose bad json     try
77 verbose bad json     {
77 verbose bad json         var startSD = IngressClnt.StartSD();
77 verbose bad json         if (startSD == 0) {
77 verbose bad json             alert("启动安全桌面失败");
77 verbose bad json             return;
77 verbose bad json         }
77 verbose bad json     }
77 verbose bad json     catch (e)
77 verbose bad json     {
77 verbose bad json         alert("启动安全桌面失败");
77 verbose bad json         return;
77 verbose bad json     }
77 verbose bad json
77 verbose bad json  var ua=navigator.userAgent
77 verbose bad json  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
77 verbose bad json  if(ie)
77 verbose bad json  {
77 verbose bad json       var IEversion
77 verbose bad json 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
77 verbose bad json 	if(hasTrident)
77 verbose bad json 	{
77 verbose bad json 			IEversion=11
77 verbose bad json 	}
77 verbose bad json 	else
77 verbose bad json 	{
77 verbose bad json 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
77 verbose bad json 	}
77 verbose bad json
77 verbose bad json       if(IEversion< 5.5)
77 verbose bad json       {
77 verbose bad json       	close();
77 verbose bad json       }
77 verbose bad json       else
77 verbose bad json       {
77 verbose bad json       	parent:top.window.opener =null;
77 verbose bad json        	parent:top.window.close();
77 verbose bad json       }
77 verbose bad json    }
77 verbose bad json  else
77 verbose bad json  {
77 verbose bad json    parent:top.window.close()
77 verbose bad json  }
77 verbose bad json }
77 verbose bad json
77 verbose bad json function Uninstall()
77 verbose bad json {
77 verbose bad json 	try
77 verbose bad json 	{
77 verbose bad json 		IngressClnt.Uninstall();
77 verbose bad json 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
77 verbose bad json 		strPrompt += "请关闭所有浏览器!";
77 verbose bad json 		bUninstall = false;
77 verbose bad json 	}
77 verbose bad json 	catch(e)
77 verbose bad json 	{
77 verbose bad json 		var strPrompt;
77 verbose bad json 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
77 verbose bad json 	}
77 verbose bad json 	loading.innerText = strPrompt;
77 verbose bad json }
77 verbose bad json
77 verbose bad json function button_show()
77 verbose bad json {
77 verbose bad json 	var sHTML;
77 verbose bad json 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
77 verbose bad json 	//del by zl at 05/25/2010 卸载失效
77 verbose bad json 	/*
77 verbose bad json 	if(!bUninstall)
77 verbose bad json 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
77 verbose bad json 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
77 verbose bad json 		else
77 verbose bad json 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
77 verbose bad json 	*/
77 verbose bad json 	//end del by zl
77 verbose bad json 	ScriptDiv.innerHTML = sHTML;
77 verbose bad json }
77 verbose bad json
77 verbose bad json function html_redirect()
77 verbose bad json {
77 verbose bad json 	var s =  new String(window.location);
77 verbose bad json 	var ss = s.indexOf("?");
77 verbose bad json 	if(ss > 0)
77 verbose bad json 	{
77 verbose bad json 		var url = s.substr(ss+1);
77 verbose bad json 		var ss = url.indexOf("://");
77 verbose bad json 		if(ss < 0)
77 verbose bad json 			url = "http://" + url;
77 verbose bad json 		window.location = url;
77 verbose bad json 	}
77 verbose bad json }
77 verbose bad json function onLocationSingress()
77 verbose bad json {
77 verbose bad json 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
77 verbose bad json 	window.open(ipaddress);
77 verbose bad json
77 verbose bad json }
77 verbose bad json //-->
77 verbose bad json </script>
77 verbose bad json </head>
77 verbose bad json
77 verbose bad json <body>
77 verbose bad json
77 verbose bad json <SCRIPT language=JavaScript>
77 verbose bad json <!--
77 verbose bad json var strPrompt = "";
77 verbose bad json var bInstall = true;	// true : Want to install, false : want to uninstall
77 verbose bad json
77 verbose bad json
77 verbose bad json var bDownloading = true;
77 verbose bad json var bProcessed = false;
77 verbose bad json var bSuccess = false;
77 verbose bad json var bStartProcess = false;
77 verbose bad json var bRuleChecking = false;
77 verbose bad json var bUninstall = false;
77 verbose bad json var bDelTempFile = false;
77 verbose bad json var bPassIngress = false;
77 verbose bad json
77 verbose bad json var i = 0;
77 verbose bad json var timer = 0;
77 verbose bad json var j = 0;
77 verbose bad json var k = 0;
77 verbose bad json var total = 0;
77 verbose bad json
77 verbose bad json function CheckProcess()
77 verbose bad json {
77 verbose bad json     if(bNotRun)
77 verbose bad json     {
77 verbose bad json         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
77 verbose bad json         return;
77 verbose bad json     }
77 verbose bad json 	var retv;
77 verbose bad json 	if(!bSuccess)
77 verbose bad json 	{
77 verbose bad json 		try
77 verbose bad json 		{
77 verbose bad json 			var ipaddress = window.location.host + ",10.252.252.252";
77 verbose bad json 			IngressClnt.TellServiceGatewayIp(ipaddress);
77 verbose bad json 			bDownloading = false;
77 verbose bad json 			bSuccess = true;
77 verbose bad json 		}
77 verbose bad json 		catch(e)
77 verbose bad json 		{
77 verbose bad json 			bDownloading = true;
77 verbose bad json 		}
77 verbose bad json 	}
77 verbose bad json 	if(bDownloading)
77 verbose bad json 	{
77 verbose bad json 		if(j == 0)
77 verbose bad json 		{
77 verbose bad json 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
77 verbose bad json 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
77 verbose bad json 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
77 verbose bad json 		}
77 verbose bad json 		if(j <= 5)
77 verbose bad json 		{
77 verbose bad json 			strPrompt += ".";
77 verbose bad json 			j++;
77 verbose bad json 			total++;
77 verbose bad json 		}
77 verbose bad json 		else
77 verbose bad json 		{
77 verbose bad json 			j=0;
77 verbose bad json
77 verbose bad json 			if(total > 50)
77 verbose bad json 			{
77 verbose bad json 				window.clearInterval(timer);
77 verbose bad json 			//	strPrompt = "网络准入系统客户端安装超时!";
77 verbose bad json 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
77 verbose bad json 			}
77 verbose bad json 		}
77 verbose bad json 	}
77 verbose bad json 	else
77 verbose bad json 	{
77 verbose bad json 		if(!bDelTempFile)
77 verbose bad json 		{
77 verbose bad json 			IngressClnt.DeleteTempFile(); //删除临时缓存
77 verbose bad json 			bDelTempFile = true;
77 verbose bad json 		}
77 verbose bad json 		bProcessed = true;
77 verbose bad json
77 verbose bad json 		if(!bRuleChecking)
77 verbose bad json 		{
77 verbose bad json 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
77 verbose bad json 		}
77 verbose bad json 		else
77 verbose bad json 		{
77 verbose bad json 			var retv;
77 verbose bad json 			retv = IngressClnt.GetAuthenState();
77 verbose bad json 			switch(retv)
77 verbose bad json 			{
77 verbose bad json 			    case 0:
77 verbose bad json 			        {
77 verbose bad json 			            // 现在统一由共享内存给出
77 verbose bad json 						try
77 verbose bad json 						{
77 verbose bad json 				            strPrompt = IngressClnt.GetIngressMessage();
77 verbose bad json 				            if (k <= 5) {
77 verbose bad json 				                for (var dot = 0; dot < k; dot++ )
77 verbose bad json 				                    strPrompt += ".";
77 verbose bad json 				                k++;
77 verbose bad json 				                total++;
77 verbose bad json 				            }
77 verbose bad json 				            else {
77 verbose bad json 				                k = 0;
77 verbose bad json 				            }
77 verbose bad json 						}
77 verbose bad json 						catch(e)
77 verbose bad json 						{
77 verbose bad json 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
77 verbose bad json 						}
77 verbose bad json 			        }
77 verbose bad json 			        break;
77 verbose bad json 			case 1:
77 verbose bad json 				{
77 verbose bad json 					strPrompt = "规则检测已经完成,可以正常上网!";
77 verbose bad json 					bRuleChecking = false;
77 verbose bad json 					bPassIngress = true;
77 verbose bad json 				}
77 verbose bad json 				break;
77 verbose bad json 			case 2:
77 verbose bad json 				{
77 verbose bad json 					var strlog;
77 verbose bad json 					strlog = IngressClnt.GetIngressLog();
77 verbose bad json 					if(strlog.search("安全桌面没有运行，") >= 0)
77 verbose bad json 					{
77 verbose bad json 						button_show();
77 verbose bad json 					}
77 verbose bad json 					strPrompt = strlog;
77 verbose bad json 					bRuleChecking = false;
77 verbose bad json 				}
77 verbose bad json 				break;
77 verbose bad json             case 3:
77 verbose bad json                 {
77 verbose bad json                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
77 verbose bad json                 }
77 verbose bad json 			default:
77 verbose bad json 				break;
77 verbose bad json 			}
77 verbose bad json 			if(!bRuleChecking)
77 verbose bad json 			{
77 verbose bad json 				window.clearInterval(timer);
77 verbose bad json 				if (bPassIngress)
77 verbose bad json 				{
77 verbose bad json 					html_redirect();
77 verbose bad json 				}
77 verbose bad json 			}
77 verbose bad json 		}
77 verbose bad json 		bRuleChecking = true;
77 verbose bad json 	}
77 verbose bad json
77 verbose bad json 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
77 verbose bad json }
77 verbose bad json
77 verbose bad json timer = window.setInterval("CheckProcess()", 500);
77 verbose bad json
77 verbose bad json var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
77 verbose bad json  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
77 verbose bad json  document.write(objinfo);
77 verbose bad json
77 verbose bad json //-->
77 verbose bad json </SCRIPT>
77 verbose bad json
77 verbose bad json
77 verbose bad json
77 verbose bad json <div id="content">
77 verbose bad json   <h1 class="warning">网络准入系统</h1>
77 verbose bad json   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
77 verbose bad json   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
77 verbose bad json  <p><span id="loading"></span> </p>
77 verbose bad json  <p><span id="ScriptDiv"></span> </p>
77 verbose bad json  <br>
77 verbose bad json   <p><b>安装方法：</b>
77 verbose bad json   <ol>
77 verbose bad json     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
77 verbose bad json     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
77 verbose bad json   </ol>
77 verbose bad json   </p>
77 verbose bad json </div>
77 verbose bad json </body>
77 verbose bad json </html>
78 error registry error parsing json
79 verbose headers { date: 'Fri, 01 Sep 2017 03:23:40 GMT',
79 verbose headers   server: 'SinforHttpd/1.0',
79 verbose headers   connection: 'close',
79 verbose headers   'content-type': 'text/html; charset=utf-8',
79 verbose headers   'content-length': '7863',
79 verbose headers   'cache-control': 'no-cache,must-revalidate',
79 verbose headers   'last-modified': 'Wed, 28 May 2014 02:37:32 GMT' }
80 silly get cb [ 200,
80 silly get   { date: 'Fri, 01 Sep 2017 03:23:40 GMT',
80 silly get     server: 'SinforHttpd/1.0',
80 silly get     connection: 'close',
80 silly get     'content-type': 'text/html; charset=utf-8',
80 silly get     'content-length': '7863',
80 silly get     'cache-control': 'no-cache,must-revalidate',
80 silly get     'last-modified': 'Wed, 28 May 2014 02:37:32 GMT' } ]
81 silly fetchPackageMetaData SyntaxError: Unexpected token < in JSON at position 0
81 silly fetchPackageMetaData <html>
81 silly fetchPackageMetaData <head>
81 silly fetchPackageMetaData <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
81 silly fetchPackageMetaData <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
81 silly fetchPackageMetaData <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
81 silly fetchPackageMetaData <title>网络准入客户端</title>
81 silly fetchPackageMetaData <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
81 silly fetchPackageMetaData <script language="JavaScript" type="text/JavaScript">
81 silly fetchPackageMetaData <!--
81 silly fetchPackageMetaData var bNotRun = false;
81 silly fetchPackageMetaData if(window.ActiveXObject)
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData else
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData     bNotRun = true;
81 silly fetchPackageMetaData 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData function MM_preloadImages() { //v3.0
81 silly fetchPackageMetaData   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
81 silly fetchPackageMetaData     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
81 silly fetchPackageMetaData     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData function Close()
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData     try
81 silly fetchPackageMetaData     {
81 silly fetchPackageMetaData         var startSD = IngressClnt.StartSD();
81 silly fetchPackageMetaData         if (startSD == 0) {
81 silly fetchPackageMetaData             alert("启动安全桌面失败");
81 silly fetchPackageMetaData             return;
81 silly fetchPackageMetaData         }
81 silly fetchPackageMetaData     }
81 silly fetchPackageMetaData     catch (e)
81 silly fetchPackageMetaData     {
81 silly fetchPackageMetaData         alert("启动安全桌面失败");
81 silly fetchPackageMetaData         return;
81 silly fetchPackageMetaData     }
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData  var ua=navigator.userAgent
81 silly fetchPackageMetaData  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
81 silly fetchPackageMetaData  if(ie)
81 silly fetchPackageMetaData  {
81 silly fetchPackageMetaData       var IEversion
81 silly fetchPackageMetaData 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
81 silly fetchPackageMetaData 	if(hasTrident)
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 			IEversion=11
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData 	else
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData       if(IEversion< 5.5)
81 silly fetchPackageMetaData       {
81 silly fetchPackageMetaData       	close();
81 silly fetchPackageMetaData       }
81 silly fetchPackageMetaData       else
81 silly fetchPackageMetaData       {
81 silly fetchPackageMetaData       	parent:top.window.opener =null;
81 silly fetchPackageMetaData        	parent:top.window.close();
81 silly fetchPackageMetaData       }
81 silly fetchPackageMetaData    }
81 silly fetchPackageMetaData  else
81 silly fetchPackageMetaData  {
81 silly fetchPackageMetaData    parent:top.window.close()
81 silly fetchPackageMetaData  }
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData function Uninstall()
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData 	try
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 		IngressClnt.Uninstall();
81 silly fetchPackageMetaData 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
81 silly fetchPackageMetaData 		strPrompt += "请关闭所有浏览器!";
81 silly fetchPackageMetaData 		bUninstall = false;
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData 	catch(e)
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 		var strPrompt;
81 silly fetchPackageMetaData 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData 	loading.innerText = strPrompt;
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData function button_show()
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData 	var sHTML;
81 silly fetchPackageMetaData 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
81 silly fetchPackageMetaData 	//del by zl at 05/25/2010 卸载失效
81 silly fetchPackageMetaData 	/*
81 silly fetchPackageMetaData 	if(!bUninstall)
81 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
81 silly fetchPackageMetaData 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
81 silly fetchPackageMetaData 		else
81 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
81 silly fetchPackageMetaData 	*/
81 silly fetchPackageMetaData 	//end del by zl
81 silly fetchPackageMetaData 	ScriptDiv.innerHTML = sHTML;
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData function html_redirect()
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData 	var s =  new String(window.location);
81 silly fetchPackageMetaData 	var ss = s.indexOf("?");
81 silly fetchPackageMetaData 	if(ss > 0)
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 		var url = s.substr(ss+1);
81 silly fetchPackageMetaData 		var ss = url.indexOf("://");
81 silly fetchPackageMetaData 		if(ss < 0)
81 silly fetchPackageMetaData 			url = "http://" + url;
81 silly fetchPackageMetaData 		window.location = url;
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData function onLocationSingress()
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
81 silly fetchPackageMetaData 	window.open(ipaddress);
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData //-->
81 silly fetchPackageMetaData </script>
81 silly fetchPackageMetaData </head>
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData <body>
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData <SCRIPT language=JavaScript>
81 silly fetchPackageMetaData <!--
81 silly fetchPackageMetaData var strPrompt = "";
81 silly fetchPackageMetaData var bInstall = true;	// true : Want to install, false : want to uninstall
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData var bDownloading = true;
81 silly fetchPackageMetaData var bProcessed = false;
81 silly fetchPackageMetaData var bSuccess = false;
81 silly fetchPackageMetaData var bStartProcess = false;
81 silly fetchPackageMetaData var bRuleChecking = false;
81 silly fetchPackageMetaData var bUninstall = false;
81 silly fetchPackageMetaData var bDelTempFile = false;
81 silly fetchPackageMetaData var bPassIngress = false;
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData var i = 0;
81 silly fetchPackageMetaData var timer = 0;
81 silly fetchPackageMetaData var j = 0;
81 silly fetchPackageMetaData var k = 0;
81 silly fetchPackageMetaData var total = 0;
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData function CheckProcess()
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData     if(bNotRun)
81 silly fetchPackageMetaData     {
81 silly fetchPackageMetaData         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
81 silly fetchPackageMetaData         return;
81 silly fetchPackageMetaData     }
81 silly fetchPackageMetaData 	var retv;
81 silly fetchPackageMetaData 	if(!bSuccess)
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 		try
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			var ipaddress = window.location.host + ",10.252.252.252";
81 silly fetchPackageMetaData 			IngressClnt.TellServiceGatewayIp(ipaddress);
81 silly fetchPackageMetaData 			bDownloading = false;
81 silly fetchPackageMetaData 			bSuccess = true;
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 		catch(e)
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			bDownloading = true;
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData 	if(bDownloading)
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 		if(j == 0)
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
81 silly fetchPackageMetaData 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
81 silly fetchPackageMetaData 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 		if(j <= 5)
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			strPrompt += ".";
81 silly fetchPackageMetaData 			j++;
81 silly fetchPackageMetaData 			total++;
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 		else
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			j=0;
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData 			if(total > 50)
81 silly fetchPackageMetaData 			{
81 silly fetchPackageMetaData 				window.clearInterval(timer);
81 silly fetchPackageMetaData 			//	strPrompt = "网络准入系统客户端安装超时!";
81 silly fetchPackageMetaData 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
81 silly fetchPackageMetaData 			}
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData 	else
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 		if(!bDelTempFile)
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			IngressClnt.DeleteTempFile(); //删除临时缓存
81 silly fetchPackageMetaData 			bDelTempFile = true;
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 		bProcessed = true;
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData 		if(!bRuleChecking)
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 		else
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			var retv;
81 silly fetchPackageMetaData 			retv = IngressClnt.GetAuthenState();
81 silly fetchPackageMetaData 			switch(retv)
81 silly fetchPackageMetaData 			{
81 silly fetchPackageMetaData 			    case 0:
81 silly fetchPackageMetaData 			        {
81 silly fetchPackageMetaData 			            // 现在统一由共享内存给出
81 silly fetchPackageMetaData 						try
81 silly fetchPackageMetaData 						{
81 silly fetchPackageMetaData 				            strPrompt = IngressClnt.GetIngressMessage();
81 silly fetchPackageMetaData 				            if (k <= 5) {
81 silly fetchPackageMetaData 				                for (var dot = 0; dot < k; dot++ )
81 silly fetchPackageMetaData 				                    strPrompt += ".";
81 silly fetchPackageMetaData 				                k++;
81 silly fetchPackageMetaData 				                total++;
81 silly fetchPackageMetaData 				            }
81 silly fetchPackageMetaData 				            else {
81 silly fetchPackageMetaData 				                k = 0;
81 silly fetchPackageMetaData 				            }
81 silly fetchPackageMetaData 						}
81 silly fetchPackageMetaData 						catch(e)
81 silly fetchPackageMetaData 						{
81 silly fetchPackageMetaData 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
81 silly fetchPackageMetaData 						}
81 silly fetchPackageMetaData 			        }
81 silly fetchPackageMetaData 			        break;
81 silly fetchPackageMetaData 			case 1:
81 silly fetchPackageMetaData 				{
81 silly fetchPackageMetaData 					strPrompt = "规则检测已经完成,可以正常上网!";
81 silly fetchPackageMetaData 					bRuleChecking = false;
81 silly fetchPackageMetaData 					bPassIngress = true;
81 silly fetchPackageMetaData 				}
81 silly fetchPackageMetaData 				break;
81 silly fetchPackageMetaData 			case 2:
81 silly fetchPackageMetaData 				{
81 silly fetchPackageMetaData 					var strlog;
81 silly fetchPackageMetaData 					strlog = IngressClnt.GetIngressLog();
81 silly fetchPackageMetaData 					if(strlog.search("安全桌面没有运行，") >= 0)
81 silly fetchPackageMetaData 					{
81 silly fetchPackageMetaData 						button_show();
81 silly fetchPackageMetaData 					}
81 silly fetchPackageMetaData 					strPrompt = strlog;
81 silly fetchPackageMetaData 					bRuleChecking = false;
81 silly fetchPackageMetaData 				}
81 silly fetchPackageMetaData 				break;
81 silly fetchPackageMetaData             case 3:
81 silly fetchPackageMetaData                 {
81 silly fetchPackageMetaData                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
81 silly fetchPackageMetaData                 }
81 silly fetchPackageMetaData 			default:
81 silly fetchPackageMetaData 				break;
81 silly fetchPackageMetaData 			}
81 silly fetchPackageMetaData 			if(!bRuleChecking)
81 silly fetchPackageMetaData 			{
81 silly fetchPackageMetaData 				window.clearInterval(timer);
81 silly fetchPackageMetaData 				if (bPassIngress)
81 silly fetchPackageMetaData 				{
81 silly fetchPackageMetaData 					html_redirect();
81 silly fetchPackageMetaData 				}
81 silly fetchPackageMetaData 			}
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 		bRuleChecking = true;
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData timer = window.setInterval("CheckProcess()", 500);
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
81 silly fetchPackageMetaData  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
81 silly fetchPackageMetaData  document.write(objinfo);
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData //-->
81 silly fetchPackageMetaData </SCRIPT>
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData <div id="content">
81 silly fetchPackageMetaData   <h1 class="warning">网络准入系统</h1>
81 silly fetchPackageMetaData   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
81 silly fetchPackageMetaData   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
81 silly fetchPackageMetaData  <p><span id="loading"></span> </p>
81 silly fetchPackageMetaData  <p><span id="ScriptDiv"></span> </p>
81 silly fetchPackageMetaData  <br>
81 silly fetchPackageMetaData   <p><b>安装方法：</b>
81 silly fetchPackageMetaData   <ol>
81 silly fetchPackageMetaData     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
81 silly fetchPackageMetaData     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
81 silly fetchPackageMetaData   </ol>
81 silly fetchPackageMetaData   </p>
81 silly fetchPackageMetaData </div>
81 silly fetchPackageMetaData </body>
81 silly fetchPackageMetaData </html>
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData     at Object.parse (native)
81 silly fetchPackageMetaData     at CachingRegistryClient.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:237:23)
81 silly fetchPackageMetaData     at Request._callback (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:210:14)
81 silly fetchPackageMetaData     at Request.self.callback (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:187:22)
81 silly fetchPackageMetaData     at emitTwo (events.js:106:13)
81 silly fetchPackageMetaData     at Request.emit (events.js:191:7)
81 silly fetchPackageMetaData     at Request.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:1048:10)
81 silly fetchPackageMetaData     at emitOne (events.js:96:13)
81 silly fetchPackageMetaData     at Request.emit (events.js:188:7)
81 silly fetchPackageMetaData     at IncomingMessage.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:969:12)
81 silly fetchPackageMetaData  error for jshint@^2.9.4 SyntaxError: Unexpected token < in JSON at position 0
81 silly fetchPackageMetaData <html>
81 silly fetchPackageMetaData <head>
81 silly fetchPackageMetaData <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
81 silly fetchPackageMetaData <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
81 silly fetchPackageMetaData <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
81 silly fetchPackageMetaData <title>网络准入客户端</title>
81 silly fetchPackageMetaData <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
81 silly fetchPackageMetaData <script language="JavaScript" type="text/JavaScript">
81 silly fetchPackageMetaData <!--
81 silly fetchPackageMetaData var bNotRun = false;
81 silly fetchPackageMetaData if(window.ActiveXObject)
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData else
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData     bNotRun = true;
81 silly fetchPackageMetaData 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData function MM_preloadImages() { //v3.0
81 silly fetchPackageMetaData   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
81 silly fetchPackageMetaData     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
81 silly fetchPackageMetaData     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData function Close()
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData     try
81 silly fetchPackageMetaData     {
81 silly fetchPackageMetaData         var startSD = IngressClnt.StartSD();
81 silly fetchPackageMetaData         if (startSD == 0) {
81 silly fetchPackageMetaData             alert("启动安全桌面失败");
81 silly fetchPackageMetaData             return;
81 silly fetchPackageMetaData         }
81 silly fetchPackageMetaData     }
81 silly fetchPackageMetaData     catch (e)
81 silly fetchPackageMetaData     {
81 silly fetchPackageMetaData         alert("启动安全桌面失败");
81 silly fetchPackageMetaData         return;
81 silly fetchPackageMetaData     }
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData  var ua=navigator.userAgent
81 silly fetchPackageMetaData  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
81 silly fetchPackageMetaData  if(ie)
81 silly fetchPackageMetaData  {
81 silly fetchPackageMetaData       var IEversion
81 silly fetchPackageMetaData 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
81 silly fetchPackageMetaData 	if(hasTrident)
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 			IEversion=11
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData 	else
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData       if(IEversion< 5.5)
81 silly fetchPackageMetaData       {
81 silly fetchPackageMetaData       	close();
81 silly fetchPackageMetaData       }
81 silly fetchPackageMetaData       else
81 silly fetchPackageMetaData       {
81 silly fetchPackageMetaData       	parent:top.window.opener =null;
81 silly fetchPackageMetaData        	parent:top.window.close();
81 silly fetchPackageMetaData       }
81 silly fetchPackageMetaData    }
81 silly fetchPackageMetaData  else
81 silly fetchPackageMetaData  {
81 silly fetchPackageMetaData    parent:top.window.close()
81 silly fetchPackageMetaData  }
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData function Uninstall()
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData 	try
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 		IngressClnt.Uninstall();
81 silly fetchPackageMetaData 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
81 silly fetchPackageMetaData 		strPrompt += "请关闭所有浏览器!";
81 silly fetchPackageMetaData 		bUninstall = false;
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData 	catch(e)
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 		var strPrompt;
81 silly fetchPackageMetaData 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData 	loading.innerText = strPrompt;
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData function button_show()
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData 	var sHTML;
81 silly fetchPackageMetaData 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
81 silly fetchPackageMetaData 	//del by zl at 05/25/2010 卸载失效
81 silly fetchPackageMetaData 	/*
81 silly fetchPackageMetaData 	if(!bUninstall)
81 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
81 silly fetchPackageMetaData 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
81 silly fetchPackageMetaData 		else
81 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
81 silly fetchPackageMetaData 	*/
81 silly fetchPackageMetaData 	//end del by zl
81 silly fetchPackageMetaData 	ScriptDiv.innerHTML = sHTML;
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData function html_redirect()
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData 	var s =  new String(window.location);
81 silly fetchPackageMetaData 	var ss = s.indexOf("?");
81 silly fetchPackageMetaData 	if(ss > 0)
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 		var url = s.substr(ss+1);
81 silly fetchPackageMetaData 		var ss = url.indexOf("://");
81 silly fetchPackageMetaData 		if(ss < 0)
81 silly fetchPackageMetaData 			url = "http://" + url;
81 silly fetchPackageMetaData 		window.location = url;
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData function onLocationSingress()
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
81 silly fetchPackageMetaData 	window.open(ipaddress);
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData //-->
81 silly fetchPackageMetaData </script>
81 silly fetchPackageMetaData </head>
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData <body>
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData <SCRIPT language=JavaScript>
81 silly fetchPackageMetaData <!--
81 silly fetchPackageMetaData var strPrompt = "";
81 silly fetchPackageMetaData var bInstall = true;	// true : Want to install, false : want to uninstall
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData var bDownloading = true;
81 silly fetchPackageMetaData var bProcessed = false;
81 silly fetchPackageMetaData var bSuccess = false;
81 silly fetchPackageMetaData var bStartProcess = false;
81 silly fetchPackageMetaData var bRuleChecking = false;
81 silly fetchPackageMetaData var bUninstall = false;
81 silly fetchPackageMetaData var bDelTempFile = false;
81 silly fetchPackageMetaData var bPassIngress = false;
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData var i = 0;
81 silly fetchPackageMetaData var timer = 0;
81 silly fetchPackageMetaData var j = 0;
81 silly fetchPackageMetaData var k = 0;
81 silly fetchPackageMetaData var total = 0;
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData function CheckProcess()
81 silly fetchPackageMetaData {
81 silly fetchPackageMetaData     if(bNotRun)
81 silly fetchPackageMetaData     {
81 silly fetchPackageMetaData         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
81 silly fetchPackageMetaData         return;
81 silly fetchPackageMetaData     }
81 silly fetchPackageMetaData 	var retv;
81 silly fetchPackageMetaData 	if(!bSuccess)
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 		try
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			var ipaddress = window.location.host + ",10.252.252.252";
81 silly fetchPackageMetaData 			IngressClnt.TellServiceGatewayIp(ipaddress);
81 silly fetchPackageMetaData 			bDownloading = false;
81 silly fetchPackageMetaData 			bSuccess = true;
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 		catch(e)
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			bDownloading = true;
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData 	if(bDownloading)
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 		if(j == 0)
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
81 silly fetchPackageMetaData 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
81 silly fetchPackageMetaData 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 		if(j <= 5)
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			strPrompt += ".";
81 silly fetchPackageMetaData 			j++;
81 silly fetchPackageMetaData 			total++;
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 		else
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			j=0;
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData 			if(total > 50)
81 silly fetchPackageMetaData 			{
81 silly fetchPackageMetaData 				window.clearInterval(timer);
81 silly fetchPackageMetaData 			//	strPrompt = "网络准入系统客户端安装超时!";
81 silly fetchPackageMetaData 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
81 silly fetchPackageMetaData 			}
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData 	else
81 silly fetchPackageMetaData 	{
81 silly fetchPackageMetaData 		if(!bDelTempFile)
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			IngressClnt.DeleteTempFile(); //删除临时缓存
81 silly fetchPackageMetaData 			bDelTempFile = true;
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 		bProcessed = true;
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData 		if(!bRuleChecking)
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 		else
81 silly fetchPackageMetaData 		{
81 silly fetchPackageMetaData 			var retv;
81 silly fetchPackageMetaData 			retv = IngressClnt.GetAuthenState();
81 silly fetchPackageMetaData 			switch(retv)
81 silly fetchPackageMetaData 			{
81 silly fetchPackageMetaData 			    case 0:
81 silly fetchPackageMetaData 			        {
81 silly fetchPackageMetaData 			            // 现在统一由共享内存给出
81 silly fetchPackageMetaData 						try
81 silly fetchPackageMetaData 						{
81 silly fetchPackageMetaData 				            strPrompt = IngressClnt.GetIngressMessage();
81 silly fetchPackageMetaData 				            if (k <= 5) {
81 silly fetchPackageMetaData 				                for (var dot = 0; dot < k; dot++ )
81 silly fetchPackageMetaData 				                    strPrompt += ".";
81 silly fetchPackageMetaData 				                k++;
81 silly fetchPackageMetaData 				                total++;
81 silly fetchPackageMetaData 				            }
81 silly fetchPackageMetaData 				            else {
81 silly fetchPackageMetaData 				                k = 0;
81 silly fetchPackageMetaData 				            }
81 silly fetchPackageMetaData 						}
81 silly fetchPackageMetaData 						catch(e)
81 silly fetchPackageMetaData 						{
81 silly fetchPackageMetaData 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
81 silly fetchPackageMetaData 						}
81 silly fetchPackageMetaData 			        }
81 silly fetchPackageMetaData 			        break;
81 silly fetchPackageMetaData 			case 1:
81 silly fetchPackageMetaData 				{
81 silly fetchPackageMetaData 					strPrompt = "规则检测已经完成,可以正常上网!";
81 silly fetchPackageMetaData 					bRuleChecking = false;
81 silly fetchPackageMetaData 					bPassIngress = true;
81 silly fetchPackageMetaData 				}
81 silly fetchPackageMetaData 				break;
81 silly fetchPackageMetaData 			case 2:
81 silly fetchPackageMetaData 				{
81 silly fetchPackageMetaData 					var strlog;
81 silly fetchPackageMetaData 					strlog = IngressClnt.GetIngressLog();
81 silly fetchPackageMetaData 					if(strlog.search("安全桌面没有运行，") >= 0)
81 silly fetchPackageMetaData 					{
81 silly fetchPackageMetaData 						button_show();
81 silly fetchPackageMetaData 					}
81 silly fetchPackageMetaData 					strPrompt = strlog;
81 silly fetchPackageMetaData 					bRuleChecking = false;
81 silly fetchPackageMetaData 				}
81 silly fetchPackageMetaData 				break;
81 silly fetchPackageMetaData             case 3:
81 silly fetchPackageMetaData                 {
81 silly fetchPackageMetaData                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
81 silly fetchPackageMetaData                 }
81 silly fetchPackageMetaData 			default:
81 silly fetchPackageMetaData 				break;
81 silly fetchPackageMetaData 			}
81 silly fetchPackageMetaData 			if(!bRuleChecking)
81 silly fetchPackageMetaData 			{
81 silly fetchPackageMetaData 				window.clearInterval(timer);
81 silly fetchPackageMetaData 				if (bPassIngress)
81 silly fetchPackageMetaData 				{
81 silly fetchPackageMetaData 					html_redirect();
81 silly fetchPackageMetaData 				}
81 silly fetchPackageMetaData 			}
81 silly fetchPackageMetaData 		}
81 silly fetchPackageMetaData 		bRuleChecking = true;
81 silly fetchPackageMetaData 	}
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
81 silly fetchPackageMetaData }
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData timer = window.setInterval("CheckProcess()", 500);
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
81 silly fetchPackageMetaData  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
81 silly fetchPackageMetaData  document.write(objinfo);
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData //-->
81 silly fetchPackageMetaData </SCRIPT>
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData <div id="content">
81 silly fetchPackageMetaData   <h1 class="warning">网络准入系统</h1>
81 silly fetchPackageMetaData   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
81 silly fetchPackageMetaData   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
81 silly fetchPackageMetaData  <p><span id="loading"></span> </p>
81 silly fetchPackageMetaData  <p><span id="ScriptDiv"></span> </p>
81 silly fetchPackageMetaData  <br>
81 silly fetchPackageMetaData   <p><b>安装方法：</b>
81 silly fetchPackageMetaData   <ol>
81 silly fetchPackageMetaData     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
81 silly fetchPackageMetaData     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
81 silly fetchPackageMetaData   </ol>
81 silly fetchPackageMetaData   </p>
81 silly fetchPackageMetaData </div>
81 silly fetchPackageMetaData </body>
81 silly fetchPackageMetaData </html>
81 silly fetchPackageMetaData
81 silly fetchPackageMetaData     at Object.parse (native)
81 silly fetchPackageMetaData     at CachingRegistryClient.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:237:23)
81 silly fetchPackageMetaData     at Request._callback (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:210:14)
81 silly fetchPackageMetaData     at Request.self.callback (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:187:22)
81 silly fetchPackageMetaData     at emitTwo (events.js:106:13)
81 silly fetchPackageMetaData     at Request.emit (events.js:191:7)
81 silly fetchPackageMetaData     at Request.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:1048:10)
81 silly fetchPackageMetaData     at emitOne (events.js:96:13)
81 silly fetchPackageMetaData     at Request.emit (events.js:188:7)
81 silly fetchPackageMetaData     at IncomingMessage.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:969:12)
82 http 200 http://registry.cnpmjs.org/load-grunt-tasks
83 verbose bad json <html>
83 verbose bad json <head>
83 verbose bad json <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
83 verbose bad json <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
83 verbose bad json <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
83 verbose bad json <title>网络准入客户端</title>
83 verbose bad json <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
83 verbose bad json <script language="JavaScript" type="text/JavaScript">
83 verbose bad json <!--
83 verbose bad json var bNotRun = false;
83 verbose bad json if(window.ActiveXObject)
83 verbose bad json {
83 verbose bad json
83 verbose bad json }
83 verbose bad json else
83 verbose bad json {
83 verbose bad json     bNotRun = true;
83 verbose bad json 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
83 verbose bad json }
83 verbose bad json function MM_preloadImages() { //v3.0
83 verbose bad json   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
83 verbose bad json     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
83 verbose bad json     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
83 verbose bad json }
83 verbose bad json
83 verbose bad json function Close()
83 verbose bad json {
83 verbose bad json     try
83 verbose bad json     {
83 verbose bad json         var startSD = IngressClnt.StartSD();
83 verbose bad json         if (startSD == 0) {
83 verbose bad json             alert("启动安全桌面失败");
83 verbose bad json             return;
83 verbose bad json         }
83 verbose bad json     }
83 verbose bad json     catch (e)
83 verbose bad json     {
83 verbose bad json         alert("启动安全桌面失败");
83 verbose bad json         return;
83 verbose bad json     }
83 verbose bad json
83 verbose bad json  var ua=navigator.userAgent
83 verbose bad json  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
83 verbose bad json  if(ie)
83 verbose bad json  {
83 verbose bad json       var IEversion
83 verbose bad json 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
83 verbose bad json 	if(hasTrident)
83 verbose bad json 	{
83 verbose bad json 			IEversion=11
83 verbose bad json 	}
83 verbose bad json 	else
83 verbose bad json 	{
83 verbose bad json 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
83 verbose bad json 	}
83 verbose bad json
83 verbose bad json       if(IEversion< 5.5)
83 verbose bad json       {
83 verbose bad json       	close();
83 verbose bad json       }
83 verbose bad json       else
83 verbose bad json       {
83 verbose bad json       	parent:top.window.opener =null;
83 verbose bad json        	parent:top.window.close();
83 verbose bad json       }
83 verbose bad json    }
83 verbose bad json  else
83 verbose bad json  {
83 verbose bad json    parent:top.window.close()
83 verbose bad json  }
83 verbose bad json }
83 verbose bad json
83 verbose bad json function Uninstall()
83 verbose bad json {
83 verbose bad json 	try
83 verbose bad json 	{
83 verbose bad json 		IngressClnt.Uninstall();
83 verbose bad json 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
83 verbose bad json 		strPrompt += "请关闭所有浏览器!";
83 verbose bad json 		bUninstall = false;
83 verbose bad json 	}
83 verbose bad json 	catch(e)
83 verbose bad json 	{
83 verbose bad json 		var strPrompt;
83 verbose bad json 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
83 verbose bad json 	}
83 verbose bad json 	loading.innerText = strPrompt;
83 verbose bad json }
83 verbose bad json
83 verbose bad json function button_show()
83 verbose bad json {
83 verbose bad json 	var sHTML;
83 verbose bad json 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
83 verbose bad json 	//del by zl at 05/25/2010 卸载失效
83 verbose bad json 	/*
83 verbose bad json 	if(!bUninstall)
83 verbose bad json 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
83 verbose bad json 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
83 verbose bad json 		else
83 verbose bad json 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
83 verbose bad json 	*/
83 verbose bad json 	//end del by zl
83 verbose bad json 	ScriptDiv.innerHTML = sHTML;
83 verbose bad json }
83 verbose bad json
83 verbose bad json function html_redirect()
83 verbose bad json {
83 verbose bad json 	var s =  new String(window.location);
83 verbose bad json 	var ss = s.indexOf("?");
83 verbose bad json 	if(ss > 0)
83 verbose bad json 	{
83 verbose bad json 		var url = s.substr(ss+1);
83 verbose bad json 		var ss = url.indexOf("://");
83 verbose bad json 		if(ss < 0)
83 verbose bad json 			url = "http://" + url;
83 verbose bad json 		window.location = url;
83 verbose bad json 	}
83 verbose bad json }
83 verbose bad json function onLocationSingress()
83 verbose bad json {
83 verbose bad json 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
83 verbose bad json 	window.open(ipaddress);
83 verbose bad json
83 verbose bad json }
83 verbose bad json //-->
83 verbose bad json </script>
83 verbose bad json </head>
83 verbose bad json
83 verbose bad json <body>
83 verbose bad json
83 verbose bad json <SCRIPT language=JavaScript>
83 verbose bad json <!--
83 verbose bad json var strPrompt = "";
83 verbose bad json var bInstall = true;	// true : Want to install, false : want to uninstall
83 verbose bad json
83 verbose bad json
83 verbose bad json var bDownloading = true;
83 verbose bad json var bProcessed = false;
83 verbose bad json var bSuccess = false;
83 verbose bad json var bStartProcess = false;
83 verbose bad json var bRuleChecking = false;
83 verbose bad json var bUninstall = false;
83 verbose bad json var bDelTempFile = false;
83 verbose bad json var bPassIngress = false;
83 verbose bad json
83 verbose bad json var i = 0;
83 verbose bad json var timer = 0;
83 verbose bad json var j = 0;
83 verbose bad json var k = 0;
83 verbose bad json var total = 0;
83 verbose bad json
83 verbose bad json function CheckProcess()
83 verbose bad json {
83 verbose bad json     if(bNotRun)
83 verbose bad json     {
83 verbose bad json         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
83 verbose bad json         return;
83 verbose bad json     }
83 verbose bad json 	var retv;
83 verbose bad json 	if(!bSuccess)
83 verbose bad json 	{
83 verbose bad json 		try
83 verbose bad json 		{
83 verbose bad json 			var ipaddress = window.location.host + ",10.252.252.252";
83 verbose bad json 			IngressClnt.TellServiceGatewayIp(ipaddress);
83 verbose bad json 			bDownloading = false;
83 verbose bad json 			bSuccess = true;
83 verbose bad json 		}
83 verbose bad json 		catch(e)
83 verbose bad json 		{
83 verbose bad json 			bDownloading = true;
83 verbose bad json 		}
83 verbose bad json 	}
83 verbose bad json 	if(bDownloading)
83 verbose bad json 	{
83 verbose bad json 		if(j == 0)
83 verbose bad json 		{
83 verbose bad json 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
83 verbose bad json 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
83 verbose bad json 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
83 verbose bad json 		}
83 verbose bad json 		if(j <= 5)
83 verbose bad json 		{
83 verbose bad json 			strPrompt += ".";
83 verbose bad json 			j++;
83 verbose bad json 			total++;
83 verbose bad json 		}
83 verbose bad json 		else
83 verbose bad json 		{
83 verbose bad json 			j=0;
83 verbose bad json
83 verbose bad json 			if(total > 50)
83 verbose bad json 			{
83 verbose bad json 				window.clearInterval(timer);
83 verbose bad json 			//	strPrompt = "网络准入系统客户端安装超时!";
83 verbose bad json 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
83 verbose bad json 			}
83 verbose bad json 		}
83 verbose bad json 	}
83 verbose bad json 	else
83 verbose bad json 	{
83 verbose bad json 		if(!bDelTempFile)
83 verbose bad json 		{
83 verbose bad json 			IngressClnt.DeleteTempFile(); //删除临时缓存
83 verbose bad json 			bDelTempFile = true;
83 verbose bad json 		}
83 verbose bad json 		bProcessed = true;
83 verbose bad json
83 verbose bad json 		if(!bRuleChecking)
83 verbose bad json 		{
83 verbose bad json 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
83 verbose bad json 		}
83 verbose bad json 		else
83 verbose bad json 		{
83 verbose bad json 			var retv;
83 verbose bad json 			retv = IngressClnt.GetAuthenState();
83 verbose bad json 			switch(retv)
83 verbose bad json 			{
83 verbose bad json 			    case 0:
83 verbose bad json 			        {
83 verbose bad json 			            // 现在统一由共享内存给出
83 verbose bad json 						try
83 verbose bad json 						{
83 verbose bad json 				            strPrompt = IngressClnt.GetIngressMessage();
83 verbose bad json 				            if (k <= 5) {
83 verbose bad json 				                for (var dot = 0; dot < k; dot++ )
83 verbose bad json 				                    strPrompt += ".";
83 verbose bad json 				                k++;
83 verbose bad json 				                total++;
83 verbose bad json 				            }
83 verbose bad json 				            else {
83 verbose bad json 				                k = 0;
83 verbose bad json 				            }
83 verbose bad json 						}
83 verbose bad json 						catch(e)
83 verbose bad json 						{
83 verbose bad json 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
83 verbose bad json 						}
83 verbose bad json 			        }
83 verbose bad json 			        break;
83 verbose bad json 			case 1:
83 verbose bad json 				{
83 verbose bad json 					strPrompt = "规则检测已经完成,可以正常上网!";
83 verbose bad json 					bRuleChecking = false;
83 verbose bad json 					bPassIngress = true;
83 verbose bad json 				}
83 verbose bad json 				break;
83 verbose bad json 			case 2:
83 verbose bad json 				{
83 verbose bad json 					var strlog;
83 verbose bad json 					strlog = IngressClnt.GetIngressLog();
83 verbose bad json 					if(strlog.search("安全桌面没有运行，") >= 0)
83 verbose bad json 					{
83 verbose bad json 						button_show();
83 verbose bad json 					}
83 verbose bad json 					strPrompt = strlog;
83 verbose bad json 					bRuleChecking = false;
83 verbose bad json 				}
83 verbose bad json 				break;
83 verbose bad json             case 3:
83 verbose bad json                 {
83 verbose bad json                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
83 verbose bad json                 }
83 verbose bad json 			default:
83 verbose bad json 				break;
83 verbose bad json 			}
83 verbose bad json 			if(!bRuleChecking)
83 verbose bad json 			{
83 verbose bad json 				window.clearInterval(timer);
83 verbose bad json 				if (bPassIngress)
83 verbose bad json 				{
83 verbose bad json 					html_redirect();
83 verbose bad json 				}
83 verbose bad json 			}
83 verbose bad json 		}
83 verbose bad json 		bRuleChecking = true;
83 verbose bad json 	}
83 verbose bad json
83 verbose bad json 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
83 verbose bad json }
83 verbose bad json
83 verbose bad json timer = window.setInterval("CheckProcess()", 500);
83 verbose bad json
83 verbose bad json var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
83 verbose bad json  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
83 verbose bad json  document.write(objinfo);
83 verbose bad json
83 verbose bad json //-->
83 verbose bad json </SCRIPT>
83 verbose bad json
83 verbose bad json
83 verbose bad json
83 verbose bad json <div id="content">
83 verbose bad json   <h1 class="warning">网络准入系统</h1>
83 verbose bad json   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
83 verbose bad json   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
83 verbose bad json  <p><span id="loading"></span> </p>
83 verbose bad json  <p><span id="ScriptDiv"></span> </p>
83 verbose bad json  <br>
83 verbose bad json   <p><b>安装方法：</b>
83 verbose bad json   <ol>
83 verbose bad json     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
83 verbose bad json     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
83 verbose bad json   </ol>
83 verbose bad json   </p>
83 verbose bad json </div>
83 verbose bad json </body>
83 verbose bad json </html>
84 error registry error parsing json
85 verbose headers { date: 'Fri, 01 Sep 2017 03:23:40 GMT',
85 verbose headers   server: 'SinforHttpd/1.0',
85 verbose headers   connection: 'close',
85 verbose headers   'content-type': 'text/html; charset=utf-8',
85 verbose headers   'content-length': '7863',
85 verbose headers   'cache-control': 'no-cache,must-revalidate',
85 verbose headers   'last-modified': 'Wed, 28 May 2014 02:37:32 GMT' }
86 silly get cb [ 200,
86 silly get   { date: 'Fri, 01 Sep 2017 03:23:40 GMT',
86 silly get     server: 'SinforHttpd/1.0',
86 silly get     connection: 'close',
86 silly get     'content-type': 'text/html; charset=utf-8',
86 silly get     'content-length': '7863',
86 silly get     'cache-control': 'no-cache,must-revalidate',
86 silly get     'last-modified': 'Wed, 28 May 2014 02:37:32 GMT' } ]
87 silly fetchPackageMetaData SyntaxError: Unexpected token < in JSON at position 0
87 silly fetchPackageMetaData <html>
87 silly fetchPackageMetaData <head>
87 silly fetchPackageMetaData <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
87 silly fetchPackageMetaData <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
87 silly fetchPackageMetaData <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
87 silly fetchPackageMetaData <title>网络准入客户端</title>
87 silly fetchPackageMetaData <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
87 silly fetchPackageMetaData <script language="JavaScript" type="text/JavaScript">
87 silly fetchPackageMetaData <!--
87 silly fetchPackageMetaData var bNotRun = false;
87 silly fetchPackageMetaData if(window.ActiveXObject)
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData else
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData     bNotRun = true;
87 silly fetchPackageMetaData 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData function MM_preloadImages() { //v3.0
87 silly fetchPackageMetaData   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
87 silly fetchPackageMetaData     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
87 silly fetchPackageMetaData     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData function Close()
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData     try
87 silly fetchPackageMetaData     {
87 silly fetchPackageMetaData         var startSD = IngressClnt.StartSD();
87 silly fetchPackageMetaData         if (startSD == 0) {
87 silly fetchPackageMetaData             alert("启动安全桌面失败");
87 silly fetchPackageMetaData             return;
87 silly fetchPackageMetaData         }
87 silly fetchPackageMetaData     }
87 silly fetchPackageMetaData     catch (e)
87 silly fetchPackageMetaData     {
87 silly fetchPackageMetaData         alert("启动安全桌面失败");
87 silly fetchPackageMetaData         return;
87 silly fetchPackageMetaData     }
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData  var ua=navigator.userAgent
87 silly fetchPackageMetaData  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
87 silly fetchPackageMetaData  if(ie)
87 silly fetchPackageMetaData  {
87 silly fetchPackageMetaData       var IEversion
87 silly fetchPackageMetaData 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
87 silly fetchPackageMetaData 	if(hasTrident)
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 			IEversion=11
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData 	else
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData       if(IEversion< 5.5)
87 silly fetchPackageMetaData       {
87 silly fetchPackageMetaData       	close();
87 silly fetchPackageMetaData       }
87 silly fetchPackageMetaData       else
87 silly fetchPackageMetaData       {
87 silly fetchPackageMetaData       	parent:top.window.opener =null;
87 silly fetchPackageMetaData        	parent:top.window.close();
87 silly fetchPackageMetaData       }
87 silly fetchPackageMetaData    }
87 silly fetchPackageMetaData  else
87 silly fetchPackageMetaData  {
87 silly fetchPackageMetaData    parent:top.window.close()
87 silly fetchPackageMetaData  }
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData function Uninstall()
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData 	try
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 		IngressClnt.Uninstall();
87 silly fetchPackageMetaData 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
87 silly fetchPackageMetaData 		strPrompt += "请关闭所有浏览器!";
87 silly fetchPackageMetaData 		bUninstall = false;
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData 	catch(e)
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 		var strPrompt;
87 silly fetchPackageMetaData 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData 	loading.innerText = strPrompt;
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData function button_show()
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData 	var sHTML;
87 silly fetchPackageMetaData 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
87 silly fetchPackageMetaData 	//del by zl at 05/25/2010 卸载失效
87 silly fetchPackageMetaData 	/*
87 silly fetchPackageMetaData 	if(!bUninstall)
87 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
87 silly fetchPackageMetaData 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
87 silly fetchPackageMetaData 		else
87 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
87 silly fetchPackageMetaData 	*/
87 silly fetchPackageMetaData 	//end del by zl
87 silly fetchPackageMetaData 	ScriptDiv.innerHTML = sHTML;
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData function html_redirect()
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData 	var s =  new String(window.location);
87 silly fetchPackageMetaData 	var ss = s.indexOf("?");
87 silly fetchPackageMetaData 	if(ss > 0)
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 		var url = s.substr(ss+1);
87 silly fetchPackageMetaData 		var ss = url.indexOf("://");
87 silly fetchPackageMetaData 		if(ss < 0)
87 silly fetchPackageMetaData 			url = "http://" + url;
87 silly fetchPackageMetaData 		window.location = url;
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData function onLocationSingress()
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
87 silly fetchPackageMetaData 	window.open(ipaddress);
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData //-->
87 silly fetchPackageMetaData </script>
87 silly fetchPackageMetaData </head>
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData <body>
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData <SCRIPT language=JavaScript>
87 silly fetchPackageMetaData <!--
87 silly fetchPackageMetaData var strPrompt = "";
87 silly fetchPackageMetaData var bInstall = true;	// true : Want to install, false : want to uninstall
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData var bDownloading = true;
87 silly fetchPackageMetaData var bProcessed = false;
87 silly fetchPackageMetaData var bSuccess = false;
87 silly fetchPackageMetaData var bStartProcess = false;
87 silly fetchPackageMetaData var bRuleChecking = false;
87 silly fetchPackageMetaData var bUninstall = false;
87 silly fetchPackageMetaData var bDelTempFile = false;
87 silly fetchPackageMetaData var bPassIngress = false;
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData var i = 0;
87 silly fetchPackageMetaData var timer = 0;
87 silly fetchPackageMetaData var j = 0;
87 silly fetchPackageMetaData var k = 0;
87 silly fetchPackageMetaData var total = 0;
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData function CheckProcess()
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData     if(bNotRun)
87 silly fetchPackageMetaData     {
87 silly fetchPackageMetaData         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
87 silly fetchPackageMetaData         return;
87 silly fetchPackageMetaData     }
87 silly fetchPackageMetaData 	var retv;
87 silly fetchPackageMetaData 	if(!bSuccess)
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 		try
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			var ipaddress = window.location.host + ",10.252.252.252";
87 silly fetchPackageMetaData 			IngressClnt.TellServiceGatewayIp(ipaddress);
87 silly fetchPackageMetaData 			bDownloading = false;
87 silly fetchPackageMetaData 			bSuccess = true;
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 		catch(e)
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			bDownloading = true;
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData 	if(bDownloading)
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 		if(j == 0)
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
87 silly fetchPackageMetaData 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
87 silly fetchPackageMetaData 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 		if(j <= 5)
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			strPrompt += ".";
87 silly fetchPackageMetaData 			j++;
87 silly fetchPackageMetaData 			total++;
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 		else
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			j=0;
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData 			if(total > 50)
87 silly fetchPackageMetaData 			{
87 silly fetchPackageMetaData 				window.clearInterval(timer);
87 silly fetchPackageMetaData 			//	strPrompt = "网络准入系统客户端安装超时!";
87 silly fetchPackageMetaData 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
87 silly fetchPackageMetaData 			}
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData 	else
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 		if(!bDelTempFile)
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			IngressClnt.DeleteTempFile(); //删除临时缓存
87 silly fetchPackageMetaData 			bDelTempFile = true;
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 		bProcessed = true;
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData 		if(!bRuleChecking)
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 		else
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			var retv;
87 silly fetchPackageMetaData 			retv = IngressClnt.GetAuthenState();
87 silly fetchPackageMetaData 			switch(retv)
87 silly fetchPackageMetaData 			{
87 silly fetchPackageMetaData 			    case 0:
87 silly fetchPackageMetaData 			        {
87 silly fetchPackageMetaData 			            // 现在统一由共享内存给出
87 silly fetchPackageMetaData 						try
87 silly fetchPackageMetaData 						{
87 silly fetchPackageMetaData 				            strPrompt = IngressClnt.GetIngressMessage();
87 silly fetchPackageMetaData 				            if (k <= 5) {
87 silly fetchPackageMetaData 				                for (var dot = 0; dot < k; dot++ )
87 silly fetchPackageMetaData 				                    strPrompt += ".";
87 silly fetchPackageMetaData 				                k++;
87 silly fetchPackageMetaData 				                total++;
87 silly fetchPackageMetaData 				            }
87 silly fetchPackageMetaData 				            else {
87 silly fetchPackageMetaData 				                k = 0;
87 silly fetchPackageMetaData 				            }
87 silly fetchPackageMetaData 						}
87 silly fetchPackageMetaData 						catch(e)
87 silly fetchPackageMetaData 						{
87 silly fetchPackageMetaData 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
87 silly fetchPackageMetaData 						}
87 silly fetchPackageMetaData 			        }
87 silly fetchPackageMetaData 			        break;
87 silly fetchPackageMetaData 			case 1:
87 silly fetchPackageMetaData 				{
87 silly fetchPackageMetaData 					strPrompt = "规则检测已经完成,可以正常上网!";
87 silly fetchPackageMetaData 					bRuleChecking = false;
87 silly fetchPackageMetaData 					bPassIngress = true;
87 silly fetchPackageMetaData 				}
87 silly fetchPackageMetaData 				break;
87 silly fetchPackageMetaData 			case 2:
87 silly fetchPackageMetaData 				{
87 silly fetchPackageMetaData 					var strlog;
87 silly fetchPackageMetaData 					strlog = IngressClnt.GetIngressLog();
87 silly fetchPackageMetaData 					if(strlog.search("安全桌面没有运行，") >= 0)
87 silly fetchPackageMetaData 					{
87 silly fetchPackageMetaData 						button_show();
87 silly fetchPackageMetaData 					}
87 silly fetchPackageMetaData 					strPrompt = strlog;
87 silly fetchPackageMetaData 					bRuleChecking = false;
87 silly fetchPackageMetaData 				}
87 silly fetchPackageMetaData 				break;
87 silly fetchPackageMetaData             case 3:
87 silly fetchPackageMetaData                 {
87 silly fetchPackageMetaData                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
87 silly fetchPackageMetaData                 }
87 silly fetchPackageMetaData 			default:
87 silly fetchPackageMetaData 				break;
87 silly fetchPackageMetaData 			}
87 silly fetchPackageMetaData 			if(!bRuleChecking)
87 silly fetchPackageMetaData 			{
87 silly fetchPackageMetaData 				window.clearInterval(timer);
87 silly fetchPackageMetaData 				if (bPassIngress)
87 silly fetchPackageMetaData 				{
87 silly fetchPackageMetaData 					html_redirect();
87 silly fetchPackageMetaData 				}
87 silly fetchPackageMetaData 			}
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 		bRuleChecking = true;
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData timer = window.setInterval("CheckProcess()", 500);
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
87 silly fetchPackageMetaData  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
87 silly fetchPackageMetaData  document.write(objinfo);
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData //-->
87 silly fetchPackageMetaData </SCRIPT>
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData <div id="content">
87 silly fetchPackageMetaData   <h1 class="warning">网络准入系统</h1>
87 silly fetchPackageMetaData   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
87 silly fetchPackageMetaData   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
87 silly fetchPackageMetaData  <p><span id="loading"></span> </p>
87 silly fetchPackageMetaData  <p><span id="ScriptDiv"></span> </p>
87 silly fetchPackageMetaData  <br>
87 silly fetchPackageMetaData   <p><b>安装方法：</b>
87 silly fetchPackageMetaData   <ol>
87 silly fetchPackageMetaData     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
87 silly fetchPackageMetaData     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
87 silly fetchPackageMetaData   </ol>
87 silly fetchPackageMetaData   </p>
87 silly fetchPackageMetaData </div>
87 silly fetchPackageMetaData </body>
87 silly fetchPackageMetaData </html>
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData     at Object.parse (native)
87 silly fetchPackageMetaData     at CachingRegistryClient.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:237:23)
87 silly fetchPackageMetaData     at Request._callback (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:210:14)
87 silly fetchPackageMetaData     at Request.self.callback (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:187:22)
87 silly fetchPackageMetaData     at emitTwo (events.js:106:13)
87 silly fetchPackageMetaData     at Request.emit (events.js:191:7)
87 silly fetchPackageMetaData     at Request.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:1048:10)
87 silly fetchPackageMetaData     at emitOne (events.js:96:13)
87 silly fetchPackageMetaData     at Request.emit (events.js:188:7)
87 silly fetchPackageMetaData     at IncomingMessage.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:969:12)
87 silly fetchPackageMetaData  error for load-grunt-tasks@^3.4.1 SyntaxError: Unexpected token < in JSON at position 0
87 silly fetchPackageMetaData <html>
87 silly fetchPackageMetaData <head>
87 silly fetchPackageMetaData <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
87 silly fetchPackageMetaData <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
87 silly fetchPackageMetaData <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
87 silly fetchPackageMetaData <title>网络准入客户端</title>
87 silly fetchPackageMetaData <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
87 silly fetchPackageMetaData <script language="JavaScript" type="text/JavaScript">
87 silly fetchPackageMetaData <!--
87 silly fetchPackageMetaData var bNotRun = false;
87 silly fetchPackageMetaData if(window.ActiveXObject)
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData else
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData     bNotRun = true;
87 silly fetchPackageMetaData 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData function MM_preloadImages() { //v3.0
87 silly fetchPackageMetaData   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
87 silly fetchPackageMetaData     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
87 silly fetchPackageMetaData     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData function Close()
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData     try
87 silly fetchPackageMetaData     {
87 silly fetchPackageMetaData         var startSD = IngressClnt.StartSD();
87 silly fetchPackageMetaData         if (startSD == 0) {
87 silly fetchPackageMetaData             alert("启动安全桌面失败");
87 silly fetchPackageMetaData             return;
87 silly fetchPackageMetaData         }
87 silly fetchPackageMetaData     }
87 silly fetchPackageMetaData     catch (e)
87 silly fetchPackageMetaData     {
87 silly fetchPackageMetaData         alert("启动安全桌面失败");
87 silly fetchPackageMetaData         return;
87 silly fetchPackageMetaData     }
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData  var ua=navigator.userAgent
87 silly fetchPackageMetaData  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
87 silly fetchPackageMetaData  if(ie)
87 silly fetchPackageMetaData  {
87 silly fetchPackageMetaData       var IEversion
87 silly fetchPackageMetaData 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
87 silly fetchPackageMetaData 	if(hasTrident)
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 			IEversion=11
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData 	else
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData       if(IEversion< 5.5)
87 silly fetchPackageMetaData       {
87 silly fetchPackageMetaData       	close();
87 silly fetchPackageMetaData       }
87 silly fetchPackageMetaData       else
87 silly fetchPackageMetaData       {
87 silly fetchPackageMetaData       	parent:top.window.opener =null;
87 silly fetchPackageMetaData        	parent:top.window.close();
87 silly fetchPackageMetaData       }
87 silly fetchPackageMetaData    }
87 silly fetchPackageMetaData  else
87 silly fetchPackageMetaData  {
87 silly fetchPackageMetaData    parent:top.window.close()
87 silly fetchPackageMetaData  }
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData function Uninstall()
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData 	try
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 		IngressClnt.Uninstall();
87 silly fetchPackageMetaData 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
87 silly fetchPackageMetaData 		strPrompt += "请关闭所有浏览器!";
87 silly fetchPackageMetaData 		bUninstall = false;
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData 	catch(e)
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 		var strPrompt;
87 silly fetchPackageMetaData 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData 	loading.innerText = strPrompt;
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData function button_show()
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData 	var sHTML;
87 silly fetchPackageMetaData 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
87 silly fetchPackageMetaData 	//del by zl at 05/25/2010 卸载失效
87 silly fetchPackageMetaData 	/*
87 silly fetchPackageMetaData 	if(!bUninstall)
87 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
87 silly fetchPackageMetaData 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
87 silly fetchPackageMetaData 		else
87 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
87 silly fetchPackageMetaData 	*/
87 silly fetchPackageMetaData 	//end del by zl
87 silly fetchPackageMetaData 	ScriptDiv.innerHTML = sHTML;
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData function html_redirect()
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData 	var s =  new String(window.location);
87 silly fetchPackageMetaData 	var ss = s.indexOf("?");
87 silly fetchPackageMetaData 	if(ss > 0)
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 		var url = s.substr(ss+1);
87 silly fetchPackageMetaData 		var ss = url.indexOf("://");
87 silly fetchPackageMetaData 		if(ss < 0)
87 silly fetchPackageMetaData 			url = "http://" + url;
87 silly fetchPackageMetaData 		window.location = url;
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData function onLocationSingress()
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
87 silly fetchPackageMetaData 	window.open(ipaddress);
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData //-->
87 silly fetchPackageMetaData </script>
87 silly fetchPackageMetaData </head>
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData <body>
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData <SCRIPT language=JavaScript>
87 silly fetchPackageMetaData <!--
87 silly fetchPackageMetaData var strPrompt = "";
87 silly fetchPackageMetaData var bInstall = true;	// true : Want to install, false : want to uninstall
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData var bDownloading = true;
87 silly fetchPackageMetaData var bProcessed = false;
87 silly fetchPackageMetaData var bSuccess = false;
87 silly fetchPackageMetaData var bStartProcess = false;
87 silly fetchPackageMetaData var bRuleChecking = false;
87 silly fetchPackageMetaData var bUninstall = false;
87 silly fetchPackageMetaData var bDelTempFile = false;
87 silly fetchPackageMetaData var bPassIngress = false;
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData var i = 0;
87 silly fetchPackageMetaData var timer = 0;
87 silly fetchPackageMetaData var j = 0;
87 silly fetchPackageMetaData var k = 0;
87 silly fetchPackageMetaData var total = 0;
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData function CheckProcess()
87 silly fetchPackageMetaData {
87 silly fetchPackageMetaData     if(bNotRun)
87 silly fetchPackageMetaData     {
87 silly fetchPackageMetaData         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
87 silly fetchPackageMetaData         return;
87 silly fetchPackageMetaData     }
87 silly fetchPackageMetaData 	var retv;
87 silly fetchPackageMetaData 	if(!bSuccess)
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 		try
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			var ipaddress = window.location.host + ",10.252.252.252";
87 silly fetchPackageMetaData 			IngressClnt.TellServiceGatewayIp(ipaddress);
87 silly fetchPackageMetaData 			bDownloading = false;
87 silly fetchPackageMetaData 			bSuccess = true;
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 		catch(e)
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			bDownloading = true;
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData 	if(bDownloading)
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 		if(j == 0)
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
87 silly fetchPackageMetaData 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
87 silly fetchPackageMetaData 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 		if(j <= 5)
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			strPrompt += ".";
87 silly fetchPackageMetaData 			j++;
87 silly fetchPackageMetaData 			total++;
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 		else
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			j=0;
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData 			if(total > 50)
87 silly fetchPackageMetaData 			{
87 silly fetchPackageMetaData 				window.clearInterval(timer);
87 silly fetchPackageMetaData 			//	strPrompt = "网络准入系统客户端安装超时!";
87 silly fetchPackageMetaData 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
87 silly fetchPackageMetaData 			}
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData 	else
87 silly fetchPackageMetaData 	{
87 silly fetchPackageMetaData 		if(!bDelTempFile)
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			IngressClnt.DeleteTempFile(); //删除临时缓存
87 silly fetchPackageMetaData 			bDelTempFile = true;
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 		bProcessed = true;
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData 		if(!bRuleChecking)
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 		else
87 silly fetchPackageMetaData 		{
87 silly fetchPackageMetaData 			var retv;
87 silly fetchPackageMetaData 			retv = IngressClnt.GetAuthenState();
87 silly fetchPackageMetaData 			switch(retv)
87 silly fetchPackageMetaData 			{
87 silly fetchPackageMetaData 			    case 0:
87 silly fetchPackageMetaData 			        {
87 silly fetchPackageMetaData 			            // 现在统一由共享内存给出
87 silly fetchPackageMetaData 						try
87 silly fetchPackageMetaData 						{
87 silly fetchPackageMetaData 				            strPrompt = IngressClnt.GetIngressMessage();
87 silly fetchPackageMetaData 				            if (k <= 5) {
87 silly fetchPackageMetaData 				                for (var dot = 0; dot < k; dot++ )
87 silly fetchPackageMetaData 				                    strPrompt += ".";
87 silly fetchPackageMetaData 				                k++;
87 silly fetchPackageMetaData 				                total++;
87 silly fetchPackageMetaData 				            }
87 silly fetchPackageMetaData 				            else {
87 silly fetchPackageMetaData 				                k = 0;
87 silly fetchPackageMetaData 				            }
87 silly fetchPackageMetaData 						}
87 silly fetchPackageMetaData 						catch(e)
87 silly fetchPackageMetaData 						{
87 silly fetchPackageMetaData 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
87 silly fetchPackageMetaData 						}
87 silly fetchPackageMetaData 			        }
87 silly fetchPackageMetaData 			        break;
87 silly fetchPackageMetaData 			case 1:
87 silly fetchPackageMetaData 				{
87 silly fetchPackageMetaData 					strPrompt = "规则检测已经完成,可以正常上网!";
87 silly fetchPackageMetaData 					bRuleChecking = false;
87 silly fetchPackageMetaData 					bPassIngress = true;
87 silly fetchPackageMetaData 				}
87 silly fetchPackageMetaData 				break;
87 silly fetchPackageMetaData 			case 2:
87 silly fetchPackageMetaData 				{
87 silly fetchPackageMetaData 					var strlog;
87 silly fetchPackageMetaData 					strlog = IngressClnt.GetIngressLog();
87 silly fetchPackageMetaData 					if(strlog.search("安全桌面没有运行，") >= 0)
87 silly fetchPackageMetaData 					{
87 silly fetchPackageMetaData 						button_show();
87 silly fetchPackageMetaData 					}
87 silly fetchPackageMetaData 					strPrompt = strlog;
87 silly fetchPackageMetaData 					bRuleChecking = false;
87 silly fetchPackageMetaData 				}
87 silly fetchPackageMetaData 				break;
87 silly fetchPackageMetaData             case 3:
87 silly fetchPackageMetaData                 {
87 silly fetchPackageMetaData                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
87 silly fetchPackageMetaData                 }
87 silly fetchPackageMetaData 			default:
87 silly fetchPackageMetaData 				break;
87 silly fetchPackageMetaData 			}
87 silly fetchPackageMetaData 			if(!bRuleChecking)
87 silly fetchPackageMetaData 			{
87 silly fetchPackageMetaData 				window.clearInterval(timer);
87 silly fetchPackageMetaData 				if (bPassIngress)
87 silly fetchPackageMetaData 				{
87 silly fetchPackageMetaData 					html_redirect();
87 silly fetchPackageMetaData 				}
87 silly fetchPackageMetaData 			}
87 silly fetchPackageMetaData 		}
87 silly fetchPackageMetaData 		bRuleChecking = true;
87 silly fetchPackageMetaData 	}
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
87 silly fetchPackageMetaData }
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData timer = window.setInterval("CheckProcess()", 500);
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
87 silly fetchPackageMetaData  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
87 silly fetchPackageMetaData  document.write(objinfo);
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData //-->
87 silly fetchPackageMetaData </SCRIPT>
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData <div id="content">
87 silly fetchPackageMetaData   <h1 class="warning">网络准入系统</h1>
87 silly fetchPackageMetaData   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
87 silly fetchPackageMetaData   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
87 silly fetchPackageMetaData  <p><span id="loading"></span> </p>
87 silly fetchPackageMetaData  <p><span id="ScriptDiv"></span> </p>
87 silly fetchPackageMetaData  <br>
87 silly fetchPackageMetaData   <p><b>安装方法：</b>
87 silly fetchPackageMetaData   <ol>
87 silly fetchPackageMetaData     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
87 silly fetchPackageMetaData     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
87 silly fetchPackageMetaData   </ol>
87 silly fetchPackageMetaData   </p>
87 silly fetchPackageMetaData </div>
87 silly fetchPackageMetaData </body>
87 silly fetchPackageMetaData </html>
87 silly fetchPackageMetaData
87 silly fetchPackageMetaData     at Object.parse (native)
87 silly fetchPackageMetaData     at CachingRegistryClient.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:237:23)
87 silly fetchPackageMetaData     at Request._callback (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:210:14)
87 silly fetchPackageMetaData     at Request.self.callback (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:187:22)
87 silly fetchPackageMetaData     at emitTwo (events.js:106:13)
87 silly fetchPackageMetaData     at Request.emit (events.js:191:7)
87 silly fetchPackageMetaData     at Request.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:1048:10)
87 silly fetchPackageMetaData     at emitOne (events.js:96:13)
87 silly fetchPackageMetaData     at Request.emit (events.js:188:7)
87 silly fetchPackageMetaData     at IncomingMessage.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:969:12)
88 http 200 http://registry.cnpmjs.org/grunt-contrib-jshint
89 verbose bad json <html>
89 verbose bad json <head>
89 verbose bad json <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
89 verbose bad json <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
89 verbose bad json <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
89 verbose bad json <title>网络准入客户端</title>
89 verbose bad json <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
89 verbose bad json <script language="JavaScript" type="text/JavaScript">
89 verbose bad json <!--
89 verbose bad json var bNotRun = false;
89 verbose bad json if(window.ActiveXObject)
89 verbose bad json {
89 verbose bad json
89 verbose bad json }
89 verbose bad json else
89 verbose bad json {
89 verbose bad json     bNotRun = true;
89 verbose bad json 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
89 verbose bad json }
89 verbose bad json function MM_preloadImages() { //v3.0
89 verbose bad json   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
89 verbose bad json     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
89 verbose bad json     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
89 verbose bad json }
89 verbose bad json
89 verbose bad json function Close()
89 verbose bad json {
89 verbose bad json     try
89 verbose bad json     {
89 verbose bad json         var startSD = IngressClnt.StartSD();
89 verbose bad json         if (startSD == 0) {
89 verbose bad json             alert("启动安全桌面失败");
89 verbose bad json             return;
89 verbose bad json         }
89 verbose bad json     }
89 verbose bad json     catch (e)
89 verbose bad json     {
89 verbose bad json         alert("启动安全桌面失败");
89 verbose bad json         return;
89 verbose bad json     }
89 verbose bad json
89 verbose bad json  var ua=navigator.userAgent
89 verbose bad json  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
89 verbose bad json  if(ie)
89 verbose bad json  {
89 verbose bad json       var IEversion
89 verbose bad json 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
89 verbose bad json 	if(hasTrident)
89 verbose bad json 	{
89 verbose bad json 			IEversion=11
89 verbose bad json 	}
89 verbose bad json 	else
89 verbose bad json 	{
89 verbose bad json 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
89 verbose bad json 	}
89 verbose bad json
89 verbose bad json       if(IEversion< 5.5)
89 verbose bad json       {
89 verbose bad json       	close();
89 verbose bad json       }
89 verbose bad json       else
89 verbose bad json       {
89 verbose bad json       	parent:top.window.opener =null;
89 verbose bad json        	parent:top.window.close();
89 verbose bad json       }
89 verbose bad json    }
89 verbose bad json  else
89 verbose bad json  {
89 verbose bad json    parent:top.window.close()
89 verbose bad json  }
89 verbose bad json }
89 verbose bad json
89 verbose bad json function Uninstall()
89 verbose bad json {
89 verbose bad json 	try
89 verbose bad json 	{
89 verbose bad json 		IngressClnt.Uninstall();
89 verbose bad json 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
89 verbose bad json 		strPrompt += "请关闭所有浏览器!";
89 verbose bad json 		bUninstall = false;
89 verbose bad json 	}
89 verbose bad json 	catch(e)
89 verbose bad json 	{
89 verbose bad json 		var strPrompt;
89 verbose bad json 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
89 verbose bad json 	}
89 verbose bad json 	loading.innerText = strPrompt;
89 verbose bad json }
89 verbose bad json
89 verbose bad json function button_show()
89 verbose bad json {
89 verbose bad json 	var sHTML;
89 verbose bad json 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
89 verbose bad json 	//del by zl at 05/25/2010 卸载失效
89 verbose bad json 	/*
89 verbose bad json 	if(!bUninstall)
89 verbose bad json 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
89 verbose bad json 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
89 verbose bad json 		else
89 verbose bad json 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
89 verbose bad json 	*/
89 verbose bad json 	//end del by zl
89 verbose bad json 	ScriptDiv.innerHTML = sHTML;
89 verbose bad json }
89 verbose bad json
89 verbose bad json function html_redirect()
89 verbose bad json {
89 verbose bad json 	var s =  new String(window.location);
89 verbose bad json 	var ss = s.indexOf("?");
89 verbose bad json 	if(ss > 0)
89 verbose bad json 	{
89 verbose bad json 		var url = s.substr(ss+1);
89 verbose bad json 		var ss = url.indexOf("://");
89 verbose bad json 		if(ss < 0)
89 verbose bad json 			url = "http://" + url;
89 verbose bad json 		window.location = url;
89 verbose bad json 	}
89 verbose bad json }
89 verbose bad json function onLocationSingress()
89 verbose bad json {
89 verbose bad json 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
89 verbose bad json 	window.open(ipaddress);
89 verbose bad json
89 verbose bad json }
89 verbose bad json //-->
89 verbose bad json </script>
89 verbose bad json </head>
89 verbose bad json
89 verbose bad json <body>
89 verbose bad json
89 verbose bad json <SCRIPT language=JavaScript>
89 verbose bad json <!--
89 verbose bad json var strPrompt = "";
89 verbose bad json var bInstall = true;	// true : Want to install, false : want to uninstall
89 verbose bad json
89 verbose bad json
89 verbose bad json var bDownloading = true;
89 verbose bad json var bProcessed = false;
89 verbose bad json var bSuccess = false;
89 verbose bad json var bStartProcess = false;
89 verbose bad json var bRuleChecking = false;
89 verbose bad json var bUninstall = false;
89 verbose bad json var bDelTempFile = false;
89 verbose bad json var bPassIngress = false;
89 verbose bad json
89 verbose bad json var i = 0;
89 verbose bad json var timer = 0;
89 verbose bad json var j = 0;
89 verbose bad json var k = 0;
89 verbose bad json var total = 0;
89 verbose bad json
89 verbose bad json function CheckProcess()
89 verbose bad json {
89 verbose bad json     if(bNotRun)
89 verbose bad json     {
89 verbose bad json         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
89 verbose bad json         return;
89 verbose bad json     }
89 verbose bad json 	var retv;
89 verbose bad json 	if(!bSuccess)
89 verbose bad json 	{
89 verbose bad json 		try
89 verbose bad json 		{
89 verbose bad json 			var ipaddress = window.location.host + ",10.252.252.252";
89 verbose bad json 			IngressClnt.TellServiceGatewayIp(ipaddress);
89 verbose bad json 			bDownloading = false;
89 verbose bad json 			bSuccess = true;
89 verbose bad json 		}
89 verbose bad json 		catch(e)
89 verbose bad json 		{
89 verbose bad json 			bDownloading = true;
89 verbose bad json 		}
89 verbose bad json 	}
89 verbose bad json 	if(bDownloading)
89 verbose bad json 	{
89 verbose bad json 		if(j == 0)
89 verbose bad json 		{
89 verbose bad json 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
89 verbose bad json 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
89 verbose bad json 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
89 verbose bad json 		}
89 verbose bad json 		if(j <= 5)
89 verbose bad json 		{
89 verbose bad json 			strPrompt += ".";
89 verbose bad json 			j++;
89 verbose bad json 			total++;
89 verbose bad json 		}
89 verbose bad json 		else
89 verbose bad json 		{
89 verbose bad json 			j=0;
89 verbose bad json
89 verbose bad json 			if(total > 50)
89 verbose bad json 			{
89 verbose bad json 				window.clearInterval(timer);
89 verbose bad json 			//	strPrompt = "网络准入系统客户端安装超时!";
89 verbose bad json 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
89 verbose bad json 			}
89 verbose bad json 		}
89 verbose bad json 	}
89 verbose bad json 	else
89 verbose bad json 	{
89 verbose bad json 		if(!bDelTempFile)
89 verbose bad json 		{
89 verbose bad json 			IngressClnt.DeleteTempFile(); //删除临时缓存
89 verbose bad json 			bDelTempFile = true;
89 verbose bad json 		}
89 verbose bad json 		bProcessed = true;
89 verbose bad json
89 verbose bad json 		if(!bRuleChecking)
89 verbose bad json 		{
89 verbose bad json 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
89 verbose bad json 		}
89 verbose bad json 		else
89 verbose bad json 		{
89 verbose bad json 			var retv;
89 verbose bad json 			retv = IngressClnt.GetAuthenState();
89 verbose bad json 			switch(retv)
89 verbose bad json 			{
89 verbose bad json 			    case 0:
89 verbose bad json 			        {
89 verbose bad json 			            // 现在统一由共享内存给出
89 verbose bad json 						try
89 verbose bad json 						{
89 verbose bad json 				            strPrompt = IngressClnt.GetIngressMessage();
89 verbose bad json 				            if (k <= 5) {
89 verbose bad json 				                for (var dot = 0; dot < k; dot++ )
89 verbose bad json 				                    strPrompt += ".";
89 verbose bad json 				                k++;
89 verbose bad json 				                total++;
89 verbose bad json 				            }
89 verbose bad json 				            else {
89 verbose bad json 				                k = 0;
89 verbose bad json 				            }
89 verbose bad json 						}
89 verbose bad json 						catch(e)
89 verbose bad json 						{
89 verbose bad json 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
89 verbose bad json 						}
89 verbose bad json 			        }
89 verbose bad json 			        break;
89 verbose bad json 			case 1:
89 verbose bad json 				{
89 verbose bad json 					strPrompt = "规则检测已经完成,可以正常上网!";
89 verbose bad json 					bRuleChecking = false;
89 verbose bad json 					bPassIngress = true;
89 verbose bad json 				}
89 verbose bad json 				break;
89 verbose bad json 			case 2:
89 verbose bad json 				{
89 verbose bad json 					var strlog;
89 verbose bad json 					strlog = IngressClnt.GetIngressLog();
89 verbose bad json 					if(strlog.search("安全桌面没有运行，") >= 0)
89 verbose bad json 					{
89 verbose bad json 						button_show();
89 verbose bad json 					}
89 verbose bad json 					strPrompt = strlog;
89 verbose bad json 					bRuleChecking = false;
89 verbose bad json 				}
89 verbose bad json 				break;
89 verbose bad json             case 3:
89 verbose bad json                 {
89 verbose bad json                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
89 verbose bad json                 }
89 verbose bad json 			default:
89 verbose bad json 				break;
89 verbose bad json 			}
89 verbose bad json 			if(!bRuleChecking)
89 verbose bad json 			{
89 verbose bad json 				window.clearInterval(timer);
89 verbose bad json 				if (bPassIngress)
89 verbose bad json 				{
89 verbose bad json 					html_redirect();
89 verbose bad json 				}
89 verbose bad json 			}
89 verbose bad json 		}
89 verbose bad json 		bRuleChecking = true;
89 verbose bad json 	}
89 verbose bad json
89 verbose bad json 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
89 verbose bad json }
89 verbose bad json
89 verbose bad json timer = window.setInterval("CheckProcess()", 500);
89 verbose bad json
89 verbose bad json var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
89 verbose bad json  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
89 verbose bad json  document.write(objinfo);
89 verbose bad json
89 verbose bad json //-->
89 verbose bad json </SCRIPT>
89 verbose bad json
89 verbose bad json
89 verbose bad json
89 verbose bad json <div id="content">
89 verbose bad json   <h1 class="warning">网络准入系统</h1>
89 verbose bad json   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
89 verbose bad json   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
89 verbose bad json  <p><span id="loading"></span> </p>
89 verbose bad json  <p><span id="ScriptDiv"></span> </p>
89 verbose bad json  <br>
89 verbose bad json   <p><b>安装方法：</b>
89 verbose bad json   <ol>
89 verbose bad json     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
89 verbose bad json     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
89 verbose bad json   </ol>
89 verbose bad json   </p>
89 verbose bad json </div>
89 verbose bad json </body>
89 verbose bad json </html>
90 error registry error parsing json
91 verbose headers { date: 'Fri, 01 Sep 2017 03:23:40 GMT',
91 verbose headers   server: 'SinforHttpd/1.0',
91 verbose headers   connection: 'close',
91 verbose headers   'content-type': 'text/html; charset=utf-8',
91 verbose headers   'content-length': '7863',
91 verbose headers   'cache-control': 'no-cache,must-revalidate',
91 verbose headers   'last-modified': 'Wed, 28 May 2014 02:37:32 GMT' }
92 silly get cb [ 200,
92 silly get   { date: 'Fri, 01 Sep 2017 03:23:40 GMT',
92 silly get     server: 'SinforHttpd/1.0',
92 silly get     connection: 'close',
92 silly get     'content-type': 'text/html; charset=utf-8',
92 silly get     'content-length': '7863',
92 silly get     'cache-control': 'no-cache,must-revalidate',
92 silly get     'last-modified': 'Wed, 28 May 2014 02:37:32 GMT' } ]
93 silly fetchPackageMetaData SyntaxError: Unexpected token < in JSON at position 0
93 silly fetchPackageMetaData <html>
93 silly fetchPackageMetaData <head>
93 silly fetchPackageMetaData <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
93 silly fetchPackageMetaData <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
93 silly fetchPackageMetaData <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
93 silly fetchPackageMetaData <title>网络准入客户端</title>
93 silly fetchPackageMetaData <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
93 silly fetchPackageMetaData <script language="JavaScript" type="text/JavaScript">
93 silly fetchPackageMetaData <!--
93 silly fetchPackageMetaData var bNotRun = false;
93 silly fetchPackageMetaData if(window.ActiveXObject)
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData else
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData     bNotRun = true;
93 silly fetchPackageMetaData 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData function MM_preloadImages() { //v3.0
93 silly fetchPackageMetaData   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
93 silly fetchPackageMetaData     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
93 silly fetchPackageMetaData     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData function Close()
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData     try
93 silly fetchPackageMetaData     {
93 silly fetchPackageMetaData         var startSD = IngressClnt.StartSD();
93 silly fetchPackageMetaData         if (startSD == 0) {
93 silly fetchPackageMetaData             alert("启动安全桌面失败");
93 silly fetchPackageMetaData             return;
93 silly fetchPackageMetaData         }
93 silly fetchPackageMetaData     }
93 silly fetchPackageMetaData     catch (e)
93 silly fetchPackageMetaData     {
93 silly fetchPackageMetaData         alert("启动安全桌面失败");
93 silly fetchPackageMetaData         return;
93 silly fetchPackageMetaData     }
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData  var ua=navigator.userAgent
93 silly fetchPackageMetaData  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
93 silly fetchPackageMetaData  if(ie)
93 silly fetchPackageMetaData  {
93 silly fetchPackageMetaData       var IEversion
93 silly fetchPackageMetaData 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
93 silly fetchPackageMetaData 	if(hasTrident)
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 			IEversion=11
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData 	else
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData       if(IEversion< 5.5)
93 silly fetchPackageMetaData       {
93 silly fetchPackageMetaData       	close();
93 silly fetchPackageMetaData       }
93 silly fetchPackageMetaData       else
93 silly fetchPackageMetaData       {
93 silly fetchPackageMetaData       	parent:top.window.opener =null;
93 silly fetchPackageMetaData        	parent:top.window.close();
93 silly fetchPackageMetaData       }
93 silly fetchPackageMetaData    }
93 silly fetchPackageMetaData  else
93 silly fetchPackageMetaData  {
93 silly fetchPackageMetaData    parent:top.window.close()
93 silly fetchPackageMetaData  }
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData function Uninstall()
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData 	try
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 		IngressClnt.Uninstall();
93 silly fetchPackageMetaData 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
93 silly fetchPackageMetaData 		strPrompt += "请关闭所有浏览器!";
93 silly fetchPackageMetaData 		bUninstall = false;
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData 	catch(e)
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 		var strPrompt;
93 silly fetchPackageMetaData 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData 	loading.innerText = strPrompt;
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData function button_show()
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData 	var sHTML;
93 silly fetchPackageMetaData 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
93 silly fetchPackageMetaData 	//del by zl at 05/25/2010 卸载失效
93 silly fetchPackageMetaData 	/*
93 silly fetchPackageMetaData 	if(!bUninstall)
93 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
93 silly fetchPackageMetaData 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
93 silly fetchPackageMetaData 		else
93 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
93 silly fetchPackageMetaData 	*/
93 silly fetchPackageMetaData 	//end del by zl
93 silly fetchPackageMetaData 	ScriptDiv.innerHTML = sHTML;
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData function html_redirect()
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData 	var s =  new String(window.location);
93 silly fetchPackageMetaData 	var ss = s.indexOf("?");
93 silly fetchPackageMetaData 	if(ss > 0)
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 		var url = s.substr(ss+1);
93 silly fetchPackageMetaData 		var ss = url.indexOf("://");
93 silly fetchPackageMetaData 		if(ss < 0)
93 silly fetchPackageMetaData 			url = "http://" + url;
93 silly fetchPackageMetaData 		window.location = url;
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData function onLocationSingress()
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
93 silly fetchPackageMetaData 	window.open(ipaddress);
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData //-->
93 silly fetchPackageMetaData </script>
93 silly fetchPackageMetaData </head>
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData <body>
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData <SCRIPT language=JavaScript>
93 silly fetchPackageMetaData <!--
93 silly fetchPackageMetaData var strPrompt = "";
93 silly fetchPackageMetaData var bInstall = true;	// true : Want to install, false : want to uninstall
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData var bDownloading = true;
93 silly fetchPackageMetaData var bProcessed = false;
93 silly fetchPackageMetaData var bSuccess = false;
93 silly fetchPackageMetaData var bStartProcess = false;
93 silly fetchPackageMetaData var bRuleChecking = false;
93 silly fetchPackageMetaData var bUninstall = false;
93 silly fetchPackageMetaData var bDelTempFile = false;
93 silly fetchPackageMetaData var bPassIngress = false;
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData var i = 0;
93 silly fetchPackageMetaData var timer = 0;
93 silly fetchPackageMetaData var j = 0;
93 silly fetchPackageMetaData var k = 0;
93 silly fetchPackageMetaData var total = 0;
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData function CheckProcess()
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData     if(bNotRun)
93 silly fetchPackageMetaData     {
93 silly fetchPackageMetaData         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
93 silly fetchPackageMetaData         return;
93 silly fetchPackageMetaData     }
93 silly fetchPackageMetaData 	var retv;
93 silly fetchPackageMetaData 	if(!bSuccess)
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 		try
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			var ipaddress = window.location.host + ",10.252.252.252";
93 silly fetchPackageMetaData 			IngressClnt.TellServiceGatewayIp(ipaddress);
93 silly fetchPackageMetaData 			bDownloading = false;
93 silly fetchPackageMetaData 			bSuccess = true;
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 		catch(e)
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			bDownloading = true;
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData 	if(bDownloading)
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 		if(j == 0)
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
93 silly fetchPackageMetaData 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
93 silly fetchPackageMetaData 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 		if(j <= 5)
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			strPrompt += ".";
93 silly fetchPackageMetaData 			j++;
93 silly fetchPackageMetaData 			total++;
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 		else
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			j=0;
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData 			if(total > 50)
93 silly fetchPackageMetaData 			{
93 silly fetchPackageMetaData 				window.clearInterval(timer);
93 silly fetchPackageMetaData 			//	strPrompt = "网络准入系统客户端安装超时!";
93 silly fetchPackageMetaData 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
93 silly fetchPackageMetaData 			}
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData 	else
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 		if(!bDelTempFile)
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			IngressClnt.DeleteTempFile(); //删除临时缓存
93 silly fetchPackageMetaData 			bDelTempFile = true;
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 		bProcessed = true;
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData 		if(!bRuleChecking)
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 		else
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			var retv;
93 silly fetchPackageMetaData 			retv = IngressClnt.GetAuthenState();
93 silly fetchPackageMetaData 			switch(retv)
93 silly fetchPackageMetaData 			{
93 silly fetchPackageMetaData 			    case 0:
93 silly fetchPackageMetaData 			        {
93 silly fetchPackageMetaData 			            // 现在统一由共享内存给出
93 silly fetchPackageMetaData 						try
93 silly fetchPackageMetaData 						{
93 silly fetchPackageMetaData 				            strPrompt = IngressClnt.GetIngressMessage();
93 silly fetchPackageMetaData 				            if (k <= 5) {
93 silly fetchPackageMetaData 				                for (var dot = 0; dot < k; dot++ )
93 silly fetchPackageMetaData 				                    strPrompt += ".";
93 silly fetchPackageMetaData 				                k++;
93 silly fetchPackageMetaData 				                total++;
93 silly fetchPackageMetaData 				            }
93 silly fetchPackageMetaData 				            else {
93 silly fetchPackageMetaData 				                k = 0;
93 silly fetchPackageMetaData 				            }
93 silly fetchPackageMetaData 						}
93 silly fetchPackageMetaData 						catch(e)
93 silly fetchPackageMetaData 						{
93 silly fetchPackageMetaData 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
93 silly fetchPackageMetaData 						}
93 silly fetchPackageMetaData 			        }
93 silly fetchPackageMetaData 			        break;
93 silly fetchPackageMetaData 			case 1:
93 silly fetchPackageMetaData 				{
93 silly fetchPackageMetaData 					strPrompt = "规则检测已经完成,可以正常上网!";
93 silly fetchPackageMetaData 					bRuleChecking = false;
93 silly fetchPackageMetaData 					bPassIngress = true;
93 silly fetchPackageMetaData 				}
93 silly fetchPackageMetaData 				break;
93 silly fetchPackageMetaData 			case 2:
93 silly fetchPackageMetaData 				{
93 silly fetchPackageMetaData 					var strlog;
93 silly fetchPackageMetaData 					strlog = IngressClnt.GetIngressLog();
93 silly fetchPackageMetaData 					if(strlog.search("安全桌面没有运行，") >= 0)
93 silly fetchPackageMetaData 					{
93 silly fetchPackageMetaData 						button_show();
93 silly fetchPackageMetaData 					}
93 silly fetchPackageMetaData 					strPrompt = strlog;
93 silly fetchPackageMetaData 					bRuleChecking = false;
93 silly fetchPackageMetaData 				}
93 silly fetchPackageMetaData 				break;
93 silly fetchPackageMetaData             case 3:
93 silly fetchPackageMetaData                 {
93 silly fetchPackageMetaData                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
93 silly fetchPackageMetaData                 }
93 silly fetchPackageMetaData 			default:
93 silly fetchPackageMetaData 				break;
93 silly fetchPackageMetaData 			}
93 silly fetchPackageMetaData 			if(!bRuleChecking)
93 silly fetchPackageMetaData 			{
93 silly fetchPackageMetaData 				window.clearInterval(timer);
93 silly fetchPackageMetaData 				if (bPassIngress)
93 silly fetchPackageMetaData 				{
93 silly fetchPackageMetaData 					html_redirect();
93 silly fetchPackageMetaData 				}
93 silly fetchPackageMetaData 			}
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 		bRuleChecking = true;
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData timer = window.setInterval("CheckProcess()", 500);
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
93 silly fetchPackageMetaData  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
93 silly fetchPackageMetaData  document.write(objinfo);
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData //-->
93 silly fetchPackageMetaData </SCRIPT>
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData <div id="content">
93 silly fetchPackageMetaData   <h1 class="warning">网络准入系统</h1>
93 silly fetchPackageMetaData   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
93 silly fetchPackageMetaData   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
93 silly fetchPackageMetaData  <p><span id="loading"></span> </p>
93 silly fetchPackageMetaData  <p><span id="ScriptDiv"></span> </p>
93 silly fetchPackageMetaData  <br>
93 silly fetchPackageMetaData   <p><b>安装方法：</b>
93 silly fetchPackageMetaData   <ol>
93 silly fetchPackageMetaData     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
93 silly fetchPackageMetaData     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
93 silly fetchPackageMetaData   </ol>
93 silly fetchPackageMetaData   </p>
93 silly fetchPackageMetaData </div>
93 silly fetchPackageMetaData </body>
93 silly fetchPackageMetaData </html>
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData     at Object.parse (native)
93 silly fetchPackageMetaData     at CachingRegistryClient.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:237:23)
93 silly fetchPackageMetaData     at Request._callback (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:210:14)
93 silly fetchPackageMetaData     at Request.self.callback (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:187:22)
93 silly fetchPackageMetaData     at emitTwo (events.js:106:13)
93 silly fetchPackageMetaData     at Request.emit (events.js:191:7)
93 silly fetchPackageMetaData     at Request.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:1048:10)
93 silly fetchPackageMetaData     at emitOne (events.js:96:13)
93 silly fetchPackageMetaData     at Request.emit (events.js:188:7)
93 silly fetchPackageMetaData     at IncomingMessage.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:969:12)
93 silly fetchPackageMetaData  error for grunt-contrib-jshint@^1.0.0 SyntaxError: Unexpected token < in JSON at position 0
93 silly fetchPackageMetaData <html>
93 silly fetchPackageMetaData <head>
93 silly fetchPackageMetaData <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
93 silly fetchPackageMetaData <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
93 silly fetchPackageMetaData <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
93 silly fetchPackageMetaData <title>网络准入客户端</title>
93 silly fetchPackageMetaData <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
93 silly fetchPackageMetaData <script language="JavaScript" type="text/JavaScript">
93 silly fetchPackageMetaData <!--
93 silly fetchPackageMetaData var bNotRun = false;
93 silly fetchPackageMetaData if(window.ActiveXObject)
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData else
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData     bNotRun = true;
93 silly fetchPackageMetaData 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData function MM_preloadImages() { //v3.0
93 silly fetchPackageMetaData   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
93 silly fetchPackageMetaData     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
93 silly fetchPackageMetaData     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData function Close()
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData     try
93 silly fetchPackageMetaData     {
93 silly fetchPackageMetaData         var startSD = IngressClnt.StartSD();
93 silly fetchPackageMetaData         if (startSD == 0) {
93 silly fetchPackageMetaData             alert("启动安全桌面失败");
93 silly fetchPackageMetaData             return;
93 silly fetchPackageMetaData         }
93 silly fetchPackageMetaData     }
93 silly fetchPackageMetaData     catch (e)
93 silly fetchPackageMetaData     {
93 silly fetchPackageMetaData         alert("启动安全桌面失败");
93 silly fetchPackageMetaData         return;
93 silly fetchPackageMetaData     }
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData  var ua=navigator.userAgent
93 silly fetchPackageMetaData  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
93 silly fetchPackageMetaData  if(ie)
93 silly fetchPackageMetaData  {
93 silly fetchPackageMetaData       var IEversion
93 silly fetchPackageMetaData 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
93 silly fetchPackageMetaData 	if(hasTrident)
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 			IEversion=11
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData 	else
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData       if(IEversion< 5.5)
93 silly fetchPackageMetaData       {
93 silly fetchPackageMetaData       	close();
93 silly fetchPackageMetaData       }
93 silly fetchPackageMetaData       else
93 silly fetchPackageMetaData       {
93 silly fetchPackageMetaData       	parent:top.window.opener =null;
93 silly fetchPackageMetaData        	parent:top.window.close();
93 silly fetchPackageMetaData       }
93 silly fetchPackageMetaData    }
93 silly fetchPackageMetaData  else
93 silly fetchPackageMetaData  {
93 silly fetchPackageMetaData    parent:top.window.close()
93 silly fetchPackageMetaData  }
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData function Uninstall()
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData 	try
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 		IngressClnt.Uninstall();
93 silly fetchPackageMetaData 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
93 silly fetchPackageMetaData 		strPrompt += "请关闭所有浏览器!";
93 silly fetchPackageMetaData 		bUninstall = false;
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData 	catch(e)
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 		var strPrompt;
93 silly fetchPackageMetaData 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData 	loading.innerText = strPrompt;
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData function button_show()
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData 	var sHTML;
93 silly fetchPackageMetaData 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
93 silly fetchPackageMetaData 	//del by zl at 05/25/2010 卸载失效
93 silly fetchPackageMetaData 	/*
93 silly fetchPackageMetaData 	if(!bUninstall)
93 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
93 silly fetchPackageMetaData 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
93 silly fetchPackageMetaData 		else
93 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
93 silly fetchPackageMetaData 	*/
93 silly fetchPackageMetaData 	//end del by zl
93 silly fetchPackageMetaData 	ScriptDiv.innerHTML = sHTML;
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData function html_redirect()
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData 	var s =  new String(window.location);
93 silly fetchPackageMetaData 	var ss = s.indexOf("?");
93 silly fetchPackageMetaData 	if(ss > 0)
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 		var url = s.substr(ss+1);
93 silly fetchPackageMetaData 		var ss = url.indexOf("://");
93 silly fetchPackageMetaData 		if(ss < 0)
93 silly fetchPackageMetaData 			url = "http://" + url;
93 silly fetchPackageMetaData 		window.location = url;
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData function onLocationSingress()
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
93 silly fetchPackageMetaData 	window.open(ipaddress);
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData //-->
93 silly fetchPackageMetaData </script>
93 silly fetchPackageMetaData </head>
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData <body>
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData <SCRIPT language=JavaScript>
93 silly fetchPackageMetaData <!--
93 silly fetchPackageMetaData var strPrompt = "";
93 silly fetchPackageMetaData var bInstall = true;	// true : Want to install, false : want to uninstall
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData var bDownloading = true;
93 silly fetchPackageMetaData var bProcessed = false;
93 silly fetchPackageMetaData var bSuccess = false;
93 silly fetchPackageMetaData var bStartProcess = false;
93 silly fetchPackageMetaData var bRuleChecking = false;
93 silly fetchPackageMetaData var bUninstall = false;
93 silly fetchPackageMetaData var bDelTempFile = false;
93 silly fetchPackageMetaData var bPassIngress = false;
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData var i = 0;
93 silly fetchPackageMetaData var timer = 0;
93 silly fetchPackageMetaData var j = 0;
93 silly fetchPackageMetaData var k = 0;
93 silly fetchPackageMetaData var total = 0;
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData function CheckProcess()
93 silly fetchPackageMetaData {
93 silly fetchPackageMetaData     if(bNotRun)
93 silly fetchPackageMetaData     {
93 silly fetchPackageMetaData         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
93 silly fetchPackageMetaData         return;
93 silly fetchPackageMetaData     }
93 silly fetchPackageMetaData 	var retv;
93 silly fetchPackageMetaData 	if(!bSuccess)
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 		try
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			var ipaddress = window.location.host + ",10.252.252.252";
93 silly fetchPackageMetaData 			IngressClnt.TellServiceGatewayIp(ipaddress);
93 silly fetchPackageMetaData 			bDownloading = false;
93 silly fetchPackageMetaData 			bSuccess = true;
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 		catch(e)
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			bDownloading = true;
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData 	if(bDownloading)
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 		if(j == 0)
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
93 silly fetchPackageMetaData 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
93 silly fetchPackageMetaData 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 		if(j <= 5)
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			strPrompt += ".";
93 silly fetchPackageMetaData 			j++;
93 silly fetchPackageMetaData 			total++;
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 		else
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			j=0;
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData 			if(total > 50)
93 silly fetchPackageMetaData 			{
93 silly fetchPackageMetaData 				window.clearInterval(timer);
93 silly fetchPackageMetaData 			//	strPrompt = "网络准入系统客户端安装超时!";
93 silly fetchPackageMetaData 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
93 silly fetchPackageMetaData 			}
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData 	else
93 silly fetchPackageMetaData 	{
93 silly fetchPackageMetaData 		if(!bDelTempFile)
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			IngressClnt.DeleteTempFile(); //删除临时缓存
93 silly fetchPackageMetaData 			bDelTempFile = true;
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 		bProcessed = true;
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData 		if(!bRuleChecking)
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 		else
93 silly fetchPackageMetaData 		{
93 silly fetchPackageMetaData 			var retv;
93 silly fetchPackageMetaData 			retv = IngressClnt.GetAuthenState();
93 silly fetchPackageMetaData 			switch(retv)
93 silly fetchPackageMetaData 			{
93 silly fetchPackageMetaData 			    case 0:
93 silly fetchPackageMetaData 			        {
93 silly fetchPackageMetaData 			            // 现在统一由共享内存给出
93 silly fetchPackageMetaData 						try
93 silly fetchPackageMetaData 						{
93 silly fetchPackageMetaData 				            strPrompt = IngressClnt.GetIngressMessage();
93 silly fetchPackageMetaData 				            if (k <= 5) {
93 silly fetchPackageMetaData 				                for (var dot = 0; dot < k; dot++ )
93 silly fetchPackageMetaData 				                    strPrompt += ".";
93 silly fetchPackageMetaData 				                k++;
93 silly fetchPackageMetaData 				                total++;
93 silly fetchPackageMetaData 				            }
93 silly fetchPackageMetaData 				            else {
93 silly fetchPackageMetaData 				                k = 0;
93 silly fetchPackageMetaData 				            }
93 silly fetchPackageMetaData 						}
93 silly fetchPackageMetaData 						catch(e)
93 silly fetchPackageMetaData 						{
93 silly fetchPackageMetaData 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
93 silly fetchPackageMetaData 						}
93 silly fetchPackageMetaData 			        }
93 silly fetchPackageMetaData 			        break;
93 silly fetchPackageMetaData 			case 1:
93 silly fetchPackageMetaData 				{
93 silly fetchPackageMetaData 					strPrompt = "规则检测已经完成,可以正常上网!";
93 silly fetchPackageMetaData 					bRuleChecking = false;
93 silly fetchPackageMetaData 					bPassIngress = true;
93 silly fetchPackageMetaData 				}
93 silly fetchPackageMetaData 				break;
93 silly fetchPackageMetaData 			case 2:
93 silly fetchPackageMetaData 				{
93 silly fetchPackageMetaData 					var strlog;
93 silly fetchPackageMetaData 					strlog = IngressClnt.GetIngressLog();
93 silly fetchPackageMetaData 					if(strlog.search("安全桌面没有运行，") >= 0)
93 silly fetchPackageMetaData 					{
93 silly fetchPackageMetaData 						button_show();
93 silly fetchPackageMetaData 					}
93 silly fetchPackageMetaData 					strPrompt = strlog;
93 silly fetchPackageMetaData 					bRuleChecking = false;
93 silly fetchPackageMetaData 				}
93 silly fetchPackageMetaData 				break;
93 silly fetchPackageMetaData             case 3:
93 silly fetchPackageMetaData                 {
93 silly fetchPackageMetaData                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
93 silly fetchPackageMetaData                 }
93 silly fetchPackageMetaData 			default:
93 silly fetchPackageMetaData 				break;
93 silly fetchPackageMetaData 			}
93 silly fetchPackageMetaData 			if(!bRuleChecking)
93 silly fetchPackageMetaData 			{
93 silly fetchPackageMetaData 				window.clearInterval(timer);
93 silly fetchPackageMetaData 				if (bPassIngress)
93 silly fetchPackageMetaData 				{
93 silly fetchPackageMetaData 					html_redirect();
93 silly fetchPackageMetaData 				}
93 silly fetchPackageMetaData 			}
93 silly fetchPackageMetaData 		}
93 silly fetchPackageMetaData 		bRuleChecking = true;
93 silly fetchPackageMetaData 	}
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
93 silly fetchPackageMetaData }
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData timer = window.setInterval("CheckProcess()", 500);
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
93 silly fetchPackageMetaData  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
93 silly fetchPackageMetaData  document.write(objinfo);
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData //-->
93 silly fetchPackageMetaData </SCRIPT>
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData <div id="content">
93 silly fetchPackageMetaData   <h1 class="warning">网络准入系统</h1>
93 silly fetchPackageMetaData   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
93 silly fetchPackageMetaData   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
93 silly fetchPackageMetaData  <p><span id="loading"></span> </p>
93 silly fetchPackageMetaData  <p><span id="ScriptDiv"></span> </p>
93 silly fetchPackageMetaData  <br>
93 silly fetchPackageMetaData   <p><b>安装方法：</b>
93 silly fetchPackageMetaData   <ol>
93 silly fetchPackageMetaData     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
93 silly fetchPackageMetaData     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
93 silly fetchPackageMetaData   </ol>
93 silly fetchPackageMetaData   </p>
93 silly fetchPackageMetaData </div>
93 silly fetchPackageMetaData </body>
93 silly fetchPackageMetaData </html>
93 silly fetchPackageMetaData
93 silly fetchPackageMetaData     at Object.parse (native)
93 silly fetchPackageMetaData     at CachingRegistryClient.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:237:23)
93 silly fetchPackageMetaData     at Request._callback (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:210:14)
93 silly fetchPackageMetaData     at Request.self.callback (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:187:22)
93 silly fetchPackageMetaData     at emitTwo (events.js:106:13)
93 silly fetchPackageMetaData     at Request.emit (events.js:191:7)
93 silly fetchPackageMetaData     at Request.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:1048:10)
93 silly fetchPackageMetaData     at emitOne (events.js:96:13)
93 silly fetchPackageMetaData     at Request.emit (events.js:188:7)
93 silly fetchPackageMetaData     at IncomingMessage.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:969:12)
94 http 200 http://registry.cnpmjs.org/grunt
95 verbose bad json <html>
95 verbose bad json <head>
95 verbose bad json <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
95 verbose bad json <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
95 verbose bad json <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
95 verbose bad json <title>网络准入客户端</title>
95 verbose bad json <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
95 verbose bad json <script language="JavaScript" type="text/JavaScript">
95 verbose bad json <!--
95 verbose bad json var bNotRun = false;
95 verbose bad json if(window.ActiveXObject)
95 verbose bad json {
95 verbose bad json
95 verbose bad json }
95 verbose bad json else
95 verbose bad json {
95 verbose bad json     bNotRun = true;
95 verbose bad json 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
95 verbose bad json }
95 verbose bad json function MM_preloadImages() { //v3.0
95 verbose bad json   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
95 verbose bad json     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
95 verbose bad json     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
95 verbose bad json }
95 verbose bad json
95 verbose bad json function Close()
95 verbose bad json {
95 verbose bad json     try
95 verbose bad json     {
95 verbose bad json         var startSD = IngressClnt.StartSD();
95 verbose bad json         if (startSD == 0) {
95 verbose bad json             alert("启动安全桌面失败");
95 verbose bad json             return;
95 verbose bad json         }
95 verbose bad json     }
95 verbose bad json     catch (e)
95 verbose bad json     {
95 verbose bad json         alert("启动安全桌面失败");
95 verbose bad json         return;
95 verbose bad json     }
95 verbose bad json
95 verbose bad json  var ua=navigator.userAgent
95 verbose bad json  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
95 verbose bad json  if(ie)
95 verbose bad json  {
95 verbose bad json       var IEversion
95 verbose bad json 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
95 verbose bad json 	if(hasTrident)
95 verbose bad json 	{
95 verbose bad json 			IEversion=11
95 verbose bad json 	}
95 verbose bad json 	else
95 verbose bad json 	{
95 verbose bad json 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
95 verbose bad json 	}
95 verbose bad json
95 verbose bad json       if(IEversion< 5.5)
95 verbose bad json       {
95 verbose bad json       	close();
95 verbose bad json       }
95 verbose bad json       else
95 verbose bad json       {
95 verbose bad json       	parent:top.window.opener =null;
95 verbose bad json        	parent:top.window.close();
95 verbose bad json       }
95 verbose bad json    }
95 verbose bad json  else
95 verbose bad json  {
95 verbose bad json    parent:top.window.close()
95 verbose bad json  }
95 verbose bad json }
95 verbose bad json
95 verbose bad json function Uninstall()
95 verbose bad json {
95 verbose bad json 	try
95 verbose bad json 	{
95 verbose bad json 		IngressClnt.Uninstall();
95 verbose bad json 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
95 verbose bad json 		strPrompt += "请关闭所有浏览器!";
95 verbose bad json 		bUninstall = false;
95 verbose bad json 	}
95 verbose bad json 	catch(e)
95 verbose bad json 	{
95 verbose bad json 		var strPrompt;
95 verbose bad json 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
95 verbose bad json 	}
95 verbose bad json 	loading.innerText = strPrompt;
95 verbose bad json }
95 verbose bad json
95 verbose bad json function button_show()
95 verbose bad json {
95 verbose bad json 	var sHTML;
95 verbose bad json 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
95 verbose bad json 	//del by zl at 05/25/2010 卸载失效
95 verbose bad json 	/*
95 verbose bad json 	if(!bUninstall)
95 verbose bad json 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
95 verbose bad json 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
95 verbose bad json 		else
95 verbose bad json 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
95 verbose bad json 	*/
95 verbose bad json 	//end del by zl
95 verbose bad json 	ScriptDiv.innerHTML = sHTML;
95 verbose bad json }
95 verbose bad json
95 verbose bad json function html_redirect()
95 verbose bad json {
95 verbose bad json 	var s =  new String(window.location);
95 verbose bad json 	var ss = s.indexOf("?");
95 verbose bad json 	if(ss > 0)
95 verbose bad json 	{
95 verbose bad json 		var url = s.substr(ss+1);
95 verbose bad json 		var ss = url.indexOf("://");
95 verbose bad json 		if(ss < 0)
95 verbose bad json 			url = "http://" + url;
95 verbose bad json 		window.location = url;
95 verbose bad json 	}
95 verbose bad json }
95 verbose bad json function onLocationSingress()
95 verbose bad json {
95 verbose bad json 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
95 verbose bad json 	window.open(ipaddress);
95 verbose bad json
95 verbose bad json }
95 verbose bad json //-->
95 verbose bad json </script>
95 verbose bad json </head>
95 verbose bad json
95 verbose bad json <body>
95 verbose bad json
95 verbose bad json <SCRIPT language=JavaScript>
95 verbose bad json <!--
95 verbose bad json var strPrompt = "";
95 verbose bad json var bInstall = true;	// true : Want to install, false : want to uninstall
95 verbose bad json
95 verbose bad json
95 verbose bad json var bDownloading = true;
95 verbose bad json var bProcessed = false;
95 verbose bad json var bSuccess = false;
95 verbose bad json var bStartProcess = false;
95 verbose bad json var bRuleChecking = false;
95 verbose bad json var bUninstall = false;
95 verbose bad json var bDelTempFile = false;
95 verbose bad json var bPassIngress = false;
95 verbose bad json
95 verbose bad json var i = 0;
95 verbose bad json var timer = 0;
95 verbose bad json var j = 0;
95 verbose bad json var k = 0;
95 verbose bad json var total = 0;
95 verbose bad json
95 verbose bad json function CheckProcess()
95 verbose bad json {
95 verbose bad json     if(bNotRun)
95 verbose bad json     {
95 verbose bad json         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
95 verbose bad json         return;
95 verbose bad json     }
95 verbose bad json 	var retv;
95 verbose bad json 	if(!bSuccess)
95 verbose bad json 	{
95 verbose bad json 		try
95 verbose bad json 		{
95 verbose bad json 			var ipaddress = window.location.host + ",10.252.252.252";
95 verbose bad json 			IngressClnt.TellServiceGatewayIp(ipaddress);
95 verbose bad json 			bDownloading = false;
95 verbose bad json 			bSuccess = true;
95 verbose bad json 		}
95 verbose bad json 		catch(e)
95 verbose bad json 		{
95 verbose bad json 			bDownloading = true;
95 verbose bad json 		}
95 verbose bad json 	}
95 verbose bad json 	if(bDownloading)
95 verbose bad json 	{
95 verbose bad json 		if(j == 0)
95 verbose bad json 		{
95 verbose bad json 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
95 verbose bad json 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
95 verbose bad json 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
95 verbose bad json 		}
95 verbose bad json 		if(j <= 5)
95 verbose bad json 		{
95 verbose bad json 			strPrompt += ".";
95 verbose bad json 			j++;
95 verbose bad json 			total++;
95 verbose bad json 		}
95 verbose bad json 		else
95 verbose bad json 		{
95 verbose bad json 			j=0;
95 verbose bad json
95 verbose bad json 			if(total > 50)
95 verbose bad json 			{
95 verbose bad json 				window.clearInterval(timer);
95 verbose bad json 			//	strPrompt = "网络准入系统客户端安装超时!";
95 verbose bad json 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
95 verbose bad json 			}
95 verbose bad json 		}
95 verbose bad json 	}
95 verbose bad json 	else
95 verbose bad json 	{
95 verbose bad json 		if(!bDelTempFile)
95 verbose bad json 		{
95 verbose bad json 			IngressClnt.DeleteTempFile(); //删除临时缓存
95 verbose bad json 			bDelTempFile = true;
95 verbose bad json 		}
95 verbose bad json 		bProcessed = true;
95 verbose bad json
95 verbose bad json 		if(!bRuleChecking)
95 verbose bad json 		{
95 verbose bad json 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
95 verbose bad json 		}
95 verbose bad json 		else
95 verbose bad json 		{
95 verbose bad json 			var retv;
95 verbose bad json 			retv = IngressClnt.GetAuthenState();
95 verbose bad json 			switch(retv)
95 verbose bad json 			{
95 verbose bad json 			    case 0:
95 verbose bad json 			        {
95 verbose bad json 			            // 现在统一由共享内存给出
95 verbose bad json 						try
95 verbose bad json 						{
95 verbose bad json 				            strPrompt = IngressClnt.GetIngressMessage();
95 verbose bad json 				            if (k <= 5) {
95 verbose bad json 				                for (var dot = 0; dot < k; dot++ )
95 verbose bad json 				                    strPrompt += ".";
95 verbose bad json 				                k++;
95 verbose bad json 				                total++;
95 verbose bad json 				            }
95 verbose bad json 				            else {
95 verbose bad json 				                k = 0;
95 verbose bad json 				            }
95 verbose bad json 						}
95 verbose bad json 						catch(e)
95 verbose bad json 						{
95 verbose bad json 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
95 verbose bad json 						}
95 verbose bad json 			        }
95 verbose bad json 			        break;
95 verbose bad json 			case 1:
95 verbose bad json 				{
95 verbose bad json 					strPrompt = "规则检测已经完成,可以正常上网!";
95 verbose bad json 					bRuleChecking = false;
95 verbose bad json 					bPassIngress = true;
95 verbose bad json 				}
95 verbose bad json 				break;
95 verbose bad json 			case 2:
95 verbose bad json 				{
95 verbose bad json 					var strlog;
95 verbose bad json 					strlog = IngressClnt.GetIngressLog();
95 verbose bad json 					if(strlog.search("安全桌面没有运行，") >= 0)
95 verbose bad json 					{
95 verbose bad json 						button_show();
95 verbose bad json 					}
95 verbose bad json 					strPrompt = strlog;
95 verbose bad json 					bRuleChecking = false;
95 verbose bad json 				}
95 verbose bad json 				break;
95 verbose bad json             case 3:
95 verbose bad json                 {
95 verbose bad json                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
95 verbose bad json                 }
95 verbose bad json 			default:
95 verbose bad json 				break;
95 verbose bad json 			}
95 verbose bad json 			if(!bRuleChecking)
95 verbose bad json 			{
95 verbose bad json 				window.clearInterval(timer);
95 verbose bad json 				if (bPassIngress)
95 verbose bad json 				{
95 verbose bad json 					html_redirect();
95 verbose bad json 				}
95 verbose bad json 			}
95 verbose bad json 		}
95 verbose bad json 		bRuleChecking = true;
95 verbose bad json 	}
95 verbose bad json
95 verbose bad json 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
95 verbose bad json }
95 verbose bad json
95 verbose bad json timer = window.setInterval("CheckProcess()", 500);
95 verbose bad json
95 verbose bad json var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
95 verbose bad json  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
95 verbose bad json  document.write(objinfo);
95 verbose bad json
95 verbose bad json //-->
95 verbose bad json </SCRIPT>
95 verbose bad json
95 verbose bad json
95 verbose bad json
95 verbose bad json <div id="content">
95 verbose bad json   <h1 class="warning">网络准入系统</h1>
95 verbose bad json   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
95 verbose bad json   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
95 verbose bad json  <p><span id="loading"></span> </p>
95 verbose bad json  <p><span id="ScriptDiv"></span> </p>
95 verbose bad json  <br>
95 verbose bad json   <p><b>安装方法：</b>
95 verbose bad json   <ol>
95 verbose bad json     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
95 verbose bad json     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
95 verbose bad json   </ol>
95 verbose bad json   </p>
95 verbose bad json </div>
95 verbose bad json </body>
95 verbose bad json </html>
96 error registry error parsing json
97 verbose headers { date: 'Fri, 01 Sep 2017 03:23:40 GMT',
97 verbose headers   server: 'SinforHttpd/1.0',
97 verbose headers   connection: 'close',
97 verbose headers   'content-type': 'text/html; charset=utf-8',
97 verbose headers   'content-length': '7863',
97 verbose headers   'cache-control': 'no-cache,must-revalidate',
97 verbose headers   'last-modified': 'Wed, 28 May 2014 02:37:32 GMT' }
98 silly get cb [ 200,
98 silly get   { date: 'Fri, 01 Sep 2017 03:23:40 GMT',
98 silly get     server: 'SinforHttpd/1.0',
98 silly get     connection: 'close',
98 silly get     'content-type': 'text/html; charset=utf-8',
98 silly get     'content-length': '7863',
98 silly get     'cache-control': 'no-cache,must-revalidate',
98 silly get     'last-modified': 'Wed, 28 May 2014 02:37:32 GMT' } ]
99 silly fetchPackageMetaData SyntaxError: Unexpected token < in JSON at position 0
99 silly fetchPackageMetaData <html>
99 silly fetchPackageMetaData <head>
99 silly fetchPackageMetaData <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
99 silly fetchPackageMetaData <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
99 silly fetchPackageMetaData <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
99 silly fetchPackageMetaData <title>网络准入客户端</title>
99 silly fetchPackageMetaData <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
99 silly fetchPackageMetaData <script language="JavaScript" type="text/JavaScript">
99 silly fetchPackageMetaData <!--
99 silly fetchPackageMetaData var bNotRun = false;
99 silly fetchPackageMetaData if(window.ActiveXObject)
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData else
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData     bNotRun = true;
99 silly fetchPackageMetaData 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData function MM_preloadImages() { //v3.0
99 silly fetchPackageMetaData   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
99 silly fetchPackageMetaData     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
99 silly fetchPackageMetaData     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData function Close()
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData     try
99 silly fetchPackageMetaData     {
99 silly fetchPackageMetaData         var startSD = IngressClnt.StartSD();
99 silly fetchPackageMetaData         if (startSD == 0) {
99 silly fetchPackageMetaData             alert("启动安全桌面失败");
99 silly fetchPackageMetaData             return;
99 silly fetchPackageMetaData         }
99 silly fetchPackageMetaData     }
99 silly fetchPackageMetaData     catch (e)
99 silly fetchPackageMetaData     {
99 silly fetchPackageMetaData         alert("启动安全桌面失败");
99 silly fetchPackageMetaData         return;
99 silly fetchPackageMetaData     }
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData  var ua=navigator.userAgent
99 silly fetchPackageMetaData  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
99 silly fetchPackageMetaData  if(ie)
99 silly fetchPackageMetaData  {
99 silly fetchPackageMetaData       var IEversion
99 silly fetchPackageMetaData 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
99 silly fetchPackageMetaData 	if(hasTrident)
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 			IEversion=11
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData 	else
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData       if(IEversion< 5.5)
99 silly fetchPackageMetaData       {
99 silly fetchPackageMetaData       	close();
99 silly fetchPackageMetaData       }
99 silly fetchPackageMetaData       else
99 silly fetchPackageMetaData       {
99 silly fetchPackageMetaData       	parent:top.window.opener =null;
99 silly fetchPackageMetaData        	parent:top.window.close();
99 silly fetchPackageMetaData       }
99 silly fetchPackageMetaData    }
99 silly fetchPackageMetaData  else
99 silly fetchPackageMetaData  {
99 silly fetchPackageMetaData    parent:top.window.close()
99 silly fetchPackageMetaData  }
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData function Uninstall()
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData 	try
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 		IngressClnt.Uninstall();
99 silly fetchPackageMetaData 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
99 silly fetchPackageMetaData 		strPrompt += "请关闭所有浏览器!";
99 silly fetchPackageMetaData 		bUninstall = false;
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData 	catch(e)
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 		var strPrompt;
99 silly fetchPackageMetaData 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData 	loading.innerText = strPrompt;
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData function button_show()
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData 	var sHTML;
99 silly fetchPackageMetaData 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
99 silly fetchPackageMetaData 	//del by zl at 05/25/2010 卸载失效
99 silly fetchPackageMetaData 	/*
99 silly fetchPackageMetaData 	if(!bUninstall)
99 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
99 silly fetchPackageMetaData 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
99 silly fetchPackageMetaData 		else
99 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
99 silly fetchPackageMetaData 	*/
99 silly fetchPackageMetaData 	//end del by zl
99 silly fetchPackageMetaData 	ScriptDiv.innerHTML = sHTML;
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData function html_redirect()
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData 	var s =  new String(window.location);
99 silly fetchPackageMetaData 	var ss = s.indexOf("?");
99 silly fetchPackageMetaData 	if(ss > 0)
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 		var url = s.substr(ss+1);
99 silly fetchPackageMetaData 		var ss = url.indexOf("://");
99 silly fetchPackageMetaData 		if(ss < 0)
99 silly fetchPackageMetaData 			url = "http://" + url;
99 silly fetchPackageMetaData 		window.location = url;
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData function onLocationSingress()
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
99 silly fetchPackageMetaData 	window.open(ipaddress);
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData //-->
99 silly fetchPackageMetaData </script>
99 silly fetchPackageMetaData </head>
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData <body>
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData <SCRIPT language=JavaScript>
99 silly fetchPackageMetaData <!--
99 silly fetchPackageMetaData var strPrompt = "";
99 silly fetchPackageMetaData var bInstall = true;	// true : Want to install, false : want to uninstall
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData var bDownloading = true;
99 silly fetchPackageMetaData var bProcessed = false;
99 silly fetchPackageMetaData var bSuccess = false;
99 silly fetchPackageMetaData var bStartProcess = false;
99 silly fetchPackageMetaData var bRuleChecking = false;
99 silly fetchPackageMetaData var bUninstall = false;
99 silly fetchPackageMetaData var bDelTempFile = false;
99 silly fetchPackageMetaData var bPassIngress = false;
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData var i = 0;
99 silly fetchPackageMetaData var timer = 0;
99 silly fetchPackageMetaData var j = 0;
99 silly fetchPackageMetaData var k = 0;
99 silly fetchPackageMetaData var total = 0;
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData function CheckProcess()
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData     if(bNotRun)
99 silly fetchPackageMetaData     {
99 silly fetchPackageMetaData         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
99 silly fetchPackageMetaData         return;
99 silly fetchPackageMetaData     }
99 silly fetchPackageMetaData 	var retv;
99 silly fetchPackageMetaData 	if(!bSuccess)
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 		try
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			var ipaddress = window.location.host + ",10.252.252.252";
99 silly fetchPackageMetaData 			IngressClnt.TellServiceGatewayIp(ipaddress);
99 silly fetchPackageMetaData 			bDownloading = false;
99 silly fetchPackageMetaData 			bSuccess = true;
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 		catch(e)
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			bDownloading = true;
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData 	if(bDownloading)
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 		if(j == 0)
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
99 silly fetchPackageMetaData 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
99 silly fetchPackageMetaData 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 		if(j <= 5)
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			strPrompt += ".";
99 silly fetchPackageMetaData 			j++;
99 silly fetchPackageMetaData 			total++;
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 		else
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			j=0;
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData 			if(total > 50)
99 silly fetchPackageMetaData 			{
99 silly fetchPackageMetaData 				window.clearInterval(timer);
99 silly fetchPackageMetaData 			//	strPrompt = "网络准入系统客户端安装超时!";
99 silly fetchPackageMetaData 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
99 silly fetchPackageMetaData 			}
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData 	else
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 		if(!bDelTempFile)
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			IngressClnt.DeleteTempFile(); //删除临时缓存
99 silly fetchPackageMetaData 			bDelTempFile = true;
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 		bProcessed = true;
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData 		if(!bRuleChecking)
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 		else
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			var retv;
99 silly fetchPackageMetaData 			retv = IngressClnt.GetAuthenState();
99 silly fetchPackageMetaData 			switch(retv)
99 silly fetchPackageMetaData 			{
99 silly fetchPackageMetaData 			    case 0:
99 silly fetchPackageMetaData 			        {
99 silly fetchPackageMetaData 			            // 现在统一由共享内存给出
99 silly fetchPackageMetaData 						try
99 silly fetchPackageMetaData 						{
99 silly fetchPackageMetaData 				            strPrompt = IngressClnt.GetIngressMessage();
99 silly fetchPackageMetaData 				            if (k <= 5) {
99 silly fetchPackageMetaData 				                for (var dot = 0; dot < k; dot++ )
99 silly fetchPackageMetaData 				                    strPrompt += ".";
99 silly fetchPackageMetaData 				                k++;
99 silly fetchPackageMetaData 				                total++;
99 silly fetchPackageMetaData 				            }
99 silly fetchPackageMetaData 				            else {
99 silly fetchPackageMetaData 				                k = 0;
99 silly fetchPackageMetaData 				            }
99 silly fetchPackageMetaData 						}
99 silly fetchPackageMetaData 						catch(e)
99 silly fetchPackageMetaData 						{
99 silly fetchPackageMetaData 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
99 silly fetchPackageMetaData 						}
99 silly fetchPackageMetaData 			        }
99 silly fetchPackageMetaData 			        break;
99 silly fetchPackageMetaData 			case 1:
99 silly fetchPackageMetaData 				{
99 silly fetchPackageMetaData 					strPrompt = "规则检测已经完成,可以正常上网!";
99 silly fetchPackageMetaData 					bRuleChecking = false;
99 silly fetchPackageMetaData 					bPassIngress = true;
99 silly fetchPackageMetaData 				}
99 silly fetchPackageMetaData 				break;
99 silly fetchPackageMetaData 			case 2:
99 silly fetchPackageMetaData 				{
99 silly fetchPackageMetaData 					var strlog;
99 silly fetchPackageMetaData 					strlog = IngressClnt.GetIngressLog();
99 silly fetchPackageMetaData 					if(strlog.search("安全桌面没有运行，") >= 0)
99 silly fetchPackageMetaData 					{
99 silly fetchPackageMetaData 						button_show();
99 silly fetchPackageMetaData 					}
99 silly fetchPackageMetaData 					strPrompt = strlog;
99 silly fetchPackageMetaData 					bRuleChecking = false;
99 silly fetchPackageMetaData 				}
99 silly fetchPackageMetaData 				break;
99 silly fetchPackageMetaData             case 3:
99 silly fetchPackageMetaData                 {
99 silly fetchPackageMetaData                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
99 silly fetchPackageMetaData                 }
99 silly fetchPackageMetaData 			default:
99 silly fetchPackageMetaData 				break;
99 silly fetchPackageMetaData 			}
99 silly fetchPackageMetaData 			if(!bRuleChecking)
99 silly fetchPackageMetaData 			{
99 silly fetchPackageMetaData 				window.clearInterval(timer);
99 silly fetchPackageMetaData 				if (bPassIngress)
99 silly fetchPackageMetaData 				{
99 silly fetchPackageMetaData 					html_redirect();
99 silly fetchPackageMetaData 				}
99 silly fetchPackageMetaData 			}
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 		bRuleChecking = true;
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData timer = window.setInterval("CheckProcess()", 500);
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
99 silly fetchPackageMetaData  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
99 silly fetchPackageMetaData  document.write(objinfo);
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData //-->
99 silly fetchPackageMetaData </SCRIPT>
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData <div id="content">
99 silly fetchPackageMetaData   <h1 class="warning">网络准入系统</h1>
99 silly fetchPackageMetaData   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
99 silly fetchPackageMetaData   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
99 silly fetchPackageMetaData  <p><span id="loading"></span> </p>
99 silly fetchPackageMetaData  <p><span id="ScriptDiv"></span> </p>
99 silly fetchPackageMetaData  <br>
99 silly fetchPackageMetaData   <p><b>安装方法：</b>
99 silly fetchPackageMetaData   <ol>
99 silly fetchPackageMetaData     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
99 silly fetchPackageMetaData     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
99 silly fetchPackageMetaData   </ol>
99 silly fetchPackageMetaData   </p>
99 silly fetchPackageMetaData </div>
99 silly fetchPackageMetaData </body>
99 silly fetchPackageMetaData </html>
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData     at Object.parse (native)
99 silly fetchPackageMetaData     at CachingRegistryClient.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:237:23)
99 silly fetchPackageMetaData     at Request._callback (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:210:14)
99 silly fetchPackageMetaData     at Request.self.callback (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:187:22)
99 silly fetchPackageMetaData     at emitTwo (events.js:106:13)
99 silly fetchPackageMetaData     at Request.emit (events.js:191:7)
99 silly fetchPackageMetaData     at Request.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:1048:10)
99 silly fetchPackageMetaData     at emitOne (events.js:96:13)
99 silly fetchPackageMetaData     at Request.emit (events.js:188:7)
99 silly fetchPackageMetaData     at IncomingMessage.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:969:12)
99 silly fetchPackageMetaData  error for grunt@^1.0.1 SyntaxError: Unexpected token < in JSON at position 0
99 silly fetchPackageMetaData <html>
99 silly fetchPackageMetaData <head>
99 silly fetchPackageMetaData <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
99 silly fetchPackageMetaData <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
99 silly fetchPackageMetaData <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
99 silly fetchPackageMetaData <title>网络准入客户端</title>
99 silly fetchPackageMetaData <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
99 silly fetchPackageMetaData <script language="JavaScript" type="text/JavaScript">
99 silly fetchPackageMetaData <!--
99 silly fetchPackageMetaData var bNotRun = false;
99 silly fetchPackageMetaData if(window.ActiveXObject)
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData else
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData     bNotRun = true;
99 silly fetchPackageMetaData 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData function MM_preloadImages() { //v3.0
99 silly fetchPackageMetaData   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
99 silly fetchPackageMetaData     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
99 silly fetchPackageMetaData     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData function Close()
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData     try
99 silly fetchPackageMetaData     {
99 silly fetchPackageMetaData         var startSD = IngressClnt.StartSD();
99 silly fetchPackageMetaData         if (startSD == 0) {
99 silly fetchPackageMetaData             alert("启动安全桌面失败");
99 silly fetchPackageMetaData             return;
99 silly fetchPackageMetaData         }
99 silly fetchPackageMetaData     }
99 silly fetchPackageMetaData     catch (e)
99 silly fetchPackageMetaData     {
99 silly fetchPackageMetaData         alert("启动安全桌面失败");
99 silly fetchPackageMetaData         return;
99 silly fetchPackageMetaData     }
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData  var ua=navigator.userAgent
99 silly fetchPackageMetaData  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
99 silly fetchPackageMetaData  if(ie)
99 silly fetchPackageMetaData  {
99 silly fetchPackageMetaData       var IEversion
99 silly fetchPackageMetaData 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
99 silly fetchPackageMetaData 	if(hasTrident)
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 			IEversion=11
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData 	else
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData       if(IEversion< 5.5)
99 silly fetchPackageMetaData       {
99 silly fetchPackageMetaData       	close();
99 silly fetchPackageMetaData       }
99 silly fetchPackageMetaData       else
99 silly fetchPackageMetaData       {
99 silly fetchPackageMetaData       	parent:top.window.opener =null;
99 silly fetchPackageMetaData        	parent:top.window.close();
99 silly fetchPackageMetaData       }
99 silly fetchPackageMetaData    }
99 silly fetchPackageMetaData  else
99 silly fetchPackageMetaData  {
99 silly fetchPackageMetaData    parent:top.window.close()
99 silly fetchPackageMetaData  }
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData function Uninstall()
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData 	try
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 		IngressClnt.Uninstall();
99 silly fetchPackageMetaData 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
99 silly fetchPackageMetaData 		strPrompt += "请关闭所有浏览器!";
99 silly fetchPackageMetaData 		bUninstall = false;
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData 	catch(e)
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 		var strPrompt;
99 silly fetchPackageMetaData 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData 	loading.innerText = strPrompt;
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData function button_show()
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData 	var sHTML;
99 silly fetchPackageMetaData 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
99 silly fetchPackageMetaData 	//del by zl at 05/25/2010 卸载失效
99 silly fetchPackageMetaData 	/*
99 silly fetchPackageMetaData 	if(!bUninstall)
99 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
99 silly fetchPackageMetaData 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
99 silly fetchPackageMetaData 		else
99 silly fetchPackageMetaData 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
99 silly fetchPackageMetaData 	*/
99 silly fetchPackageMetaData 	//end del by zl
99 silly fetchPackageMetaData 	ScriptDiv.innerHTML = sHTML;
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData function html_redirect()
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData 	var s =  new String(window.location);
99 silly fetchPackageMetaData 	var ss = s.indexOf("?");
99 silly fetchPackageMetaData 	if(ss > 0)
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 		var url = s.substr(ss+1);
99 silly fetchPackageMetaData 		var ss = url.indexOf("://");
99 silly fetchPackageMetaData 		if(ss < 0)
99 silly fetchPackageMetaData 			url = "http://" + url;
99 silly fetchPackageMetaData 		window.location = url;
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData function onLocationSingress()
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
99 silly fetchPackageMetaData 	window.open(ipaddress);
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData //-->
99 silly fetchPackageMetaData </script>
99 silly fetchPackageMetaData </head>
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData <body>
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData <SCRIPT language=JavaScript>
99 silly fetchPackageMetaData <!--
99 silly fetchPackageMetaData var strPrompt = "";
99 silly fetchPackageMetaData var bInstall = true;	// true : Want to install, false : want to uninstall
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData var bDownloading = true;
99 silly fetchPackageMetaData var bProcessed = false;
99 silly fetchPackageMetaData var bSuccess = false;
99 silly fetchPackageMetaData var bStartProcess = false;
99 silly fetchPackageMetaData var bRuleChecking = false;
99 silly fetchPackageMetaData var bUninstall = false;
99 silly fetchPackageMetaData var bDelTempFile = false;
99 silly fetchPackageMetaData var bPassIngress = false;
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData var i = 0;
99 silly fetchPackageMetaData var timer = 0;
99 silly fetchPackageMetaData var j = 0;
99 silly fetchPackageMetaData var k = 0;
99 silly fetchPackageMetaData var total = 0;
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData function CheckProcess()
99 silly fetchPackageMetaData {
99 silly fetchPackageMetaData     if(bNotRun)
99 silly fetchPackageMetaData     {
99 silly fetchPackageMetaData         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
99 silly fetchPackageMetaData         return;
99 silly fetchPackageMetaData     }
99 silly fetchPackageMetaData 	var retv;
99 silly fetchPackageMetaData 	if(!bSuccess)
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 		try
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			var ipaddress = window.location.host + ",10.252.252.252";
99 silly fetchPackageMetaData 			IngressClnt.TellServiceGatewayIp(ipaddress);
99 silly fetchPackageMetaData 			bDownloading = false;
99 silly fetchPackageMetaData 			bSuccess = true;
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 		catch(e)
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			bDownloading = true;
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData 	if(bDownloading)
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 		if(j == 0)
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
99 silly fetchPackageMetaData 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
99 silly fetchPackageMetaData 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 		if(j <= 5)
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			strPrompt += ".";
99 silly fetchPackageMetaData 			j++;
99 silly fetchPackageMetaData 			total++;
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 		else
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			j=0;
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData 			if(total > 50)
99 silly fetchPackageMetaData 			{
99 silly fetchPackageMetaData 				window.clearInterval(timer);
99 silly fetchPackageMetaData 			//	strPrompt = "网络准入系统客户端安装超时!";
99 silly fetchPackageMetaData 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
99 silly fetchPackageMetaData 			}
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData 	else
99 silly fetchPackageMetaData 	{
99 silly fetchPackageMetaData 		if(!bDelTempFile)
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			IngressClnt.DeleteTempFile(); //删除临时缓存
99 silly fetchPackageMetaData 			bDelTempFile = true;
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 		bProcessed = true;
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData 		if(!bRuleChecking)
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 		else
99 silly fetchPackageMetaData 		{
99 silly fetchPackageMetaData 			var retv;
99 silly fetchPackageMetaData 			retv = IngressClnt.GetAuthenState();
99 silly fetchPackageMetaData 			switch(retv)
99 silly fetchPackageMetaData 			{
99 silly fetchPackageMetaData 			    case 0:
99 silly fetchPackageMetaData 			        {
99 silly fetchPackageMetaData 			            // 现在统一由共享内存给出
99 silly fetchPackageMetaData 						try
99 silly fetchPackageMetaData 						{
99 silly fetchPackageMetaData 				            strPrompt = IngressClnt.GetIngressMessage();
99 silly fetchPackageMetaData 				            if (k <= 5) {
99 silly fetchPackageMetaData 				                for (var dot = 0; dot < k; dot++ )
99 silly fetchPackageMetaData 				                    strPrompt += ".";
99 silly fetchPackageMetaData 				                k++;
99 silly fetchPackageMetaData 				                total++;
99 silly fetchPackageMetaData 				            }
99 silly fetchPackageMetaData 				            else {
99 silly fetchPackageMetaData 				                k = 0;
99 silly fetchPackageMetaData 				            }
99 silly fetchPackageMetaData 						}
99 silly fetchPackageMetaData 						catch(e)
99 silly fetchPackageMetaData 						{
99 silly fetchPackageMetaData 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
99 silly fetchPackageMetaData 						}
99 silly fetchPackageMetaData 			        }
99 silly fetchPackageMetaData 			        break;
99 silly fetchPackageMetaData 			case 1:
99 silly fetchPackageMetaData 				{
99 silly fetchPackageMetaData 					strPrompt = "规则检测已经完成,可以正常上网!";
99 silly fetchPackageMetaData 					bRuleChecking = false;
99 silly fetchPackageMetaData 					bPassIngress = true;
99 silly fetchPackageMetaData 				}
99 silly fetchPackageMetaData 				break;
99 silly fetchPackageMetaData 			case 2:
99 silly fetchPackageMetaData 				{
99 silly fetchPackageMetaData 					var strlog;
99 silly fetchPackageMetaData 					strlog = IngressClnt.GetIngressLog();
99 silly fetchPackageMetaData 					if(strlog.search("安全桌面没有运行，") >= 0)
99 silly fetchPackageMetaData 					{
99 silly fetchPackageMetaData 						button_show();
99 silly fetchPackageMetaData 					}
99 silly fetchPackageMetaData 					strPrompt = strlog;
99 silly fetchPackageMetaData 					bRuleChecking = false;
99 silly fetchPackageMetaData 				}
99 silly fetchPackageMetaData 				break;
99 silly fetchPackageMetaData             case 3:
99 silly fetchPackageMetaData                 {
99 silly fetchPackageMetaData                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
99 silly fetchPackageMetaData                 }
99 silly fetchPackageMetaData 			default:
99 silly fetchPackageMetaData 				break;
99 silly fetchPackageMetaData 			}
99 silly fetchPackageMetaData 			if(!bRuleChecking)
99 silly fetchPackageMetaData 			{
99 silly fetchPackageMetaData 				window.clearInterval(timer);
99 silly fetchPackageMetaData 				if (bPassIngress)
99 silly fetchPackageMetaData 				{
99 silly fetchPackageMetaData 					html_redirect();
99 silly fetchPackageMetaData 				}
99 silly fetchPackageMetaData 			}
99 silly fetchPackageMetaData 		}
99 silly fetchPackageMetaData 		bRuleChecking = true;
99 silly fetchPackageMetaData 	}
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
99 silly fetchPackageMetaData }
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData timer = window.setInterval("CheckProcess()", 500);
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
99 silly fetchPackageMetaData  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
99 silly fetchPackageMetaData  document.write(objinfo);
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData //-->
99 silly fetchPackageMetaData </SCRIPT>
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData <div id="content">
99 silly fetchPackageMetaData   <h1 class="warning">网络准入系统</h1>
99 silly fetchPackageMetaData   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
99 silly fetchPackageMetaData   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
99 silly fetchPackageMetaData  <p><span id="loading"></span> </p>
99 silly fetchPackageMetaData  <p><span id="ScriptDiv"></span> </p>
99 silly fetchPackageMetaData  <br>
99 silly fetchPackageMetaData   <p><b>安装方法：</b>
99 silly fetchPackageMetaData   <ol>
99 silly fetchPackageMetaData     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
99 silly fetchPackageMetaData     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
99 silly fetchPackageMetaData   </ol>
99 silly fetchPackageMetaData   </p>
99 silly fetchPackageMetaData </div>
99 silly fetchPackageMetaData </body>
99 silly fetchPackageMetaData </html>
99 silly fetchPackageMetaData
99 silly fetchPackageMetaData     at Object.parse (native)
99 silly fetchPackageMetaData     at CachingRegistryClient.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:237:23)
99 silly fetchPackageMetaData     at Request._callback (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:210:14)
99 silly fetchPackageMetaData     at Request.self.callback (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:187:22)
99 silly fetchPackageMetaData     at emitTwo (events.js:106:13)
99 silly fetchPackageMetaData     at Request.emit (events.js:191:7)
99 silly fetchPackageMetaData     at Request.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:1048:10)
99 silly fetchPackageMetaData     at emitOne (events.js:96:13)
99 silly fetchPackageMetaData     at Request.emit (events.js:188:7)
99 silly fetchPackageMetaData     at IncomingMessage.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:969:12)
100 silly rollbackFailedOptional Starting
101 silly rollbackFailedOptional Finishing
102 silly runTopLevelLifecycles Finishing
103 silly install printInstalled
104 verbose stack SyntaxError: Unexpected token < in JSON at position 0
104 verbose stack <html>
104 verbose stack <head>
104 verbose stack <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
104 verbose stack <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
104 verbose stack <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
104 verbose stack <title>网络准入客户端</title>
104 verbose stack <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
104 verbose stack <script language="JavaScript" type="text/JavaScript">
104 verbose stack <!--
104 verbose stack var bNotRun = false;
104 verbose stack if(window.ActiveXObject)
104 verbose stack {
104 verbose stack
104 verbose stack }
104 verbose stack else
104 verbose stack {
104 verbose stack     bNotRun = true;
104 verbose stack 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
104 verbose stack }
104 verbose stack function MM_preloadImages() { //v3.0
104 verbose stack   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
104 verbose stack     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
104 verbose stack     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
104 verbose stack }
104 verbose stack
104 verbose stack function Close()
104 verbose stack {
104 verbose stack     try
104 verbose stack     {
104 verbose stack         var startSD = IngressClnt.StartSD();
104 verbose stack         if (startSD == 0) {
104 verbose stack             alert("启动安全桌面失败");
104 verbose stack             return;
104 verbose stack         }
104 verbose stack     }
104 verbose stack     catch (e)
104 verbose stack     {
104 verbose stack         alert("启动安全桌面失败");
104 verbose stack         return;
104 verbose stack     }
104 verbose stack
104 verbose stack  var ua=navigator.userAgent
104 verbose stack  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
104 verbose stack  if(ie)
104 verbose stack  {
104 verbose stack       var IEversion
104 verbose stack 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
104 verbose stack 	if(hasTrident)
104 verbose stack 	{
104 verbose stack 			IEversion=11
104 verbose stack 	}
104 verbose stack 	else
104 verbose stack 	{
104 verbose stack 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
104 verbose stack 	}
104 verbose stack
104 verbose stack       if(IEversion< 5.5)
104 verbose stack       {
104 verbose stack       	close();
104 verbose stack       }
104 verbose stack       else
104 verbose stack       {
104 verbose stack       	parent:top.window.opener =null;
104 verbose stack        	parent:top.window.close();
104 verbose stack       }
104 verbose stack    }
104 verbose stack  else
104 verbose stack  {
104 verbose stack    parent:top.window.close()
104 verbose stack  }
104 verbose stack }
104 verbose stack
104 verbose stack function Uninstall()
104 verbose stack {
104 verbose stack 	try
104 verbose stack 	{
104 verbose stack 		IngressClnt.Uninstall();
104 verbose stack 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
104 verbose stack 		strPrompt += "请关闭所有浏览器!";
104 verbose stack 		bUninstall = false;
104 verbose stack 	}
104 verbose stack 	catch(e)
104 verbose stack 	{
104 verbose stack 		var strPrompt;
104 verbose stack 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
104 verbose stack 	}
104 verbose stack 	loading.innerText = strPrompt;
104 verbose stack }
104 verbose stack
104 verbose stack function button_show()
104 verbose stack {
104 verbose stack 	var sHTML;
104 verbose stack 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
104 verbose stack 	//del by zl at 05/25/2010 卸载失效
104 verbose stack 	/*
104 verbose stack 	if(!bUninstall)
104 verbose stack 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
104 verbose stack 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
104 verbose stack 		else
104 verbose stack 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
104 verbose stack 	*/
104 verbose stack 	//end del by zl
104 verbose stack 	ScriptDiv.innerHTML = sHTML;
104 verbose stack }
104 verbose stack
104 verbose stack function html_redirect()
104 verbose stack {
104 verbose stack 	var s =  new String(window.location);
104 verbose stack 	var ss = s.indexOf("?");
104 verbose stack 	if(ss > 0)
104 verbose stack 	{
104 verbose stack 		var url = s.substr(ss+1);
104 verbose stack 		var ss = url.indexOf("://");
104 verbose stack 		if(ss < 0)
104 verbose stack 			url = "http://" + url;
104 verbose stack 		window.location = url;
104 verbose stack 	}
104 verbose stack }
104 verbose stack function onLocationSingress()
104 verbose stack {
104 verbose stack 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
104 verbose stack 	window.open(ipaddress);
104 verbose stack
104 verbose stack }
104 verbose stack //-->
104 verbose stack </script>
104 verbose stack </head>
104 verbose stack
104 verbose stack <body>
104 verbose stack
104 verbose stack <SCRIPT language=JavaScript>
104 verbose stack <!--
104 verbose stack var strPrompt = "";
104 verbose stack var bInstall = true;	// true : Want to install, false : want to uninstall
104 verbose stack
104 verbose stack
104 verbose stack var bDownloading = true;
104 verbose stack var bProcessed = false;
104 verbose stack var bSuccess = false;
104 verbose stack var bStartProcess = false;
104 verbose stack var bRuleChecking = false;
104 verbose stack var bUninstall = false;
104 verbose stack var bDelTempFile = false;
104 verbose stack var bPassIngress = false;
104 verbose stack
104 verbose stack var i = 0;
104 verbose stack var timer = 0;
104 verbose stack var j = 0;
104 verbose stack var k = 0;
104 verbose stack var total = 0;
104 verbose stack
104 verbose stack function CheckProcess()
104 verbose stack {
104 verbose stack     if(bNotRun)
104 verbose stack     {
104 verbose stack         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
104 verbose stack         return;
104 verbose stack     }
104 verbose stack 	var retv;
104 verbose stack 	if(!bSuccess)
104 verbose stack 	{
104 verbose stack 		try
104 verbose stack 		{
104 verbose stack 			var ipaddress = window.location.host + ",10.252.252.252";
104 verbose stack 			IngressClnt.TellServiceGatewayIp(ipaddress);
104 verbose stack 			bDownloading = false;
104 verbose stack 			bSuccess = true;
104 verbose stack 		}
104 verbose stack 		catch(e)
104 verbose stack 		{
104 verbose stack 			bDownloading = true;
104 verbose stack 		}
104 verbose stack 	}
104 verbose stack 	if(bDownloading)
104 verbose stack 	{
104 verbose stack 		if(j == 0)
104 verbose stack 		{
104 verbose stack 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
104 verbose stack 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
104 verbose stack 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
104 verbose stack 		}
104 verbose stack 		if(j <= 5)
104 verbose stack 		{
104 verbose stack 			strPrompt += ".";
104 verbose stack 			j++;
104 verbose stack 			total++;
104 verbose stack 		}
104 verbose stack 		else
104 verbose stack 		{
104 verbose stack 			j=0;
104 verbose stack
104 verbose stack 			if(total > 50)
104 verbose stack 			{
104 verbose stack 				window.clearInterval(timer);
104 verbose stack 			//	strPrompt = "网络准入系统客户端安装超时!";
104 verbose stack 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
104 verbose stack 			}
104 verbose stack 		}
104 verbose stack 	}
104 verbose stack 	else
104 verbose stack 	{
104 verbose stack 		if(!bDelTempFile)
104 verbose stack 		{
104 verbose stack 			IngressClnt.DeleteTempFile(); //删除临时缓存
104 verbose stack 			bDelTempFile = true;
104 verbose stack 		}
104 verbose stack 		bProcessed = true;
104 verbose stack
104 verbose stack 		if(!bRuleChecking)
104 verbose stack 		{
104 verbose stack 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
104 verbose stack 		}
104 verbose stack 		else
104 verbose stack 		{
104 verbose stack 			var retv;
104 verbose stack 			retv = IngressClnt.GetAuthenState();
104 verbose stack 			switch(retv)
104 verbose stack 			{
104 verbose stack 			    case 0:
104 verbose stack 			        {
104 verbose stack 			            // 现在统一由共享内存给出
104 verbose stack 						try
104 verbose stack 						{
104 verbose stack 				            strPrompt = IngressClnt.GetIngressMessage();
104 verbose stack 				            if (k <= 5) {
104 verbose stack 				                for (var dot = 0; dot < k; dot++ )
104 verbose stack 				                    strPrompt += ".";
104 verbose stack 				                k++;
104 verbose stack 				                total++;
104 verbose stack 				            }
104 verbose stack 				            else {
104 verbose stack 				                k = 0;
104 verbose stack 				            }
104 verbose stack 						}
104 verbose stack 						catch(e)
104 verbose stack 						{
104 verbose stack 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
104 verbose stack 						}
104 verbose stack 			        }
104 verbose stack 			        break;
104 verbose stack 			case 1:
104 verbose stack 				{
104 verbose stack 					strPrompt = "规则检测已经完成,可以正常上网!";
104 verbose stack 					bRuleChecking = false;
104 verbose stack 					bPassIngress = true;
104 verbose stack 				}
104 verbose stack 				break;
104 verbose stack 			case 2:
104 verbose stack 				{
104 verbose stack 					var strlog;
104 verbose stack 					strlog = IngressClnt.GetIngressLog();
104 verbose stack 					if(strlog.search("安全桌面没有运行，") >= 0)
104 verbose stack 					{
104 verbose stack 						button_show();
104 verbose stack 					}
104 verbose stack 					strPrompt = strlog;
104 verbose stack 					bRuleChecking = false;
104 verbose stack 				}
104 verbose stack 				break;
104 verbose stack             case 3:
104 verbose stack                 {
104 verbose stack                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
104 verbose stack                 }
104 verbose stack 			default:
104 verbose stack 				break;
104 verbose stack 			}
104 verbose stack 			if(!bRuleChecking)
104 verbose stack 			{
104 verbose stack 				window.clearInterval(timer);
104 verbose stack 				if (bPassIngress)
104 verbose stack 				{
104 verbose stack 					html_redirect();
104 verbose stack 				}
104 verbose stack 			}
104 verbose stack 		}
104 verbose stack 		bRuleChecking = true;
104 verbose stack 	}
104 verbose stack
104 verbose stack 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
104 verbose stack }
104 verbose stack
104 verbose stack timer = window.setInterval("CheckProcess()", 500);
104 verbose stack
104 verbose stack var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
104 verbose stack  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
104 verbose stack  document.write(objinfo);
104 verbose stack
104 verbose stack //-->
104 verbose stack </SCRIPT>
104 verbose stack
104 verbose stack
104 verbose stack
104 verbose stack <div id="content">
104 verbose stack   <h1 class="warning">网络准入系统</h1>
104 verbose stack   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
104 verbose stack   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
104 verbose stack  <p><span id="loading"></span> </p>
104 verbose stack  <p><span id="ScriptDiv"></span> </p>
104 verbose stack  <br>
104 verbose stack   <p><b>安装方法：</b>
104 verbose stack   <ol>
104 verbose stack     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
104 verbose stack     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
104 verbose stack   </ol>
104 verbose stack   </p>
104 verbose stack </div>
104 verbose stack </body>
104 verbose stack </html>
104 verbose stack
104 verbose stack     at Object.parse (native)
104 verbose stack     at CachingRegistryClient.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:237:23)
104 verbose stack     at Request._callback (D:\Program Files\nodejs\node_modules\npm\node_modules\npm-registry-client\lib\request.js:210:14)
104 verbose stack     at Request.self.callback (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:187:22)
104 verbose stack     at emitTwo (events.js:106:13)
104 verbose stack     at Request.emit (events.js:191:7)
104 verbose stack     at Request.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:1048:10)
104 verbose stack     at emitOne (events.js:96:13)
104 verbose stack     at Request.emit (events.js:188:7)
104 verbose stack     at IncomingMessage.<anonymous> (D:\Program Files\nodejs\node_modules\npm\node_modules\request\request.js:969:12)
105 verbose cwd F:\素材集\PBC-management system\static\lib\bootstrap-datetimepicker-master
106 error Windows_NT 6.1.7601
107 error argv "D:\\Program Files\\nodejs\\node.exe" "D:\\Program Files\\nodejs\\node_modules\\npm\\bin\\npm-cli.js" "install" "--scripts-prepend-node-path=auto"
108 error node v6.11.0
109 error npm  v3.10.10
110 error Unexpected token < in JSON at position 0
110 error <html>
110 error <head>
110 error <meta id="viewport" name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0; minimum-scale=1.0;">
110 error <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
110 error <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>
110 error <title>网络准入客户端</title>
110 error <link href="../css/terminal.css" rel="stylesheet" type="text/css" />
110 error <script language="JavaScript" type="text/JavaScript">
110 error <!--
110 error var bNotRun = false;
110 error if(window.ActiveXObject)
110 error {
110 error
110 error }
110 error else
110 error {
110 error     bNotRun = true;
110 error 	//alert("请使用IE核心浏览器查看本网页！3" + bNotRun);
110 error }
110 error function MM_preloadImages() { //v3.0
110 error   var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
110 error     var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
110 error     if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
110 error }
110 error
110 error function Close()
110 error {
110 error     try
110 error     {
110 error         var startSD = IngressClnt.StartSD();
110 error         if (startSD == 0) {
110 error             alert("启动安全桌面失败");
110 error             return;
110 error         }
110 error     }
110 error     catch (e)
110 error     {
110 error         alert("启动安全桌面失败");
110 error         return;
110 error     }
110 error
110 error  var ua=navigator.userAgent
110 error  var ie=navigator.appName=="Microsoft Internet Explorer"?true:false
110 error  if(ie)
110 error  {
110 error       var IEversion
110 error 	var hasTrident = preg_match("/trident.*rv:[d]+/i", ua)
110 error 	if(hasTrident)
110 error 	{
110 error 			IEversion=11
110 error 	}
110 error 	else
110 error 	{
110 error 		IEversion=parseFloat(ua.substring(ua.indexOf("MSIE ")+5,ua.indexOf(";",ua.indexOf("MSIE "))))
110 error 	}
110 error
110 error       if(IEversion< 5.5)
110 error       {
110 error       	close();
110 error       }
110 error       else
110 error       {
110 error       	parent:top.window.opener =null;
110 error        	parent:top.window.close();
110 error       }
110 error    }
110 error  else
110 error  {
110 error    parent:top.window.close()
110 error  }
110 error }
110 error
110 error function Uninstall()
110 error {
110 error 	try
110 error 	{
110 error 		IngressClnt.Uninstall();
110 error 		strPrompt = "网络准入系统客户端卸载成功!\r\n";
110 error 		strPrompt += "请关闭所有浏览器!";
110 error 		bUninstall = false;
110 error 	}
110 error 	catch(e)
110 error 	{
110 error 		var strPrompt;
110 error 		strPrompt = "卸载准入失败，请检查准入安装文件夹是否存在未卸载文件!";
110 error 	}
110 error 	loading.innerText = strPrompt;
110 error }
110 error
110 error function button_show()
110 error {
110 error 	var sHTML;
110 error 	sHTML="<input type=button align=right value='启动安全桌面' onclick='Close()'style='height: 22; width:120'>";
110 error 	//del by zl at 05/25/2010 卸载失效
110 error 	/*
110 error 	if(!bUninstall)
110 error 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>";
110 error 		//sHTML="<a href onClick='Close()'><img src='./images/close.gif'alt='关闭窗口' border='0' width='71' height='23'></a>";
110 error 		else
110 error 		sHTML="<input type=button align=right value='关闭窗口' onclick='Close()'style='height: 22; width:120'>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type=button align=right value='卸载' onclick='Uninstall()' style='height: 22; width:120'><BR>";
110 error 	*/
110 error 	//end del by zl
110 error 	ScriptDiv.innerHTML = sHTML;
110 error }
110 error
110 error function html_redirect()
110 error {
110 error 	var s =  new String(window.location);
110 error 	var ss = s.indexOf("?");
110 error 	if(ss > 0)
110 error 	{
110 error 		var url = s.substr(ss+1);
110 error 		var ss = url.indexOf("://");
110 error 		if(ss < 0)
110 error 			url = "http://" + url;
110 error 		window.location = url;
110 error 	}
110 error }
110 error function onLocationSingress()
110 error {
110 error 	var ipaddress = "http://"+window.location.host + ":817/singress.exe";
110 error 	window.open(ipaddress);
110 error
110 error }
110 error //-->
110 error </script>
110 error </head>
110 error
110 error <body>
110 error
110 error <SCRIPT language=JavaScript>
110 error <!--
110 error var strPrompt = "";
110 error var bInstall = true;	// true : Want to install, false : want to uninstall
110 error
110 error
110 error var bDownloading = true;
110 error var bProcessed = false;
110 error var bSuccess = false;
110 error var bStartProcess = false;
110 error var bRuleChecking = false;
110 error var bUninstall = false;
110 error var bDelTempFile = false;
110 error var bPassIngress = false;
110 error
110 error var i = 0;
110 error var timer = 0;
110 error var j = 0;
110 error var k = 0;
110 error var total = 0;
110 error
110 error function CheckProcess()
110 error {
110 error     if(bNotRun)
110 error     {
110 error         loading.innerHTML = "请使用IE核心浏览器查看本页面！";
110 error         return;
110 error     }
110 error 	var retv;
110 error 	if(!bSuccess)
110 error 	{
110 error 		try
110 error 		{
110 error 			var ipaddress = window.location.host + ",10.252.252.252";
110 error 			IngressClnt.TellServiceGatewayIp(ipaddress);
110 error 			bDownloading = false;
110 error 			bSuccess = true;
110 error 		}
110 error 		catch(e)
110 error 		{
110 error 			bDownloading = true;
110 error 		}
110 error 	}
110 error 	if(bDownloading)
110 error 	{
110 error 		if(j == 0)
110 error 		{
110 error 			strPrompt = "网络准入系统客户端正在在线安装,安装过程可能需要几分钟，"
110 error 			strPrompt +="请您耐心等待。<br />您也可以手动点击下载链接下载到本地安装。";
110 error 			strPrompt +="<br />安装过程中会添加服务，请允许服务安装";
110 error 		}
110 error 		if(j <= 5)
110 error 		{
110 error 			strPrompt += ".";
110 error 			j++;
110 error 			total++;
110 error 		}
110 error 		else
110 error 		{
110 error 			j=0;
110 error
110 error 			if(total > 50)
110 error 			{
110 error 				window.clearInterval(timer);
110 error 			//	strPrompt = "网络准入系统客户端安装超时!";
110 error 				html_redirect();//IE8第一次安装准入会导致控件不能加载到IE8,导致一致无法跳转
110 error 			}
110 error 		}
110 error 	}
110 error 	else
110 error 	{
110 error 		if(!bDelTempFile)
110 error 		{
110 error 			IngressClnt.DeleteTempFile(); //删除临时缓存
110 error 			bDelTempFile = true;
110 error 		}
110 error 		bProcessed = true;
110 error
110 error 		if(!bRuleChecking)
110 error 		{
110 error 			strPrompt = "网络准入系统客户端已经安装，<br />正在进行规则检测!";
110 error 		}
110 error 		else
110 error 		{
110 error 			var retv;
110 error 			retv = IngressClnt.GetAuthenState();
110 error 			switch(retv)
110 error 			{
110 error 			    case 0:
110 error 			        {
110 error 			            // 现在统一由共享内存给出
110 error 						try
110 error 						{
110 error 				            strPrompt = IngressClnt.GetIngressMessage();
110 error 				            if (k <= 5) {
110 error 				                for (var dot = 0; dot < k; dot++ )
110 error 				                    strPrompt += ".";
110 error 				                k++;
110 error 				                total++;
110 error 				            }
110 error 				            else {
110 error 				                k = 0;
110 error 				            }
110 error 						}
110 error 						catch(e)
110 error 						{
110 error 							strPrompt = "准入客户端正在升级，请稍后打开浏览器重试。若长时间未升级成功，可以点击下载链接下载准入客户端后进行手动安装!";
110 error 						}
110 error 			        }
110 error 			        break;
110 error 			case 1:
110 error 				{
110 error 					strPrompt = "规则检测已经完成,可以正常上网!";
110 error 					bRuleChecking = false;
110 error 					bPassIngress = true;
110 error 				}
110 error 				break;
110 error 			case 2:
110 error 				{
110 error 					var strlog;
110 error 					strlog = IngressClnt.GetIngressLog();
110 error 					if(strlog.search("安全桌面没有运行，") >= 0)
110 error 					{
110 error 						button_show();
110 error 					}
110 error 					strPrompt = strlog;
110 error 					bRuleChecking = false;
110 error 				}
110 error 				break;
110 error             case 3:
110 error                 {
110 error                     strPrompt = "连接准入失败，正在尝试重启。<br />如果此提示超过1分钟，请关闭当前浏览器";
110 error                 }
110 error 			default:
110 error 				break;
110 error 			}
110 error 			if(!bRuleChecking)
110 error 			{
110 error 				window.clearInterval(timer);
110 error 				if (bPassIngress)
110 error 				{
110 error 					html_redirect();
110 error 				}
110 error 			}
110 error 		}
110 error 		bRuleChecking = true;
110 error 	}
110 error
110 error 	loading.innerHTML = strPrompt.replace("\r\n", "<br />");
110 error }
110 error
110 error timer = window.setInterval("CheckProcess()", 500);
110 error
110 error var objinfo ="<object CLASSID='clsid:02309C77-1B15-4309-AC7D-1376111A2648'  id='IngressClnt' name= 'IngressClnt' "
110 error  + "CODEBASE='http://" + window.location.host + ":817/singress.cab#Version=1.0.0.1' BORDER=0 width=0 height=0></object>";
110 error  document.write(objinfo);
110 error
110 error //-->
110 error </SCRIPT>
110 error
110 error
110 error
110 error <div id="content">
110 error   <h1 class="warning">网络准入系统</h1>
110 error   <div class="partition"> <span class="partition_left" style="width:170px;"></span> </div>
110 error   <p class="b_distance">依据组织的上网安全策略，您需要先在计算机上安装网络准入系统，才能继续访问网络。安装完成后，准入系统将会对计算机的安全情况进行检查。</p>
110 error  <p><span id="loading"></span> </p>
110 error  <p><span id="ScriptDiv"></span> </p>
110 error  <br>
110 error   <p><b>安装方法：</b>
110 error   <ol>
110 error     <li>根据浏览器上方的提示（仅支持IE），点击信息栏进行安装</li>
110 error     <li>点击 <a href="#" onclick="onLocationSingress()">下载</a> 下载安装包，手动安装</li>
110 error   </ol>
110 error   </p>
110 error </div>
110 error </body>
110 error </html>
111 error If you need help, you may report this error at:
111 error     <https://github.com/npm/npm/issues>
112 verbose exit [ 1, true ]
